var tunepad=function(e,t){"use strict";const n=new CSSStyleSheet;n.replaceSync("/*\n@keyframes fade-out {\n    0% {\n        opacity: 1.0;\n    }\n\n    100% {\n        opacity: 0.0;\n    }\n}\n*/\n.instrument {\n    position: relative;\n    box-sizing: border-box;\n    display: flex;\n}\n\n.backdrop {\n    fill: #30303f;\n}\n\n.container {\n    width: 100%;\n}\n\n.piano-key.black {\n    fill: #1d1e1f;\n    stroke: #222;\n    stroke-width: 1.5;\n    rx: 1.5;\n}\n\n.piano-key.black .black-top {\n    fill: #444;\n}\n\n.piano-key.black:hover .black-top {\n    fill: #777;\n}\n\n.piano-key.black.pressed .black-top {\n    fill: #222;\n}\n\n.piano-key.white {\n    fill: #ecedee;\n    stroke: #f7f7f8;\n    stroke-width: 1.5;\n    rx: 1.4;\n}\n\n.piano-key.white:hover {\n    fill: #ccc;\n}\n\n.piano-key.white.pressed {\n    fill: #aaa;\n    stroke: #777;\n}\n/*\n.piano-key.white.pressed.step-0 { fill: rgb(229, 76, 78); }\n.piano-key.white.pressed.step-2 { fill: rgb(228, 171, 81); }\n.piano-key.white.pressed.step-4 { fill: rgb(223, 228, 78); }\n.piano-key.white.pressed.step-5 { fill: rgb(174, 215, 71); }\n.piano-key.white.pressed.step-7 { fill: rgb(63, 169, 180); }\n.piano-key.white.pressed.step-9 { fill: rgb(78, 69, 179); }\n.piano-key.white.pressed.step-11 { fill: rgb(202, 69, 147); }\n*/\n.note-hint,\n.midi-hint,\n.key-hint {\n    stroke: none;\n    font: 9pt sans-serif;\n    fill: #0006;\n    text-anchor: middle;\n    opacity: 0.0;\n    pointer-events: none;\n    user-select: none;\n}\n\n.midi-hint.black, .note-hint.black, .key-hint.black {\n    fill: #ccc;\n}\n.show {\n    opacity: 1.0;\n}\n\n.note-hint.always-show {\n    opacity: 1.0;\n}\n\n.felt {\n    fill: #a00;\n}\n\n.animated-slide {\n    transition: transform 0.5s ease-in-out;\n}\n\n.mini-piano {\n    opacity: 0.0;\n    transition: opacity 0.25s;\n}\n\n.mini-piano.show {\n    opacity: 1.0;\n}\n");const s={note:0,velocity:90,message:"note-on",source:"pointer"};class i{get customEvent(){return new CustomEvent(this.props.message,{bubbles:!0,composed:!0,detail:this.props})}constructor(e){this.props={...s,...e,time:Date.now()}}}class a{static init(){a.instance||(a.instance=new a)}static get ready(){return a.init(),void 0!==a.instance?.access}static get outputs(){return a.init(),a.instance?a.instance._outputs:void 0}get _outputs(){return this.access?this.access.outputs:void 0}static get inputs(){return a.init(),a.instance?a.instance._inputs:void 0}get _inputs(){return this.access?this.access.inputs:void 0}constructor(){navigator.requestMIDIAccess().then((e=>{this.access=e,console.log("Connected to MIDI."),e.addEventListener("statechange",(e=>this._midiConnection(e))),e.outputs.forEach((e=>e.open()))}),(()=>{console.log("Failed to initialize web MIDI.")}))}_midiConnection(e){const t=e.port;t&&("input"==t.type&&"connected"==t.state?t.onmidimessage=this._midiEvent:"output"==t.type&&"connected"==t.state&&t.open())}_midiEvent(e){if(e.data&&e.data.length>=2){let t=e.data[0]>>4,n=15&e.data[0],s=e.data[1],i=0;e.data.length>=3&&(i=e.data[2]),console.log(t,n,s,i)}}}class o extends HTMLElement{get minKey(){return 12*this.props.minOctave+12}get maxKey(){return 12*this.props.maxOctave+23}constructor(){super(),this.props={noteHints:!0,midiHints:!0,armed:!1,minOctave:0,maxOctave:7,keyRange:24,focusOctave:2},this.container=null,this.parent=document.createElementNS("http://www.w3.org/2000/svg","g"),this.allKeys=document.createElementNS("http://www.w3.org/2000/svg","g"),this.keys=[],this.width=700,this.height=190,this.key_map="awsedftgyhujkolp;']",this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(n)}connectedCallback(){const e=document.createElement("template");e.innerHTML='<div class="instrument"><svg class="container" version="1.1"></svg></div>',this.root.appendChild(e.content.cloneNode(!0)),this.container=this.root.querySelector("svg.container"),this.container?.append(this.parent),this.container?.setAttribute("viewBox",`0 0 ${this.props.keyRange*r.width} 190`),this.render(),document.addEventListener("keydown",(e=>this.onKeyDown(e))),document.addEventListener("keyup",(e=>this.onKeyUp(e)))}disconnectedCallback(){}attributeChangedCallback(e,t,n){switch(e){case"note-hints":this.setNoteHints("false"!=n);break;case"midi-hints":this.setMidiHints("false"!=n);break;case"armed":"false"==n?this.disarmKeyboard():this.armKeyboard();break;case"key-range":this.setKeyRange(parseInt(n));break;case"min-octave":this.setMinOctave(parseInt(n));break;case"max-octave":this.setMaxOctave(parseInt(n));break;case"focus-octave":this.setFocusOctave(parseInt(n))}}emitNoteOn(e,t,n=90){const s=new i({note:e,source:t,velocity:n,message:"note-on"});this.root.host.dispatchEvent(s.customEvent)}emitNoteOff(e,t){const n=new i({note:e,source:t,velocity:0,message:"note-off"});this.root.host.dispatchEvent(n.customEvent)}emitPitchBend(e,t){const n=new i({value:e,source:t,message:"pitch-bend"});this.root.host.dispatchEvent(n.customEvent)}noteOn(e,t=90){let n=this._noteToKey(e);n?.press()}noteOff(e){let t=this._noteToKey(e);t?.release()}allNotesOff(){this.keys.forEach((e=>e.release()))}isNoteOn(e){let t=this._noteToKey(e);return null!=t&&t.isPressed()}setKeyRange(e){isNaN(e)||(this.props.keyRange=Math.max(7,Math.min(e,56)),this.container?.setAttribute("viewBox",`0 0 ${this.props.keyRange*r.width} 190`))}setMinOctave(e){isNaN(e)||(e=Math.max(0,Math.min(6,e)))!=this.props.minOctave&&(this.props.minOctave=e,this.render())}setMaxOctave(e){isNaN(e)||(e=Math.max(1,Math.min(7,e)))!=this.props.maxOctave&&(this.props.maxOctave=e,this.render())}armKeyboard(){this.props.armed=!0,this.root.querySelectorAll(".key-hint").forEach((e=>{e.classList.add("show")}))}disarmKeyboard(){this.props.armed=!1,this.root.querySelectorAll(".key-hint").forEach((e=>{e.classList.remove("show")}))}get isKeyboardArmed(){return this.props.armed}getArmedKey(e){const t=12*(this.props.focusOctave-this.props.minOctave),n=this.key_map.indexOf(e.toLowerCase());return n>=0&&n+t<this.keys.length?this.keys[n+t]:null}onKeyDown(e){if(!(e.ctrlKey||e.metaKey||e.shiftKey||1==e.repeat)&&this.isKeyboardArmed){const t=this.getArmedKey(e.key.toLowerCase());t?(this.emitNoteOn(t.note,"keyboard"),t.press()):"ArrowLeft"==e.key?this.setFocusOctave(this.props.focusOctave-1):"ArrowRight"==e.key?this.setFocusOctave(this.props.focusOctave+1):"ArrowDown"==e.key?this.emitPitchBend(-200,"keyboard"):"ArrowUp"==e.key&&this.emitPitchBend(200,"keyboard")}}onKeyUp(e){if("ArrowUp"==e.key||"ArrowDown"==e.key)this.emitPitchBend(0,"keyboard");else{const t=this.getArmedKey(e.key.toLowerCase());t&&(this.emitNoteOff(t.note,"keyboard"),t.release())}}_noteToKey(e){const t=Math.round(e-12);return t>=0&&t>=this.keys.length?this.keys[t]:null}render(){if(null==this.container)return;this.parent.innerHTML="",this.keys=[];const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.classList.add("backdrop"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),this.parent.append(e),this.allKeys.classList.add("animated-slide");const t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","g");for(let e=this.minKey;e<=this.maxKey;e++){const s=new r(e,this);this.keys.push(s),s.black?n.append(s.el):t.append(s.el)}this.allKeys.append(t),this.allKeys.append(n),this.parent.append(this.allKeys);const s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.classList.add("felt"),s.setAttribute("width","100%"),s.setAttribute("height","1.5"),s.setAttribute("x","0"),s.setAttribute("y","0"),this.parent.append(s),this.setFocusOctave(this.props.focusOctave)}setFocusOctave(e){this.props.focusOctave=Math.max(this.props.minOctave,Math.min(this.props.maxOctave,e));const t=12*(this.props.focusOctave-this.props.minOctave);if(!isNaN(e)&&null!=this.container&&(this.keys.forEach((e=>e.autoRelease())),t>=0&&t<this.keys.length)){const e=this.keys[t].x;this.allKeys.style.transform=`translateX(${-e}px)`,this.keys.forEach((e=>e.clearKeymap()));for(let e=0;e<this.key_map.length;e++){const n=t+e;n>=0&&n<this.keys.length&&this.keys[n].setKeymap(this.key_map[e])}}}setNoteHints(e){this.props.noteHints=e,this.root.querySelectorAll(".note-hint").forEach((t=>{t.classList.toggle("show",e)}))}get showNoteHints(){return this.props.noteHints}setMidiHints(e){this.props.midiHints=e,this.root.querySelectorAll(".midi-hint").forEach((t=>{t.classList.toggle("show",e)}))}get showMidiHints(){return this.props.midiHints}}o.observedAttributes=["note-hints","midi-hints","armed","min-octave","max-octave","key-range","focus-octave"],o.ELEMENT="piano-keyboard";class r{get step(){return this.note%12}get octave(){return Math.floor(this.note/12)-1}get name(){return`${r.NOTES[this.step]}`}get offset(){return 7*(this.octave-this.piano.props.minOctave)+this._key_offsets[this.step]}get x(){return this.offset*r.width}get black(){return[1,3,6,8,10].includes(this.step)}get white(){return!this.black}get height(){return this.black?130:195}constructor(e,t){this.keyHint=document.createElementNS("http://www.w3.org/2000/svg","text"),this._key_offsets=[0,.45,1,1.55,2,3,3.4,4,4.5,5,5.6,6],this._hint_offsets=[-8,0,0,0,8,-8,0,0,0,0,0,8],this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this._down=!1,this.note=e,this.piano=t,this.el.setAttribute("transform",`translate(${this.x}, 0)`),this.el.classList.add("piano-key",`step-${this.step}`),this.el.classList.add(this.black?"black":"white");const n=this.black?10:1.5;let s=n,i=r.width-2*n;if(this.rect.setAttribute("x",`${s}`),this.rect.setAttribute("y","-8"),this.rect.setAttribute("width",`${i}`),this.rect.setAttribute("height",`${this.height}`),this.rect.setAttribute("rx","3"),this.el.append(this.rect),this.black){s+=3,i-=6;const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.classList.add("black-top"),e.setAttribute("x",`${s}`),e.setAttribute("y","-5"),e.setAttribute("width",`${i}`),e.setAttribute("height",""+(this.height-20)),e.setAttribute("pointer-events","none"),this.el.append(e)}else{const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.classList.add("note-hint"),e.setAttribute("x",`${s+i/2}`),e.setAttribute("y",""+(this.height-17)),e.innerHTML=`${this.name}${this.octave}`,this.piano.showNoteHints&&e.classList.add("show"),0==this.step&&e.classList.add("always-show"),this.el.append(e)}const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.classList.add("midi-hint"),this.black&&a.classList.add("black"),a.setAttribute("x",`${s+i/2}`),a.setAttribute("y",""+(this.height-35)),a.innerHTML=`${this.note}`,this.piano.showMidiHints&&a.classList.add("show"),this.el.append(a);let o=s+i/2+this._hint_offsets[this.step];this.keyHint.classList.add("key-hint"),this.black&&this.keyHint.classList.add("black"),this.keyHint.setAttribute("x",`${o}`),this.keyHint.setAttribute("y",this.black?"45":"60"),this.piano.isKeyboardArmed&&this.keyHint.classList.add("show"),this.el.append(this.keyHint),this.el.addEventListener("pointerdown",(e=>{this.piano.emitNoteOn(this.note,"pointer"),this.press(),e.stopPropagation()})),this.el.addEventListener("pointerup",(e=>{this.piano.emitNoteOff(this.note,"pointer"),this.release()})),this.el.addEventListener("pointerleave",(e=>{this._down&&(this.piano.emitNoteOff(this.note,"pointer"),this.release())})),this.el.addEventListener("pointerenter",(e=>{e.buttons>0&&(this.piano.emitNoteOn(this.note,"pointer"),this.press())}))}press(){this._down=!0,this.el.classList.add("pressed")}release(){this._down&&(this._down=!1,this.el.classList.remove("pressed"))}isPressed(){return this.el.classList.contains("pressed")}autoRelease(){this._down&&(this.piano.emitNoteOff(this.note,"system"),this._down=!1,this.el.classList.remove("pressed"))}setKeymap(e){this.keyHint.innerHTML=e}clearKeymap(){this.keyHint.innerHTML=""}}r.NOTES=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],r.width=45;const h=new CSSStyleSheet;h.replaceSync("\n.piano-wrapper {\n    width: 100%;\n    margin: 0 auto;\n    padding: 1rem 0;\n    background-color: black;\n    border-radius: 10px;\n    display: flex;\n}\n\npiano-keyboard { flex: 1; }\n.octave-button {\n    background-color: transparent;\n    border: none;\n    outline: none;\n    color: #fffc;\n    font-size: 200%;\n    user-select: none;\n}\n.octave-button:hover { color: #fff; }\n.octave-button:active { color: rgb(121, 216, 245); }\n");function c(e,t=0){const n=parseInt(e);return isNaN(n)?t:n}function l(e,t=0){const n=parseFloat(e);return isNaN(n)?t:n}function d(e,t=!1){if(null==e)return t;if("boolean"==typeof e)return e;{const t=e.toString().toLowerCase();if("true"===t||"t"===t)return!0;if("false"===t||"f"===t)return!1}return t}function u(e,t=""){return e?e.toString():t}function p(e){return Math.max(0,Math.pow(10,e/20))}function m(e){return 20*Math.log(e)/Math.LN10}function g(e){return Math.pow(10,e/20)/1.78}function f(e){return 20*Math.log(1.78*e)/Math.LN10}function b(e){return p(f(e))}function v(e,t,n){return Math.max(t,Math.min(n,e))}class w{get bpm(){return this._bpm}set bpm(e){this.setTempo(e)}get meter(){return this._meter}set meter(e){this.setTimeSignature(e)}get beatsPerMeasure(){return this._beatsPerMeasure}get beatValue(){return this._beatValue}get key(){return this._key}set key(e){this._key=e}get contextTime(){return this.context.currentTime}get time(){return this.isPaused?this._start:this.contextTime-this._start}get timeString(){let e=""+Math.floor(this.time/60)%60,t=""+Math.round(this.time)%60,n=""+Math.floor(100*this.time)%100;return 1==e.length&&(e=`0${e}`),1==t.length&&(t=`0${t}`),1==n.length&&(n=`0${n}`),`${e}:${t}.${n}`}get beats(){return this.time*this.bpm/60+this._elapsedBeats}get isPaused(){return 0==this._subscribers.size}static init(){return null==w._instance&&(w._instance=new w),w._instance}constructor(){this._start=0,this._elapsedBeats=0,this._bpm=90,this._meter="4/4",this._beatsPerMeasure=4,this._beatValue=4,this._key="C major",this._subscribers=new Set,this._listeners=new Set,this.context=new AudioContext,this._metronomes=new Set,this._timer=-1}addSubscriber(e){this._listeners.add(e)}removeSubscriber(e){this._listeners.delete(e)}isPlaying(e){return this._subscribers.has(e)}play(e){this.isPaused&&(this._start=this.contextTime-this._start),this._subscribers.add(e),this._listeners.add(e)}pause(e){this._listeners.add(e),this.isPlaying(e)&&(this._subscribers.delete(e),this.isPaused&&(this._start=this.contextTime-this._start))}stopAll(){this._elapsedBeats=0,this._start=0,this._subscribers.clear(),this._listeners.forEach((e=>e.onClockReset()))}setTime(e){this._elapsedBeats=e,this._start=0,this._listeners.forEach((e=>e.onClockTimeChange())),this._subscribers.clear()}setTempo(e){if(isNaN(e))return;const t=this.beats;e!=this._bpm&&(this._bpm=Math.max(5,e),this._start=this.contextTime-60*t/this._bpm,this._listeners.forEach((e=>e.onTempoChange())))}setTimeSignature(e){2!=e.split("/").length&&(e="4/4"),this._beatsPerMeasure=c(e.split("/")[0],-1),this._beatValue=c(e.split("/")[1],-1),(this._beatsPerMeasure<0||this._beatValue<0)&&(this._beatsPerMeasure=4,this._beatValue=4);const t=`${this._beatsPerMeasure}/${this._beatValue}`;this._meter!=t&&(this._meter=t,this._listeners.forEach((e=>e.onTimeSignatureChange())))}startMetronome(e){if(this._metronomes.add(e),-1==this._timer){const e=this.contextTime;let t=0;this._metronomes.forEach((e=>e.pulse(0))),this._timer=window.setInterval((()=>{if(0==this._metronomes.size)window.clearInterval(this._timer),this._timer=-1;else{const n=60/this.bpm,s=this.contextTime-e,i=Math.floor(s/n)%this.beatsPerMeasure;i!=t&&(t=i,this._metronomes.forEach((e=>e.pulse(t))))}}),30)}}stopMetronome(e){this._metronomes.delete(e)}isMetronomePlaying(e){return this._metronomes.has(e)}}class y{getChannelData(e){return this.channels[e]}get numberOfChannels(){return this.channels.length}get samples(){return this.channels[0].length}get length(){return this.channels[0].length}get isEmpty(){return this.samples<=0}get duration(){return this.samples/this.sampleRate}get isMono(){return 1===this.channels.length}get isStereo(){return 2===this.channels.length}constructor(e=1,t=44100){this.channels=new Array,this.sampleRate=t;for(let t=0;t<e;t++)this.channels.push(new Float32Array)}appendAudioBuffer(e){if(e.sampleRate!==this.sampleRate)throw"Cannot append to GrowableAudioBuffer due to a sample rate mismatch.";const t=new Array;for(let n=0;n<this.numberOfChannels;n++){const s=new Float32Array(this.channels[n].length+e.length),i=e.getChannelData(n<e.numberOfChannels?n:0);s.set(this.channels[n],0),s.set(i,this.channels[n].length),t.push(s)}return this.channels=t,this}append(e){if(e.sampleRate!==this.sampleRate)throw"Cannot append to GrowableAudioBuffer due to a sample rate mismatch.";const t=new Array;for(let n=0;n<this.numberOfChannels;n++){const s=new Float32Array(this.samples+e.samples),i=e.channels[n<e.numberOfChannels?n:0];s.set(this.channels[n],0),s.set(i,this.channels[n].length),t.push(s)}return this.channels=t,this}static fromBuffer(e){return new y(e.numberOfChannels,e.sampleRate).appendAudioBuffer(e)}static async fromURL(e){const t=w.init().context,n=await fetch(e),s=await n.arrayBuffer(),i=await t.decodeAudioData(s);return y.fromBuffer(i)}clone(){const e=new y(this.numberOfChannels,this.sampleRate),t=new Array;for(let n=0;n<e.numberOfChannels;n++)t.push(new Float32Array(this.channels[n]));return e.channels=t,e}trim(e,t){const n=v(Math.round(e*this.sampleRate),0,this.samples-1),s=v(Math.round(t*this.sampleRate),0,this.samples-1),i=s-n,a=new y(this.numberOfChannels,this.sampleRate);if(i<=0||this.isEmpty)return a;const o=new Array;for(let e=0;e<this.numberOfChannels;e++)o.push(this.channels[e].slice(n,s));return a.channels=o,a}reverse(){const e=this.samples,t=new Array;for(let n=0;n<this.numberOfChannels;n++){t.push(new Float32Array(e));let s=e-1;for(let i=0;i<e;i++)t[n][s]=this.channels[n][i],s--}const n=new y(this.numberOfChannels,this.sampleRate);return n.channels=t,n}toAudioBuffer(){if(this.buffer)return this.buffer;this.buffer=new AudioBuffer({length:this.samples,numberOfChannels:this.numberOfChannels,sampleRate:this.sampleRate});for(let e=0;e<this.numberOfChannels;e++)this.buffer.copyToChannel(this.channels[e],e);return this.buffer}toWAV(){const e=Math.min(2,this.numberOfChannels),t=this.sampleRate,n=2==e,s=this.samples,i=new Int16Array(s*e+23);i[0]=18770,i[1]=17990,i[2]=2*s*e+15&65535,i[3]=(2*s*e+15&4294901760)>>16,i[4]=16727,i[5]=17750,i[6]=28006,i[7]=8308,i[8]=18,i[9]=0,i[10]=1,i[11]=e,i[12]=65535&t,i[13]=(4294901760&t)>>16,i[14]=2*e*t&65535,i[15]=(2*e*t&4294901760)>>16,i[16]=2*e,i[17]=16,i[18]=0,i[19]=24932,i[20]=24948,i[21]=2*s*e&65535,i[22]=(2*s*e&4294901760)>>16;const a=this.channels[0],o=n?this.channels[1]:a;for(let t=0;t<s;t++)for(let n=0;n<e;n++){let s=0===n?a[t]:o[t];s=Math.max(-1,Math.min(1,s)),s=s<0?32768*s:32767*s,i[t*e+n+23]=Math.round(s)}return new Uint8Array(i.buffer)}downloadWAV(e){const t=this.toWAV(),n=new Blob([t],{type:"audio/wav"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,i.click(),URL.revokeObjectURL(s)}toWAVBase64(){const e=this.toWAV();return`data:audio/wav;base64,${btoa(e.toString())}`}}const k=16.3516,x=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],C=["rgb(229, 76, 78)","rgb(223, 132, 74)","rgb(228, 171, 81)","rgb(227, 199, 73)","rgb(223, 228, 78)","rgb(174, 215, 71)","rgb(63, 188, 70)","rgb(63, 169, 180)","rgb(64, 124, 180)","rgb(78, 69, 179)","rgb(141, 69, 183)","rgb(202, 69, 147)"];class _{get note(){return this._note}set note(e){this._note=e}get end(){return this.start+this.duration}get octave(){return Math.floor(this.note/12)}set octave(e){this.note=12*e+this.step}get step(){return this.note%12}set step(e){this.note=12*this.octave+e}get cents(){return Math.round(100*(this.note-Math.floor(this.note)))}get velocity(){return this._velocity}set velocity(e){this._velocity=A(e,0,127)}get gain(){return this.velocity*this.velocity/16129}set gain(e){this.velocity=Math.sqrt(127*e*127)}get name(){return`${x[Math.floor(this.step)]}`}get accidental(){return this.name.substring(1)}get nameWithOctave(){return`${x[Math.round(this.step)]}${this.octave-1}`}get stepColor(){return C[Math.round(this.step)%C.length]}get rate(){return Math.pow(2,this.note/12)}get frequency(){return k*this.rate}set frequency(e){e>0&&(this.note=12*Math.log(e/k)/Math.LN2)}constructor(e){this._note=60,this.start=0,this.duration=1,this._velocity=90,this.note=e}isEqual(e){return this.note===e.note&&this.start===e.start&&this.duration===e.duration&&this.velocity===e.velocity}clone(){let e=new _(this.note);return e.start=this.start,e.duration=this.duration,e.velocity=this.velocity,e}static fromName(e){const t=new _(60);return t.octave=_.nameToOctave(e),t.step=_.nameToStep(e),t}static fromFrequency(e){const t=new _(60);return t.frequency=e,t}static nameToOctave(e){if(2==e.length){let t=e.codePointAt(1);if(t)return A(t-48,0,8)}else if(e.length>2){let t=e.codePointAt(2);if(t)return A(t-48,0,8)}return 0}static nameToStep(e){return null==e||""==e?0:(e=e.length<=2?e[0].toUpperCase():e.substring(0,2).toUpperCase(),Math.max(0,x.indexOf(e)))}static nameToNote(e){if(e.length<2||e.length>3)return-1;e=e.replaceAll("#","♯");for(let t=0;t<12;t++)if(e.startsWith(x[t])){const n=e.substring(x[t].length);if(["0","1","2","3","4","5","6","7","8"].includes(n)){let e=n.codePointAt(0);return 12*((e||48)-48)+t}}return-1}}function A(e,t,n){return Math.max(t,Math.min(n,e))}class M{get length(){return this.trace.length}get isEmpty(){return 0===this.length}get beats(){return this._beats}get minNote(){return this._minNote}get minOctave(){return Math.max(0,Math.floor(this._minNote/12))}get maxNote(){return this._maxNote}get maxOctave(){return Math.max(0,Math.floor(this._minNote/12))}get noteRange(){return this.maxNote-this.minNote}get octaveRange(){return this.maxOctave-this.minOctave}get noteCount(){return this._noteCount}constructor(){this.trace=new Array,this._beats=0,this._playhead=0,this._minNote=-1,this._maxNote=-1,this._noteCount=0}clear(){this.trace=[],this._beats=0,this._minNote=-1,this._maxNote=-1,this._noteCount=0,this._playhead=0}fromPython(e){for(let t of e)this.addTraceEvent(t)}get messages(){return this.trace.filter((e=>"message"===e.params.get("type")))}get unitTests(){return this.trace.filter((e=>["pass","fail"].includes(e.params.get("type"))))}get passes(){return this.trace.filter((e=>"pass"===e.params.get("type")))}get fails(){return this.trace.filter((e=>"fail"===e.params.get("type")))}isEquivalent(e){if(this.length!==e.length)return!1;for(let t=0;t<this.length;t++)if(!this.trace[t].isEquivalent(e.trace[t]))return!1;return!0}addTraceEvent(e){this._addTraceEvent(S.fromMap(e))}_addTraceEvent(e){switch(this.trace.push(e),e.command){case S.PLAY:this._beats=Math.max(e.end,this._beats),this._playhead=e.end,(this._minNote<0||e.note.note<this._minNote)&&(this._minNote=e.note.note),this._maxNote=Math.max(this._maxNote,e.note.note),this._noteCount++;break;case S.SOUND:this._beats=Math.max(e.end,this._beats),this._playhead=e.end,this._noteCount++;break;case S.REST:this._beats=Math.max(e.end,this._beats),this._playhead=e.end}}getTraceGroup(e){return this.trace.filter((t=>t.trace_group===e))}}class S{get end(){return this.time+this.duration}constructor(e,t){this.time=0,this.duration=1,this.line=-1,this.note=new _(60),this.trace_group=-1,this.params=new Map,this.id=S._TRACE_ID++,this.command=e,this.time=t}clone(){let e=new S(this.command,this.time);e.line=this.line,e.duration=this.duration,e.note=this.note.clone();for(let[t,n]of this.params)e.params.set(t,n);return e}static fromMap(e){let t=new S(String(e.get("command")),Math.max(0,Number(e.get("time"))));t.duration=Number(e.get("duration")),t.note.duration=t.duration;for(let[n,s]of e)if("note"===n&&"number"==typeof s)t.note.note=s;else if("pitch"===n&&"number"==typeof s)t.note.note=s+60;else if("velocity"===n&&"number"==typeof s)t.note.velocity=s;else if("sustain"===n&&"number"==typeof s)t.note.duration=Math.max(t.note.duration,s),t.duration=t.note.duration;else if("line"===n&&"number"==typeof s)t.line=s;else if("trace"===n)t.trace_group=s;else{if(["command","time","duration"].includes(n))continue;t.params.set(n,s)}return t}isEquivalent(e){if(this.command===e.command&&this.time===e.time&&this.duration===e.duration&&this.note.isEqual(e.note)){for(let[t,n]of this.params)if("line"!==t&&e.params.get(t)!==n)return!1;return!0}return!1}}S.PLAY="play",S.SOUND="sound",S.REST="rest",S.PUSH_FX="push_fx",S.POP_FX="pop_fx",S.MESSAGE="message",S._TRACE_ID=0;class L{get waveRate(){return this.sampleRate/this.waveQuantum}get isEmpty(){return 0==this.waveform.length}get duration(){return this.waveform.length/this.waveRate}constructor(){this.waveform=new Array,this.sampleRate=44100,this.waveQuantum=128,this._top_path=new Array,this._bottom_path=new Array,this._wavelines=document.createElementNS("http://www.w3.org/2000/svg","g"),this._wavepath=document.createElementNS("http://www.w3.org/2000/svg","path")}appendSample(e){if(e.length>=2){this.waveform.push(e);const t=this.duration,n=Math.sign(e[1])*v(Math.sqrt(Math.abs(e[1])),0,1),s=Math.sign(e[0])*v(Math.sqrt(Math.abs(e[0])),0,1),i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",`${t}`),i.setAttribute("x2",`${t}`),i.setAttribute("y1",`${n}`),i.setAttribute("y2",`${s}`),i.classList.add("waveline"),this._wavelines.append(i),this._top_path.push("L",t,n),this._bottom_path.unshift("L",t,s)}}appendBuffer(e){const t=e.getChannelData(0),n=e.numberOfChannels>1?e.getChannelData(1):t,s=this.waveQuantum;let i=0,a=0;for(let o=0;o<e.length;o++)i=Math.min(i,Math.min(t[o],n[o])),a=Math.max(a,Math.max(t[o],n[o])),(o+1)%s==0&&(this.appendSample([i,a]),a=0,i=0)}static fromBuffer(e){const t=new L;return t.appendBuffer(e),t}get wavepath(){const e=["M",0,0,...this._top_path,...this._bottom_path,"Z"].join(" ");return this._wavepath.setAttribute("d",e),this._wavepath}get wavelines(){return this._wavelines}}class T{constructor(e,t){this.released=!1,this.canceled=!1,this.note=e,this.chain=t}}class E{constructor(e,t,n){this.value=1,this.gain=new GainNode(e),this.name=t,this.value=n,this.gain.gain.value=n}connect(e,t){return t==this.name&&(e.level.connect(this.gain),!0)}destroy(){this.gain.disconnect()}updateParameter(e,t){return e==`${this.name}-mod}`&&(this.value=l(t,this.value),this.gain.gain.value=this.value,!0)}}class N{constructor(e,t){this.id=0,this.modulators=new Array,this.connectors=new Array,this.context=e,this.id=parseInt(t.id),this.level=e.createGain();const n=l(t.level,0);this.level.gain?.setValueAtTime(p(n),0),this.level.gain.value=p(n),this.addModulator("gain",l(t["gain-mod"],1),this.level.gain)}connect(e,t){for(let n of this.modulators)if(n.connect(e,t))return;"level"==t?e.level.connect(this.level.gain):e.level.connect(this.level)}addConnector(e){this.connectors.push(e),this.level?.connect(e.level)}addModulator(e,t,n){const s=new E(this.context,e,t);s.gain.connect(n),this.modulators.push(s)}playNote(e){}releaseNote(){}scheduleNote(e,t,n,s){}cancelNotes(){}destroy(){this.level.disconnect(),this.modulators.forEach((e=>e.destroy())),this.connectors.forEach((e=>e.destroy()))}pitchBend(e){}schedulePitchBend(e,t){}updateParameter(e,t){for(let n of this.modulators)if(n.updateParameter(e,t))return;if("level"==e){const e=l(t,0);this.level.gain?.setValueAtTime(p(e),0),this.level.gain.value=p(e)}}updateConnectorLevel(e,t){this.connectors.forEach((n=>{n.id==e&&n.updateLevel(t)}))}attachAnalyzer(e,t,n){for(let s of this.connectors)s.id==e&&s.attachAnalyzer(t,n)}detachAnalyzer(e){this.connectors.forEach((t=>{t.id==e&&t.detachAnalyzer()}))}getFloatTimeDomainData(e,t,n){this.connectors.forEach((s=>{s.id==e&&s.getFloatTimeDomainData(t,n)}))}}class H extends N{constructor(e,t){super(e,t),this.A=.1,this.D=.1,this.S=1,this.R=.2,this.aShape=5,this.dShape=2,this.rShape=2,this.attackCurve=[],this.decayCurve=[],this.releaseCurve=[],this.A=l(t.A,this.A),this.D=l(t.D,this.D),this.S=l(t.S,this.S),this.R=l(t.R,this.R),this.R=Math.max(this.R,.01),this.aShape=l(t["a shape"],this.aShape),this.dShape=l(t["d shape"],this.dShape),this.rShape=l(t["r shape"],this.rShape),this._attack=e.createGain(),this._decay=e.createGain(),this._release=e.createGain(),this._attack.gain.value=0,this._decay.gain.value=1,this._release.gain.value=1,this._attack.connect(this._decay),this._decay.connect(this._release),this._release.connect(this.level),this._buildCurves()}connect(e,t){e.level.connect(this._attack)}playNote(e){let t=this.context.currentTime;try{this._attack.gain?.cancelScheduledValues(0),this._decay.gain?.cancelScheduledValues(0),this._release.gain?.cancelScheduledValues(0),this.A>0?this._attack.gain?.setValueAtTime(0,t):this._attack.gain?.setValueAtTime(1,t),this._decay.gain?.setValueAtTime(1,t),this._release.gain?.setValueAtTime(1,t),t=this.context.currentTime+.01,this.A>0?this._attack.gain?.setValueCurveAtTime(this.attackCurve,t,this.A):this._attack.gain?.setValueAtTime(1,t),this.D>0?this._decay.gain?.setValueCurveAtTime(this.decayCurve,t+this.A,this.D):this._decay.gain?.setValueAtTime(this.S,t+this.A)}catch(e){console.log("Exception in ADSR playNote $x.")}}releaseNote(){const e=this.context.currentTime;this.R>0?(this._attack.gain?.cancelScheduledValues(e),this._decay.gain?.cancelScheduledValues(e),this._release.gain?.setValueCurveAtTime(this.releaseCurve,e,this.R)):this._release.gain?.setValueAtTime(0,e)}scheduleNote(e,t,n,s){const i=t<0?-t:0;let a=(t=t<0?0:t)+this.context.currentTime;if(this.A>0?this._attack.gain?.setValueAtTime(0,a):this._attack.gain?.setValueAtTime(1,a),this._decay.gain?.setValueAtTime(1,a),this._release.gain?.setValueAtTime(1,a),a+=.01,this.A>0&&this.A>i){const e=this.A-i;this._attack.gain?.setValueCurveAtTime(this.attackCurve,a,e)}else this._attack.gain?.setValueAtTime(1,a);if(this.D>0&&this.A+this.D>i&&n>this.A){const e=i>=this.A?this.D-(i-this.A):this.D,t=i>=this.A?a:a+this.A-i;this._decay.gain?.setValueCurveAtTime(this.decayCurve,t,e),this.A+this.D>n&&this._decay.gain?.cancelScheduledValues(a+n-i)}else this._decay.gain?.setValueAtTime(this.S,Math.max(0,a+this.A+this.D-i));if(n+this.R>i){const e=i>=n?this.R-(i-n):this.R;this._release.gain?.setValueCurveAtTime(this.releaseCurve,a+n-i,e)}else this._release.gain?.setValueAtTime(0,a)}cancelNotes(){super.cancelNotes();const e=this.context.currentTime;this._release.gain?.cancelScheduledValues(e),this._release.gain.value=0,this._attack.gain?.cancelScheduledValues(e),this._attack.gain.value=0,this._decay.gain?.cancelScheduledValues(e),this._decay.gain.value=0}destroy(){super.destroy(),this._attack.disconnect(),this._decay.disconnect(),this._release.disconnect()}updateParameter(e,t){switch(super.updateParameter(e,t),e){case"A":this.A=l(t,this.A);break;case"D":this.D=l(t,this.D);break;case"S":this.S=l(t,this.S);break;case"R":this.R=l(t,this.R);break;case"a shape":this.aShape=l(t,this.aShape);break;case"d shape":this.dShape=l(t,this.dShape);break;case"r shape":this.rShape=l(t,this.rShape)}this.R=Math.max(this.R,.01),this._buildCurves()}_buildCurves(){this._buildAttackCurve(this.aShape),this._buildDecayCurve(this.dShape),this._buildReleaseCurve(this.rShape)}_buildAttackCurve(e){e=v(e,.001,8),this.attackCurve=[];const t=Math.ceil(H.samplesPerSecond*this.A);if(t>0)for(let n=0;n<=t;n++){let s=n/t;s=Math.pow(s,e),this.attackCurve.push(s)}}_buildDecayCurve(e){e=v(e,.001,4),this.decayCurve=[];const t=Math.ceil(H.samplesPerSecond*this.D);if(t>0)for(let n=0;n<=t;n++){let s=n/t;s=1-Math.pow(s,e),this.decayCurve.push((1-this.S)*s+this.S)}}_buildReleaseCurve(e){e=v(e,.001,4),this.releaseCurve=[];const t=Math.ceil(H.samplesPerSecond*this.R);if(t>0)for(let n=0;n<=t;n++){let s=n/t;s=1-Math.pow(s,e),this.releaseCurve.push(s)}}}H.samplesPerSecond=300;class q{get context(){return this.source.context}constructor(e,t){this.id=0,this.dB=0,this._pre=null,this._analyzers=new Array,this._splitter=null,this._merger=null,this._buffer=null,this.type="",this.source=e,this.id=c(t.id,-1),this.level=new GainNode(this.context),this.dB=l(t.level,0),this.level.gain?.setValueAtTime(p(this.dB),0),this.type=u(t.type,"")}updateLevel(e){this.dB=e,(this._pre??this.level).gain?.setValueAtTime(p(e),0)}destroy(){this.level.disconnect()}attachAnalyzer(e,t,n=-60,s=5){t=v(t,1,6),this._pre=new GainNode(this.context),this._splitter=this.context.createChannelSplitter(t),this._merger=this.context.createChannelMerger(t),this._pre.gain?.setValueAtTime(p(this.dB),0),this.level.gain?.setValueAtTime(1,0),this.source.level.disconnect(this.level),this.source.level.connect(this._pre),this._pre?.connect(this._splitter),this._merger?.connect(this.level);for(let i=0;i<t;i++){let t=new AnalyserNode(this.level.context);this._analyzers.push(t),t.fftSize=e,t.minDecibels=n,t.maxDecibels=s,this._splitter?.connect(t,i,0),t.connect(this._merger,0,i),0==i&&(this._buffer=new Float32Array(t.frequencyBinCount))}}detachAnalyzer(){if(null!=this._pre){this.level.gain?.setValueAtTime(p(this.dB),0),this.source.level.disconnect(this._pre),this._pre?.disconnect(),this._splitter?.disconnect(),this._merger?.disconnect();for(let e of this._analyzers)e.disconnect();this.source.level.connect(this.level),this._pre=null,this._buffer=null,this._splitter=null,this._merger=null,this._analyzers=[]}}getFloatTimeDomainData(e,t){if(e<this._analyzers.length){const n=this._analyzers[e];if(null!=this._buffer&&t.length==this._buffer.length){n.getFloatTimeDomainData(this._buffer);for(let e=0;e<t.length;e++)t[e]+=this._buffer[e]}}}}class z extends N{constructor(e,t){super(e,t),this.tracking=!0,this.ratio=1,this.frequency=350,this.Q=1,this.gain=0,this.detune=0,this.type="lowpass",this.filter=e.createBiquadFilter(),this.filter.connect(this.level),this.Q=v(l(t.Q,1),1e-4,1e3),this.gain=v(l(t.gain,0),-40,40),this.type=u(t["filter type"],"lowpass"),this.detune=l(t.detune,0),this.frequency=v(l(t.frequency,350),0,16700),this.tracking=d(t.tracking,!0),this.ratio=l(t["tracking ratio"],1),this.addModulator("Q",l(t["Q-mod"],1),this.filter.Q),this.addModulator("gain",l(t["gain-mod"],5),this.filter.gain),this.addModulator("frequency",l(t["frequency-mod"],1e3),this.filter.frequency),this.filter.Q.value=this.Q,this.filter.gain.value=this.gain,this.filter.type=this.type,this.filter.detune.value=this.detune,this.filter.frequency.value=this.frequency}playNote(e){const t=this.tracking?e.frequency*this.ratio+this.frequency:this.frequency,n=this.context.currentTime;this.filter.Q?.setValueAtTime(this.Q,n),this.filter.gain?.setValueAtTime(this.gain,n),this.filter.detune?.setValueAtTime(this.detune,n),this.filter.frequency?.setValueAtTime(t,n)}scheduleNote(e,t,n,s){t=t<0?0:t;const i=this.context.currentTime,a=this.tracking?e.frequency*this.ratio+this.frequency:this.frequency;this.filter.Q?.setValueAtTime(this.Q,t+i),this.filter.gain?.setValueAtTime(this.gain,t+i),this.filter.detune?.setValueAtTime(this.detune,t+i),this.filter.frequency?.setValueAtTime(a,t+i)}cancelNotes(){super.cancelNotes(),this.filter.Q?.cancelScheduledValues(0),this.filter.gain?.cancelScheduledValues(0),this.filter.detune?.cancelScheduledValues(0),this.filter.frequency?.cancelScheduledValues(0)}destroy(){super.destroy(),this.filter.disconnect()}connect(e,t){"audio"===t?e.level.connect(this.filter):super.connect(e,t)}updateParameter(e,t){const n=this.context.currentTime;"filter type"===e&&z.FILTERS.includes(t)?(this.type=u(t,"lowpass"),this.filter.type=this.type):"Q"===e?(this.Q=v(l(t,this.Q),1e-4,1e3),this.filter.Q.cancelScheduledValues(0),this.filter.Q.setValueAtTime(this.Q,n),this.filter.Q.value=this.Q):"gain"===e?(this.gain=v(l(t,this.gain),-40,40),this.filter.gain.cancelScheduledValues(0),this.filter.gain.setValueAtTime(this.gain,n),this.filter.gain.value=this.gain):"detune"===e?(this.detune=l(t,this.detune),this.filter.detune?.cancelScheduledValues(0),this.filter.detune?.setValueAtTime(this.detune,n)):"frequency"===e?(this.frequency=v(l(t,this.frequency),0,16700),this.filter.frequency?.cancelScheduledValues(0),this.filter.frequency?.setValueAtTime(this.frequency,n),this.filter.frequency.value=this.frequency):"tracking"===e?this.tracking=d(t,this.tracking):"ratio"===e?this.ratio=l(t,this.ratio):super.updateParameter(e,t)}}z.FILTERS=["lowpass","highpass","bandpass","allpass","lowshelf","highshelf","peaking","notch","allpass"];class B extends N{constructor(e,t){super(e,t),this.frequency=440,this.multiplier=1,this.detune=0,this.relative=!0,this.waveform="sine",this.waveform=u(t.waveform,"sine"),this.frequency=l(t.frequency,this.frequency),this.detune=l(t.detune,0),this.relative=d(t.relative,!0),this.multiplier=l(t.multiplier,this.multiplier),this.osc=e.createOscillator(),this.gain=new GainNode(e),this.shaper=e.createWaveShaper(),this.addModulator("detune",l(t["detune-mod"],500),this.osc.detune),this.addModulator("frequency",l(t["frequency-mod"],1e3),this.osc.frequency),this.addModulator("amplitude",l(t["amplitude-mod"],1),this.level.gain),this.gain.gain.value=.3,B.Waveforms.includes(this.waveform)||(this.waveform="sine"),this.osc.frequency.setValueAtTime(90,0),this.osc.type="sine",this.osc.start(),this.osc.connect(this.gain),this.shaper.connect(this.gain),this.gain.connect(this.level),this._updateWaveform(this.waveform)}_updateWaveform(e){B.Waveforms.includes(e)&&(this.waveform=e),this.osc.type="sine",B.BasicWaveforms.includes(e)?(this.osc.type=e,this.osc.disconnect(),this.osc.connect(this.gain)):B.PeriodicWaveforms.includes(e)?(this.osc.setPeriodicWave(this._createPeriodicWave(e)),this.osc.disconnect(),this.osc.connect(this.gain)):B.ShaperWaveforms.includes(e)&&(this.shaper.curve=this._createWaveShaper(e),this.osc.disconnect(),this.osc.connect(this.shaper),this.osc.type="pitched noise"===e?"sawtooth":"sine")}_createWaveShaper(e){var t,n=new Float32Array(256);switch(e){case"exp sin":t=e=>Math.pow(e,5);break;case"hump":t=e=>(e<0?0:e)-.5;break;default:t=e=>2*Math.random()-1}for(let e=0;e<n.length;e++)n[e]=t(2*e/n.length-1);return n}_createPeriodicWave(e){let t=new Array;switch(e){case"cello":t=[0,1,.5,.3,.5,.35,.2,.2,.1,.15,.15,.15];break;case"flute":t=[0,.5,.05,.3,.1];break;case"reed":t=[-.15,.5,1,.4,.6,.3,.25,.2];break;case"brass":t=[0,.8,.8,.85,.9,.8,.85,.7,.6,.4,.3,.25,.2,.1];break;case"glass":t=[0,1,0,.25,0,.5,0,.75,0,.8];break;case"vibraphone":t=[0,6,19,.8,13,3];break;case"camel":t.push(0);for(let e=1;e<20;e++)t.push(1/Math.pow(e,2));break;case"soft saw":t.push(-.1);for(let e=1;e<20;e++)t.push(1/e);break;case"soft square":t.push(0);for(let e=1;e<50;e++)t.push(1/e*(e%2));break;case"organ 1":t=[-.1,1,1,1];break;case"organ 2":t=[-.1,1,1,1,0,0,0,0,0,.8];break;case"organ 3":t=[0,1,0,0,0,0,.8,.8,.8,.8];break;case"buzz 1":t.push(0);let e=1;for(let n=1;n<100;n++)n%3==0||n%4==0?(t.push(1/e),e++):t.push(0);break;default:t.push(0),e=1;for(let n=1;n<100;n++)n%5==0||n%2==0?(t.push(.5/e),e++):t.push(0)}return this.osc.context.createPeriodicWave(t,new Float32Array(t.length))}playNote(e){let t=this.relative?e.frequency*this.multiplier:this.frequency;t=v(t,0,23999),this.osc.frequency?.setValueAtTime(t,this.context.currentTime),this.osc.detune?.setValueAtTime(this.detune,this.context.currentTime)}scheduleNote(e,t,n,s){t=t<0?0:t;let i=this.relative?e.frequency*this.multiplier:this.frequency;i=v(i,0,23999),this.osc.frequency?.setValueAtTime(i,t+this.context.currentTime),this.osc.detune?.setValueAtTime(this.detune,t+this.context.currentTime)}cancelNotes(){super.cancelNotes(),this.osc.frequency?.cancelScheduledValues(0),this.osc.detune?.cancelScheduledValues(0)}destroy(){super.destroy(),this.osc.stop(),this.osc.disconnect(),this.gain.disconnect(),this.shaper.disconnect()}pitchBend(e){const t=this.context.currentTime;this.osc.detune?.setTargetAtTime(this.detune+e,t,.1)}schedulePitchBend(e,t){t.apply(this.osc.detune,e,this.context,this.detune)}updateParameter(e,t){if("waveform"===e)this._updateWaveform(t);else if("relative"==e)this.relative=d(t,!0);else if("frequency"==e)this.frequency=l(t,this.frequency),this.osc.frequency?.setValueAtTime(this.frequency,this.context.currentTime);else if("multiplier"==e)if(this.relative){let e=this.osc.frequency.value/this.multiplier;this.multiplier=l(t,this.multiplier),this.multiplier>0&&(e*=this.multiplier),e=v(e,0,23999),this.osc.frequency?.setValueAtTime(e,this.context.currentTime)}else this.multiplier=l(t,this.multiplier);else"detune"==e?(this.detune=l(t,this.detune),this.osc.detune?.setValueAtTime(this.detune,this.context.currentTime)):super.updateParameter(e,t)}}B.BasicWaveforms=["sine","square","triangle","sawtooth"],B.PeriodicWaveforms=["cello","flute","reed","brass","glass","vibraphone","camel","organ 1","organ 2","organ 3","soft saw","soft square","buzz 1","buzz 2"],B.ShaperWaveforms=["pitched noise","exp sin","hump"],B.Waveforms=[...B.BasicWaveforms,...B.PeriodicWaveforms,...B.ShaperWaveforms];class V extends H{constructor(e,t){super(e,t)}}class P{constructor(){}static hasSound(e){return P.sounds.has(e)}static getAudioBuffer(e){return P.sounds.get(e)}static async loadAudioBuffer(e){const t=P.context;if(P.hasSound(e))return!0;const n=P.supportsAudioType("audio/ogg")?`${e}.ogg`:`${e}.wav`;try{let s=await fetch(n),i=await s.arrayBuffer(),a=await t.decodeAudioData(i);return P.sounds.set(e,a),!0}catch(e){return console.log(e),!1}}static async loadCustomSound(e){if(P.hasSound(e))return!0;const t=P.context;try{let n=await fetch(e),s=await n.arrayBuffer(),i=await t.decodeAudioData(s);return P.sounds.set(e,i),console.log("Loaded "+e),!0}catch(e){return console.log(e),!1}}static supportsAudioType(e){if(P._supports.has(e))return P._supports.get(e);let t=!1;const n=document.createElement("audio");return n.id="test-audio-node",document.body.append(n),"probably"!=n.canPlayType(e)&&"maybe"!=n.canPlayType(e)||(t=!0,document.querySelector("#test-audio-node")?.remove()),P._supports.set(e,t),t}}function D(e){return"object"==typeof e&&"sample"in e&&"string"==typeof e.sample&&"step"in e&&"number"==typeof e.step}P.sounds=new Map,P.context=w.init().context,P._supports=new Map;class O extends N{constructor(e,t){super(e,t),this.sources=new Array,this.playback=1,this.detune=0,this.sample_pack="piano",this.samples=new Array,this._rate=1,this.drumkit=!1,this.playback=l(t.playback,this.playback),this.detune=l(t.detune,this.detune),this.sample_pack=u(t["sample-pack"],this.sample_pack),this.dIn=new GainNode(e),this.pIn=new GainNode(e),this.dIn.gain.value=l(t["detune-mod"],1),this.pIn.gain.value=l(t["playback-mod"],1),"samples"in t&&Array.isArray(t.samples)&&this.loadSamplePack(t.samples)}loadSamplePack(e){this.samples=e.filter((e=>D(e))).sort(((e,t)=>e.step-t.step)),this.samples.forEach((e=>P.loadAudioBuffer(e.sample)))}static loadAudioBuffers(e,t){e.forEach((e=>P.loadAudioBuffer(e.sample)))}playNote(e){this.scheduleNote(e,0,0,0)}findBestSample(e){let t;if(this.drumkit)t=this.samples.find((t=>t.step===Math.round(e.note)));else{let n=1e5;for(const s of this.samples){if(s.step==e.note)return s;if(s.step>e.note){return s.step-e.note+3<n?s:t}{const i=e.note-s.step;i<n&&(t=s,n=i)}}}return t}scheduleNote(e,t,n,s){const i=t<0?-t:0;t=Math.max(0,t);const a=this.findBestSample(e);if(a){const o=P.getAudioBuffer(a.sample);if(o){const r=e.note-a.step,h=this.context.currentTime,c=Math.pow(2,r/12),l=new AudioBufferSourceNode(this.context);l.connect(this.level),this.sources.push(l),this.dIn.connect(l.detune),this.pIn.connect(l.playbackRate),l.buffer=o,l.playbackRate.value=c*this.playback,l.start(t+h,i),n>0&&l.stop(t+h+n+s),l.addEventListener("ended",(e=>{this.sources=this.sources.filter((e=>e!==l)),l.disconnect()})),o.duration,this.playback,this._rate=c}}}cancelNotes(){super.cancelNotes(),this.sources.forEach((e=>{e.stop(),e.disconnect()})),this.sources=new Array,this._rate=1}destroy(){super.destroy(),this.sources.forEach((e=>{e.stop(),e.disconnect()})),this.sources=new Array,this._rate=1}pitchBend(e){const t=this.context.currentTime;this.sources.forEach((n=>{n.detune?.setTargetAtTime(this.detune+e,t,.1)}))}schedulePitchBend(e,t){if(this.sources.length>0){const n=this.sources[this.sources.length-1];t.apply(n.detune,e,this.context,this.detune)}}connect(e,t){"detune"==t?e.level.connect(this.dIn):"playback"==t&&e.level.connect(this.pIn)}updateParameter(e,t){"playback"==e?(this.playback=l(t,this.playback),this.sources.forEach((e=>{e.playbackRate?.setValueAtTime(this._rate*this.playback,this.context.currentTime)}))):"detune"==e?(this.detune=l(t,this.detune),this.sources.forEach((e=>{e.detune?.setValueAtTime(this.detune,this.context.currentTime)}))):"sample-pack"==e||("playback-mod"==e?this.pIn.gain.value=l(t,1):"detune-mod"==e?this.dIn.gain.value=l(t,1):super.updateParameter(e,t))}}class R{constructor(e){this.id=0,this.free=0,this.nodes=new Map,this.out=null,this.release=0,this.gates=new Array,this.context=e,this.id=R._CHAIN_ID++,this.loadPatch(R._sine_patch)}playNote(e,t){const n=t.context.currentTime;this.free=31536e3,this.disconnect();const s=new GainNode(t.context);s.connect(t),s.gain.value=e.gain,s.gain.setValueAtTime(e.gain,n),this.out?.level.connect(s),this.gates.push({free:this.free,node:s}),this.nodes.forEach(((t,n,s)=>t.playNote(e)))}releaseNote(){this.nodes.forEach(((e,t,n)=>e.releaseNote()))}scheduleNote(e,t,n,s){const i=s.context.currentTime;this.free=i+t+n+this.release+.05;const a=new GainNode(s.context);a.connect(s),a.gain.value=0,a.gain?.setValueAtTime(0,0),a.gain?.setValueAtTime(e.gain,Math.max(i,i+t)),a.gain?.setValueAtTime(0,Math.max(i,i+t+n+this.release)),this.out?.level.connect(a),this.gates.push({free:this.free,node:a});try{this.nodes.forEach(((s,i,a)=>{s.scheduleNote(e,t,n,this.release)}))}catch(e){console.log("Note scheduling exception: $x")}for(let e=0;e<this.gates.length;e++)this.gates[e].free<i&&(this.gates[e].node?.disconnect(),this.out?.level.disconnect(this.gates[e].node),delete this.gates[e]);return this.gates=this.gates.filter((e=>void 0!==e)),this.release}disconnect(){this.out?.level.disconnect(),this.gates.forEach((e=>{e.node?.disconnect()})),this.gates=[]}cancelNotes(){this.disconnect(),this.nodes.forEach((e=>e.cancelNotes())),this.free=0}destroy(){this.disconnect(),this.nodes.forEach((e=>e.destroy())),this.nodes.clear()}pitchBend(e){this.nodes.forEach((t=>t.pitchBend(e)))}schedulePitchBend(e,t){this.nodes.forEach((n=>n.schedulePitchBend(e,t)))}loadPatch(e){if(this.nodes.clear(),this.out=null,this.release=0,Array.isArray(e.nodes))for(let t of e.nodes){let e=this.createSynthNode(this.context,t);e instanceof V&&(this.out=e),this.nodes.set(e.id,e)}this._updateReleaseValue();for(let t of e.routing){let e=this.nodes.get(t.source),n=this.nodes.get(t.dest);if(e&&n){let s=new q(e,t);e.addConnector(s),n.connect(s,u(t.type,""))}}}createSynthNode(e,t){switch(t.type){case"gain":return new N(e,t);case"osc":return new B(e,t);case"adsr":return new H(e,t);case"filter":return new z(e,t);case"out":return new V(e,t);case"sample":case"drums":return new O(e,t);default:return console.log(`Node not found: ${t.type}`),new N(e,t)}}getNodeById(e){return this.nodes.get(e)}updateParameter(e,t,n){let s=this.nodes.get(e);s?.updateParameter(t,n),this._updateReleaseValue()}updateConnectorLevel(e,t,n){let s=this.nodes.get(e);s?.updateConnectorLevel(t,n)}attachAnalyzer(e,t,n,s){let i=this.nodes.get(e);i?.attachAnalyzer(t,n,s)}detachAnalyzer(e,t){let n=this.nodes.get(e);n?.detachAnalyzer(t)}getFloatTimeDomainData(e,t,n,s){let i=this.nodes.get(e);i?.getFloatTimeDomainData(t,n,s)}_updateReleaseValue(){this.release=0,this.nodes.forEach((e=>{e instanceof H&&(this.release=Math.max(Math.max(e.A+e.D,e.R),this.release))}))}}R._CHAIN_ID=0,R._sine_patch={nodes:[{type:"out",A:.1,D:.1,S:.8,R:.15,id:0},{type:"osc",waveform:"sine",relative:"true",frequency:1,id:1,level:.1}],routing:[{source:1,dest:0,type:"out"}]},R._custom_patch={nodes:[{type:"out",id:0,A:0,D:.1,S:1,R:.3,level:0},{type:"sample","sample-pack":"custom",samples:[{sample:"<SOUNDURL>",step:60}],id:1,level:0}],routing:[{id:2,source:1,dest:0,type:"audio",level:0}]};const F={start:0,beats:0,values:[]};class ${constructor(e,t){this.params=new Array,this.start=0,this.beats=-1,this.free=-1,this.id=$._EFFECT_ID++,this.name=e,this.oparams=t,this.start=Math.max(0,t.start),this.beats=t.beats,this.free=-1;for(const e of t.values){const t=Array();if(Array.isArray(e))for(const n of e)t.push(n);else"number"==typeof e&&t.push(e);this.params.push(t)}}static createEffect(e,t){return new I(t)}connect(e,t,n){return this.free=(n+this.start+this.beats+.1)*(60/t)+e.context.currentTime,this.node.connect(e),this.node}disconnect(){this.node.disconnect()}afterEffect(e,t,n,s,i){}clampParam(e,t,n){for(let s=0;s<e.length;s++)e[s]=v(e[s],t,n)}}$._EFFECT_ID=0;class I extends ${get node(){return this._node}constructor(e){super("empty",F),this._node=new GainNode(e)}}class W{get bpm(){return this._bpm}set bpm(e){isNaN(e)||(this._bpm=v(e,5,300))}constructor(){this._bpm=90,this.notes=new Array,this.patch={name:"piano",nodes:new Array,routing:new Array},this.voice="simple sine",this.bank=new Array,this.sound_gens=new Array,this.parameters=new Array,this._analyzer=null,this._analyzers=new Map,this._effects=new Array}get isPlaying(){if(0===this.bank.length)return!1;{const e=this.bank[0].context.currentTime;for(const t of this.bank)if(t.free>e)return!0;return!1}}playNote(e,t){let n=this._allocateGenerator(t.context,t.context.currentTime);if(null==n)return null;n.cancelNotes(),n.playNote(e,t);const s=new T(e,n);return this.notes.push(s),s}scheduleNote(e,t,n,s=0){const i=t.context.currentTime,a=e.duration*(60/this.bpm);n=(n+s)*(60/this.bpm);const o=this._allocateGenerator(t.context,i+n);return o?.scheduleNote(e,n,a,t),o}release(e){if(e.released)return;e.released=!0,e.chain.releaseNote();const t=Math.ceil(1e3*e.chain.release)+100;setTimeout((()=>{this.notes=this.notes.filter((t=>t!==e)),e.chain.disconnect(),this._releaseGenerator(e.chain)}),t)}releaseNote(e){this.notes.forEach((t=>{t.note.note==e.note&&this.release(t)}))}releaseAll(){this.notes.forEach((e=>{this.release(e)}))}cancelAllNotes(){for(const e of this.bank)this._releaseGenerator(e);for(const e of this.sound_gens)e.cancelNotes();this.sound_gens=[]}scheduleNotes(e,t,n){const s=t.context.currentTime,i=Math.max(0,-n);for(let e=0;e<this._effects.length;e++){const t=this._effects[e];t.free>0&&t.free<s&&(t.disconnect(),delete this._effects[e])}this._effects=this._effects.filter((e=>void 0!==e));for(let e=0;e<this.sound_gens.length;e++){this.sound_gens[e].free<s&&delete this.sound_gens[e]}this.sound_gens=this.sound_gens.filter((e=>void 0!==e));const a=new Array,o=new I(t.context);o.beats=e.beats,a.push(o),this._effects.push(o),o.connect(t,this.bpm,n);for(const s of e.trace)if(s.command==S.PUSH_FX){const e=a[a.length-1],i=$.createEffect(s,t.context);i.connect(e.node,this.bpm,n),a.push(i),this._effects.push(i)}else if(s.command==S.POP_FX)a.pop();else if(s.command==S.PLAY&&s.end>=i){const e=a[a.length-1],t=this.scheduleNote(s.note,e.node,s.time,n);a.forEach((e=>{e.afterEffect(t,s.time,s.note.duration,this.bpm,n)}))}}scheduleMidiNotes(e,t,n,s=1){const i=window.performance.now(),a=Math.max(0,-t);for(const o of e.trace)if(o.command===S.PLAY&&o.end>=a){const e=o.note.clone();e.gain*=s;const a=o.note.duration*(60/this.bpm)*1e3,r=i+(o.time+t)*(60/this.bpm)*1e3,h=[144,Math.round(e.note),e.velocity],c=[128,Math.round(e.note),0];n.send(h,r),n.send(c,r+a)}}setMidiProgram(e,t){t>=0&&t<=127&&e.send([192,t])}cancelAllMidiNotes(e){const t=window.performance.now();for(let n=0;n<=127;n++)e.send([128,n,0],t);"clear"in e&&"function"==typeof e.clear&&e.clear()}pitchBend(e){this.notes.forEach((t=>t.chain.pitchBend(e)))}async loadPatch(e){try{e.endsWith("/")&&(e+="patch.json");let n=await fetch(e),s=await n.json();if("string"==typeof(t=s).name&&"2.0"===t.version&&"tunepad-patch"===t.format&&Array.isArray(t.nodes)&&Array.isArray(t.routing)){const t=e.split("/").slice(0,-1).join("/")+"/";this.voice=s.name,this.patch=s,this.parameters=[],this._destroyAllGenerators(),this.sound_gens=[];for(const e of this.patch.nodes)if(Array.isArray(e.samples)){const n=e.samples.filter((e=>D(e))).sort(((e,t)=>e.step-t.step));n.forEach((e=>{e.sample=t+e.sample,P.loadAudioBuffer(e.sample)})),e.samples=n}else"reverb"===e.type?await P.loadCustomSound(e.impulse):"buffer source"===e.type&&await P.loadCustomSound(e.buffer);return!0}}catch(e){console.log("Failed to load audio patch.",e)}finally{return!1}var t}getNodeById(e){return this.bank.length>0?this.bank[0]?.getNodeById(e):void 0}updateParameter(e,t,n){this.bank.forEach((s=>{s.updateParameter(e,t,n)}));for(const s of this.patch.nodes)s.id==e&&(s[t]=n)}_allocateGenerator(e,t){this.bank.length>0&&this.bank[0].context!=e&&this._destroyAllGenerators();for(const n of this.bank)if(n.free<t&&n.context==e)return this._analyzers.forEach((e=>{0==n.free&&n.attachAnalyzer(e.nodeId,e.connectorId,e.fftSize,e.channels)})),n;if(this.bank.length<W.MAX_GENERATORS){const t=new R(e);return t.loadPatch(this.patch),this.bank.push(t),this._analyzers.forEach((e=>{t.attachAnalyzer(e.nodeId,e.connectorId,e.fftSize,e.channels)})),t}}_releaseGenerator(e){e.cancelNotes(),this._analyzers.forEach((t=>{e.detachAnalyzer(t.nodeId,t.connectorId)}))}_destroyAllGenerators(){this.bank.forEach((e=>{e.destroy()})),this.bank=[]}}W.MAX_GENERATORS=24;class G{constructor(){this.synth=new W,this.queue=[],this.cache=new Map,setTimeout((()=>this._processReqest()),100)}static init(){return G.instance||(G.instance=new G),G.instance}static requestAudioBuffer(e){const t=G.init();return new Promise((n=>{const s=t.cache.get(e.uuid);s?n(s):(e._callback=n,t.queue.push(e))}))}static cancelRequest(e){const t=G.init();t.queue=t.queue.filter((t=>t.uuid!==e))}static clearCache(){G.instance?.cache.clear()}static clearCacheEntry(e){G.instance?.cache.delete(e)}async _processReqest(){const e=this.queue.shift();if(e){const t=this.cache.get(e.uuid);if(t&&e._callback)e._callback(t);else if(e.beats<=0){const t=new y;this.cache.set(e.uuid,t),e._callback&&e._callback(t)}else{const t=await this.recordIntoBuffer(e);this.cache.set(e.uuid,t),e._callback&&e._callback(t)}}setTimeout((()=>this._processReqest()),100)}async recordIntoBuffer(e){return new Promise((async t=>{const n=e.start?e.start:0,s=e.beats*(60/e.bpm),i=44100,a=Math.round(i*s),o=new y(2,i),r=new OfflineAudioContext(2,a,i);await r.audioWorklet.addModule("/js/AudioWorklets.js");const h=new AudioWorkletNode(r,"progress-monitor");let c=0;const l=new L;h.port.onmessage=t=>{const n=t.data[2]/a;e.waveform&&l.appendSample(t.data),n>c+.05&&(e.progress(Math.min(1,n)),e.waveform&&e.waveform(l),c=n)},h.connect(r.destination),this.synth.bpm=e.bpm,await this.synth.loadPatch(e.patch),this.synth.scheduleNotes(e.trace,h,n);const d=await r.startRendering();o.appendAudioBuffer(d),e.waveform&&e.waveform(l),e.progress(1),t(o)}))}}class K extends HTMLElement{constructor(){super(),this.synth=new W,this.octave=3,this.minOctave=0,this.maxOctave=7,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(h);const e=document.createElement("template");e.innerHTML='<div class="piano-wrapper">\n    <button id="down-octave" class="octave-button" title="Lower Octave">❮</button>\n    <piano-keyboard note-hints="true" midi-hints="true" armed="true" max-octave="8" min-octave="1" focus-octave="3" key-range="14"></piano-keyboard>\n    <button id="up-octave" class="octave-button" title="Higher Octave">❯</button>\n</div>',this.root.appendChild(e.content.cloneNode(!0)),this.keyboard=this.root.querySelector("piano-keyboard"),this.audio=w.init()}connectedCallback(){this.audio=w.init(),this.keyboard.addEventListener("note-on",(e=>{const t=new _(e.detail.note);this.synth.playNote(t,this.audio.context.destination)})),this.keyboard.addEventListener("note-off",(e=>{const t=new _(e.detail.note);this.synth.releaseNote(t)})),this.root.querySelector("#down-octave")?.addEventListener("click",(e=>{this.octave=Math.max(this.minOctave,this.octave-1),this.root.querySelector("piano-keyboard")?.setAttribute("focus-octave",`${this.octave}`)})),this.root.querySelector("#up-octave")?.addEventListener("click",(e=>{this.octave=Math.min(this.maxOctave,this.octave+1),this.root.querySelector("piano-keyboard")?.setAttribute("focus-octave",`${this.octave}`)}))}disconnectedCallback(){}attributeChangedCallback(e,t,n){"patch"===e&&n!==t?this.synth.loadPatch(n):n!==t&&this.keyboard.setAttribute(e,n),"focus-octave"===e?this.octave=parseInt(n):"min-octave"===e?this.minOctave=parseInt(n):"max-octave"===e&&(this.maxOctave=parseInt(n)),this.octave=isNaN(this.octave)?3:this.octave,this.minOctave=isNaN(this.minOctave)?0:this.minOctave,this.maxOctave=isNaN(this.maxOctave)?7:this.maxOctave}}K.ELEMENT="piano-instrument",K.observedAttributes=[...o.observedAttributes,"patch"];const U=new CSSStyleSheet;U.replaceSync(':host {\n    --error-red: #da575d;\n    --warn-yellow: orange;\n    --output-green: #87c44e;\n }\n\n.code-view-wrapper {\n    margin: 2rem 0;\n    border-radius: 0.75em;\n    overflow: hidden;\n    max-width: 700px;\n    position: relative;\n    background-color: #e3e9f2;\n}\n\n.code-view-wrapper.light {\n    background-color: #e3e9f2;\n}\n\n.buttons {\n    position: absolute;\n    right: 0;\n    top: 0;\n    z-index: 5;\n    margin: 0.75rem;\n}\n\n.buttons button {\n    width: 30px;\n    height: 30px;\n    line-height: 20px;\n    outline: none;\n    border: none;\n    background: transparent;\n    color: #666;\n    padding: 4px;\n}\n.buttons button svg { \n    width: 15px; \n    height: 15px; \n    fill: #666;\n    vertical-align: middle;\n}\n\n.buttons button:hover { color: black; }\n.buttons button:hover svg { fill: black; }\n\n.buttons button:active { color: var(--highlight-color); }\n.buttons button:active svg { fill: var(--highlight-color); }\n.buttons button.hidden { display: none; }\n\n#loader svg {\n    animation: spin-animation 2s infinite;\n    animation-timing-function: linear;\n}\n\npre[class*="language-python"] {\n    padding-left: 0.5em;\n    font-size: 12px;\n}\n\ncode[class*="language-python"] {\n    line-height: 1.75;\n}\n\npre[class*="language-"].line-numbers {\n\tposition: relative;\n\tpadding-left: 3.8em;\n    margin: 0;\n\tcounter-reset: linenumber;\n}\n\npre[class*="language-"].line-numbers > code {\n\tposition: relative;\n\twhite-space: inherit;\n}\n\n.line-numbers .line-numbers-rows {\n\tposition: absolute;\n\tpointer-events: none;\n\ttop: -2px;\n\tfont-size: 100%;\n\tleft: -3.8em;\n\twidth: 3em; /* works for line-numbers below 1000 lines */\n\tletter-spacing: -1px;\n\tborder-right: 1px solid #999;\n\tuser-select: none;\n\tbackground-color: transparent;\n}\n\n.line-numbers-rows > span {\n    display: block;\n    counter-increment: linenumber;\n}\n\n.line-numbers-rows > span:before {\n    content: counter(linenumber);\n    color: #999;\n    display: block;\n    padding-right: 0.8em;\n    text-align: right;\n}\n\nfooter {\n    background-color: #777;\n    color: white;\n    font-size: 12px;\n    padding: 0.4em 2em;\n    display: flex;\n}\n\nfooter.error {\n    background-color: #aa3e3e;\n}\n\nfooter div {\n    margin-left: 1.5rem;\n}\n\nfooter div:first-child {\n    margin-left: 0;\n}\n#status, #error { flex: 1; }\n\nfooter #error { display: none; }\nfooter.error div { display: none; }\nfooter.error div#error { display: block; }\n\n.progress-bar {\n    display: block;\n    height: 5px;\n    width: 100%;\n    background-color: #0002;\n}\n.progress-bar.hidden { display: none; }\n\n.progress-bar .fill {\n    background-color: cornflowerblue;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    width: 0%;\n}\n\n@media print {\n    footer { display: none; }\n    .buttons { display: none; }\n}\n\n@keyframes spin-animation {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(359deg);\n    }\n}\n');const Q=new CSSStyleSheet;Q.replaceSync('code[class*=language-],pre[class*=language-]{color:#111b27;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#ccd6e4}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#ccd6e4}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#e3e9f2}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#304259;font-style:italic}.token.punctuation{color:#111b27}.token.selector,.token.tag{color:#007474}.token.attr-name,.token.boolean,.token.constant,.token.number,.token.pseudo-class,.token.pseudo-element,.token.selector .token.attribute{color:#7d6600}.token.class-name,.token.key,.token.parameter,.token.property,.token.property-access,.token.variable{color:#005c99}.token.attr-value,.token.color,.token.inserted,.token.selector .token.value,.token.string,.token.string .token.url-link{color:#237800}.token.builtin,.token.keyword-array,.token.package,.token.regex{color:#b800b8}.token.function,.token.selector .token.class,.token.selector .token.id{color:#8600c6}.token.atrule .token.rule,.token.combinator,.token.keyword,.token.operator,.token.unit{color:#aa4d00}.token.deleted,.token.important{color:#bf0100}.token.keyword-this,.token.this{color:#005c99}.token.bold,.token.important,.token.keyword-this,.token.this{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.language-markdown .token.title,.language-markdown .token.title .token.punctuation{color:#005c99;font-weight:700}.language-markdown .token.code{color:#007474}.language-markdown .token.url>.token.content{color:#237800}.language-markdown .token.url-link{color:#7d6600}.language-markdown .token.list.punctuation{color:#b800b8}.language-markdown .token.table-header{color:#111b27}.language-json .token.operator{color:#111b27}.token.cr:before,.token.lf:before,.token.space:before,.token.tab:not(:empty):before{color:#304259}div.code-toolbar>.toolbar a,div.code-toolbar>.toolbar button{color:#e3e9f2;background:#005c99}div.code-toolbar>.toolbar a:focus,div.code-toolbar>.toolbar a:hover,div.code-toolbar>.toolbar button:focus,div.code-toolbar>.toolbar button:hover{color:#e3e9f2;background:#005c99da;text-decoration:none}div.code-toolbar>.toolbar span,div.code-toolbar>.toolbar span:focus,div.code-toolbar>.toolbar span:hover{color:#e3e9f2;background:#304259}.line-highlight{background:#3042591f;background:linear-gradient(to right,#3042591f 70%,#30425915)}.line-highlight:before,.line-highlight[data-end]:after{background-color:#304259;color:#e3e9f2;box-shadow:0 1px #ccd6e4}pre[id].linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:#3042591f}.line-numbers .line-numbers-rows{border-right:1px solid #111b271f;background:#d8e0ebda}.line-numbers-rows>span:before{color:#111b2796}.rainbow-braces .token.punctuation.brace-level-1,.rainbow-braces .token.punctuation.brace-level-5,.rainbow-braces .token.punctuation.brace-level-9{color:#7d6600}.rainbow-braces .token.punctuation.brace-level-10,.rainbow-braces .token.punctuation.brace-level-2,.rainbow-braces .token.punctuation.brace-level-6{color:#b800b8}.rainbow-braces .token.punctuation.brace-level-11,.rainbow-braces .token.punctuation.brace-level-3,.rainbow-braces .token.punctuation.brace-level-7{color:#005c99}.rainbow-braces .token.punctuation.brace-level-12,.rainbow-braces .token.punctuation.brace-level-4,.rainbow-braces .token.punctuation.brace-level-8{color:#8600c6}pre.diff-highlight>code .token.deleted:not(.prefix),pre>code.diff-highlight .token.deleted:not(.prefix){background-color:#bf01001f}pre.diff-highlight>code .token.inserted:not(.prefix),pre>code.diff-highlight .token.inserted:not(.prefix){background-color:#2378001f}.command-line-prompt{border-right:1px solid #111b271f}.command-line-prompt>span:before{color:#111b2796}');class j{static init(){return null===j.instance&&(j.instance=new j),j.instance}constructor(){this.queue=new Array,this.cache=new Map,this.modules=new Map,this.active=null,this.warnings=new Array,this.listeners=new Map,this.interruptBuffer=new Uint8Array(1),this.worker=new Worker("/js/PythonWorker.js"),this.worker.postMessage({action:"setInterruptBuffer",buffer:this.interruptBuffer}),setTimeout((()=>{j.instance?.processQueue()}),50),this.worker.onmessage=e=>{const t=e.data,n=this.active;if("preload"===n?.action&&t)n.callback(new X(n));else if(n&&n.uuid===t.uuid){for(let e of this.queue)if(e.uuid===n.uuid&&e.action===n.action&&e.code!==n.code)return void(this.active=null);let e=new X(n);e.output=t.output,e.globals=t.globals,e.errors=t.errors,e.dependencies=t.dependencies,this.warnings=this.warnings.filter((t=>t.target!==e.uuid&&t.source!==e.uuid));for(const[t,n]of this.cache)t!==e.uuid&&n.dependencies.includes(e.name)&&this.warnings.push({name:"Dependency Warning",message:`Cell '${e.name}' has been updated.`,details:"",line:-1,target:n.uuid,source:e.uuid});for(let[t,n]of this.cache)if(t!==e.uuid)for(let s of n.dependencies){let i=s===e.name;for(let[e,n]of this.cache)t!==e&&n.name===s&&(i=!0);i||this.warnings.push({name:"Dependency Warning",message:`Cell '${s}' does not exist.`,details:"",line:-1,target:n.uuid,source:e.uuid})}e.globals.has("__tunepad_trace")&&e.trace.fromPython(e.globals.get("__tunepad_trace").value),e.hasNoErrors&&this.cache.set(e.uuid,e),n.callback(e),this.listeners.forEach(((e,t)=>{e(this.warnings.filter((e=>e.target===t)))}))}this.active=null}}static destroy(){if(j.instance){const e=j.instance;e.worker.terminate(),e.active=null,e.cache.clear(),e.modules.clear()}}static compile(e,t=!1){return new Promise((n=>{j.instance?.queue.push(new Z(e,"compile",n,t))}))}static renameCell(e){return j.compile(e,!0)}static run(e){return new Promise((t=>{j.instance?.queue.push(new Z(e,"run",t))}))}static preload(e){return new Promise((t=>{j.instance?.queue.push(new Z(e,"preload",t))}))}static preloadAll(e){const t=j.instance;return new Promise((async n=>{for(const n of e)t?.queue.push(new Z(n,"preload",(e=>{console.log("preload response for "+e.name)})));n(!0)}))}static addWarningListener(e,t){j.instance?.listeners.set(e,t)}static removeWarningListener(e){j.instance?.listeners.delete(e)}static playCell(e){j.instance?.worker.postMessage({...e,action:"play"})}static pauseCell(e){j.instance?.worker.postMessage({...e,action:"pause"})}static deleteCell(e){const t=j.instance;if(t){t.modules.delete(e.uuid),t.cache.delete(e.uuid),t.worker.postMessage({...e,action:"delete"});for(const[n,s]of t.cache)n!==e.uuid&&s.dependencies.includes(e.name)&&t.warnings.push({name:"Dependency Warning",message:`Cell '${e.name}' was deleted.`,details:"",line:-1,target:n,source:e.uuid})}}static getWarnings(){return j.instance.warnings}hasWarnings(e){return void 0!==this.warnings.find((t=>t.target===e))}equivalentCode(e,t){function n(e){return e.split("\n").filter((e=>""!==e&&!e.startsWith("#"))).join("\n")}return n(e)===n(t)}equivalent(e,t){return!e.force&&e.name===t.name&&e.action===t.action&&this.equivalentCode(e.code,t.code)}async processQueue(){if(this.queue.length>0&&null===this.active){let e=this.queue.shift();this.modules.set(e.uuid,e.cell);let t=this.cache.get(e.uuid);t&&t.code&&!this.hasWarnings(e.uuid)&&this.equivalent(e,t)?e.callback(t):(this.active=e,this.interruptBuffer[0]=0,this.active.initiatedTime=Date.now(),this.removeFromCache(e.uuid),this.worker.postMessage({uuid:e.uuid,name:e.name,action:e.action,code:e.code}))}else if(this.active&&this.active.initiatedTime>0&&"compile"===this.active.action){const e=Date.now()-this.active.initiatedTime;e>1e4&&e<11e3&&(this.interruptBuffer[0]=2)}setTimeout((()=>{j.instance?.processQueue()}),50)}removeFromCache(e){this.cache.get(e)?.close(),this.cache.delete(e)}static makePythonSafe(e,t){let n="";for(const t of e){let e=t.charCodeAt(0);e>=48&&e<=57||e>=97&&e<=199||e>=65&&e<=90||95===e?n+=t:32===e&&(n+="_")}""===n&&(n="new_cell"),n.charCodeAt(0)>=48&&n.charCodeAt(0)<=57&&(n="_"+n),Y.includes(n)&&(n="_"+n);let s=n,i=2;for(;j.instance?.duplicateName(n,t);)n=s+"_"+i,i++;return n}duplicateName(e,t){for(const[n,s]of this.modules)if(t!==n&&s.name===e)return!0;return!1}}j.instance=null;class Z{constructor(e,t,n,s=!1){this.force=!1,this.initiatedTime=-1,this.cell=e,this.action=t,this.callback=n,this.force=s}get uuid(){return this.cell.uuid}get name(){return this.cell.name}get code(){return this.cell.code}}class X{constructor(e){this.output=[],this.trace=new M,this.errors=[],this.dependencies=[],this.uuid=e.uuid,this.code=e.code,this.name=e.name,this.action=e.action}get hasErrors(){return this.errors.length>0}get hasNoErrors(){return 0===this.errors.length}close(){}}const Y=["and","as","assert","break","class","continue","def","del","elif","else","except","exec","False","finally","for","from","global","if","import","in","is","lambda","None","nonlocal","not","or","pass","raise","return","True","try","while","with","yield"];class J extends HTMLElement{get currentBeat(){return this.audio.beats%this.duration}get remainingBeats(){return this.duration-this.currentBeat}get percentBeats(){return this.currentBeat/this.duration}constructor(){super(),this.uuid=self.crypto.randomUUID(),this.name="",this.patch="/sounds/voices/piano/",this.code="",this.synth=new W,this.gain=0,this.midiOut=!1,this.midiVoice=-1,this.audio_ready=!1,this.audible=!1,this.duration=4,this._last_beat=0,this._looped=-1,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(Q),this.root.adoptedStyleSheets.push(U);const e=document.createElement("template");e.innerHTML='<div class="code-view-wrapper">\n    <div class="buttons">\n        <button id="loader" class="hidden" title="Loading audio">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                <path d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"/>\n            </svg>\n        </button>\n        <button id="play-button" class="hidden" title="Play Audio">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n                <path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/>\n            </svg>\n        </button>\n        <button id="pause-button" class="hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\n                <path d="M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"/>\n            </svg>\n        </button>\n        <button id="stop-button" class="hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n                <path d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"/>\n            </svg>\n        </button>\n        <button id="copy-button" title="Copy to Clipboard">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                <path d="M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"/>\n            </svg>\n        </button>\n    </div>\n    <pre class="line-numbers"><code id="code-view" class="language-python"></code></pre>\n    <div class="progress-bar"><div class="fill"></div></div>\n    <footer>\n        <div id="status"></div>\n        <div id="error"></div>\n        <div id="beats"></div>\n        <div id="tempo"></div>\n        <div id="time"></div>\n        <div id="patch"></div>\n    </footer>\n</div>\n',this.root.appendChild(e.content.cloneNode(!0)),this.audio=w.init()}connectedCallback(){window.addEventListener("load",(()=>{this.code=this.innerHTML.trim().split("\n").map((e=>e.startsWith("/")?e.substring(1):e)).join("\n");const e=this.root.querySelector("#code-view"),n=this.root.querySelector(".code-view-wrapper");e&&n&&(e.innerHTML=this.code,t.highlightAllUnder(n)),this.audible&&this.compileCode(this.code,!0)})),this.root.querySelector("#play-button")?.addEventListener("click",(e=>this.playAudio())),this.root.querySelector("#pause-button")?.addEventListener("click",(e=>this.pauseAudio())),this.root.querySelector("#stop-button")?.addEventListener("click",(e=>this.audio.stopAll())),this.root.querySelector("#copy-button")?.addEventListener("click",(e=>{navigator.clipboard.writeText(this.code)}))}disconnectedCallback(){}attributeChangedCallback(e,t,n){"patch"===e&&null!==n?(this.audible=!0,this.patch=n,this.loadPatch(n)):"id"===e?(this.name=j.makePythonSafe(n,this.uuid),this.status(),this.setHTML("#status",`${this.name} (python)`)):"theme"===e?(this.removeClass(".code-view-wrapper",t),this.addClass(".code-view-wrapper",n)):"tempo"===e?(this.audio.bpm=c(n,90),this.synth.bpm=c(n,90),this.setHTML("#tempo",`${this.synth.bpm} bpm`)):"time"===e&&null!==n?(this.audio.meter=n,this.setHTML("#time",`${this.audio.meter} time`)):"gain"==e?this.gain=l(n,0):"midi-out"===e?(this.midiOut="true"===n,this.midiOut&&a.init()):"midi-voice"===e&&(this.midiVoice=parseInt(n))}cueAudio(e){this.trace&&(this.gain_node||(this.gain_node=new GainNode(this.audio.context),this.gain_node.gain.value=p(this.gain),this.gain_node.gain.setValueAtTime(this.gain,0),this.gain_node.connect(this.audio.context.destination)),this.synth.scheduleNotes(this.trace,this.gain_node,e)),this.trace&&this.midiOut&&a.outputs?.forEach((t=>{this.synth.setMidiProgram(t,this.midiVoice),this.synth.scheduleMidiNotes(this.trace,e,t,this.gain)}))}playAudio(){this.trace&&(this.audio.play(this),this.cueAudio(-1*this.currentBeat),this.remainingBeats<=.5&&(this.cueAudio(this.remainingBeats),this._looped=this.currentBeat,this._last_beat=this.currentBeat),this.root.querySelector("#play-button")?.classList.add("hidden"),this.root.querySelector("#pause-button")?.classList.remove("hidden"),this.animation())}pauseAudio(){this.synth.cancelAllNotes(),this.audio.pause(this),this.midiOut&&a.outputs?.forEach((e=>{this.synth.cancelAllMidiNotes(e)})),this.root.querySelector("#play-button")?.classList.remove("hidden"),this.root.querySelector("#pause-button")?.classList.add("hidden")}stopAudio(){this.pauseAudio(),this.setFill(0),this._looped=-1,this._last_beat=0}async compileCode(e,t=!1){j.init(),this.status(),t&&await j.preload(this);const n=await j.compile(this);this.trace=n.trace,this.duration=Math.ceil(n.trace.beats/this.audio.beatsPerMeasure)*this.audio.beatsPerMeasure,this.setHTML("#beats",`${this.duration} beats`),n.hasErrors&&(this.error=n.errors[0]),this.status()}async loadPatch(e){this.root.querySelector("#loader")?.classList.remove("hidden"),this.status(),await this.synth.loadPatch(e),this.setHTML("#patch",this.synth.patch.name),this.audio_ready=!0,this.status()}animation(){this.audio.isPlaying(this)&&(this.setFill(this.percentBeats),this.remainingBeats<.5&&this._looped<0?(this._looped=this.currentBeat,this.cueAudio(this.remainingBeats)):this._looped>this.currentBeat?this._looped=-1:this._looped<0&&this._last_beat>this.currentBeat&&this.cueAudio(-1*this.currentBeat),this._last_beat=this.currentBeat,requestAnimationFrame((e=>{this.animation()})))}setFill(e){const t=this.root.querySelector(".progress-bar .fill");t&&(t.style.width=100*e+"%")}status(){const e=this.root.querySelector("#status");e&&(this.error?(this.addClass("footer","error"),this.setHTML("#error",`${this.error.name} (line ${this.error.line})`),this.addClass("#loader","hidden")):this.audible&&(this.removeClass("footer","error"),this.setHTML("#error",""),this.audio_ready&&this.trace?(e.innerHTML=`${this.name} (python)`,this.root.querySelector("#play-button")?.classList.remove("hidden"),this.root.querySelector("#stop-button")?.classList.remove("hidden"),this.root.querySelector(".progress-bar")?.classList.remove("hidden"),this.root.querySelector("#loader")?.classList.add("hidden")):this.audio_ready?e.innerHTML="Loading python...":this.trace?e.innerHTML="Loading audio...":e.innerHTML="Loading..."))}setHTML(e,t){const n=this.root.querySelector(e);n&&(n.innerHTML=t)}addClass(e,t){const n=this.root.querySelector(e);n&&n.classList.add(t)}removeClass(e,t){const n=this.root.querySelector(e);n&&n.classList.remove(t)}onClockReset(){this.stopAudio()}onClockTimeChange(){}onTempoChange(){}onTimeSignatureChange(){}}J.ELEMENT="tunepad-code",J.observedAttributes=["id","patch","tempo","time","gain","midi-out","midi-voice"];const ee=new CSSStyleSheet;ee.replaceSync(".explore-wrapper {\n    width: 95%;\n    margin: 2rem auto;\n    padding: 1rem 0;\n    border-radius: 20px;\n    display: flex;\n    flex-direction: column;\n}\n#code-hint {\n    margin: 0rem 0.25rem 0 0;\n    padding: 0 1rem;\n    background: #0002;\n    height: 35px;\n    line-height: 35px;\n    border: 1px solid #887;\n    border-radius: 5px;\n    user-select: none;\n    box-sizing: border-box;\n    flex: 1;\n}\n.shelf {\n    display: flex;\n    margin: 1rem 4.5rem;\n}\n.keyboard-wrapper {\n    display: flex;\n}\n#copy-button {\n    color: #000a;\n    outline: none;\n    border: 1px solid #555;\n    height: 35px;\n    background-color: transparent;\n    border-radius: 5px;\n    font-weight: 500;\n    user-select: none;\n}\n#copy-button:hover { color: black; }\n#copy-button:active { color: rgb(45, 113, 134); }\npiano-instrument { flex: 1; }\n");class te extends HTMLElement{constructor(){super(),this.notes=new Set,this.chord=new Array,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(ee);const e=document.createElement("template");e.innerHTML='<div class="explore-wrapper">\n    <div class="keyboard-wrapper">\n        <piano-instrument></piano-instrument> \n    </div>\n    <div class="shelf">\n        <pre id="code-hint"></pre>\n        <button id="copy-button" title="Copy Code">Copy to Clipboard</button>\n    </div>\n</div>',this.root.appendChild(e.content.cloneNode(!0))}connectedCallback(){const e=this.root.querySelector("piano-instrument");e?.addEventListener("note-on",(e=>{const t=new _(e.detail.note);this.addCodeHint(t)})),e?.addEventListener("note-off",(e=>{const t=new _(e.detail.note);this.removeCodeHint(t)})),e?.addEventListener("click",(e=>{const t=document.querySelector("#code-hint");t&&navigator.clipboard.writeText(t.innerHTML)}))}disconnectedCallback(){}attributeChangedCallback(e,t,n){n!==t&&this.root.querySelector("piano-instrument")?.setAttribute(e,n)}getCodeHint(){if(1===this.chord.length){const e=new _(this.chord[0]);return`playNote(${e.note})    # ${e.nameWithOctave}`}return this.chord.length>0?`playNote([ ${this.chord.join(", ")} ])`:""}addCodeHint(e){this.notes.add(e.note),this.chord=[...this.notes].sort();const t=this.root.getElementById("code-hint");t&&(t.innerHTML=this.getCodeHint())}removeCodeHint(e){this.notes.delete(e.note),0==this.notes.size&&(this.chord=[])}}te.ELEMENT="note-explorer",te.observedAttributes=K.observedAttributes;const ne=new CSSStyleSheet;ne.replaceSync("/*\n * TunePad\n * Northwestern University\n * michael-horn@northwestern.edu\n *\n * This project was funded by the National Science Foundation (grant DRL-1612619).\n * Any opinions, findings and conclusions or recommendations expressed in this\n * material are those of the author(s) and do not necessarily reflect the views\n * of the National Science Foundation (NSF).\n */\n :host {\n    --error-red: #da575d;\n    --error-red-bg: #f9e4e5;\n    --fail-red: #da575d;\n    --fail-red-bg: #f9e4e5;\n    --info-blue: #4b90d7;\n    --pass-green: green;\n    --pass-green-bg: #ded;\n    --warn-yellow: orange;\n    --warn-yellow-bg: #fed;\n    --output-badge-color: #87c44e;\n    --error-badge-color: #da575d;\n    --warn-badge-color: orange;\n }\n.python-message {\n    padding: 10px;\n    font-size: 12px;\n    position: relative;\n    margin: 0.25em 0;\n}\n\n.python-message.error {\n    background-color: white;\n    border-left: 10px solid var(--error-red);\n}\n\n.python-message.message {\n    background-color: white;\n    border-left: 10px solid var(--info-blue);\n}\n\n.python-message.warning {\n    background-color: white;\n    border-left: 10px solid var(--warn-yellow);\n}\n\n.python-message.test {\n    background-color: var(--fail-red-bg);\n    border-left: 10px solid var(--fail-red);\n}\n\n.python-message.test.pass {\n    background-color: var(--pass-green-bg);\n    border-left: 10px solid var(--pass-green);\n}\n\n.icon {\n    width: 20px;\n    margin-right: 0.75em;\n    position: relative;\n    top: 2px;\n}\n.error .icon { fill: var(--error-red); }\n.warning .icon { fill: var(--warn-yellow); }\n.test .icon { fill: var(--fail-red); }\n.test.pass .icon { fill: var(--pass-green); }\n.message .icon { fill: var(--info-blue); }\n\n.message-box {\n    color: #444;\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n}\n#message { \n    flex: 1; \n    align-content: center;\n    font-size: 14px;\n}\n\n#status {\n    font-size: 70%;\n    border-radius: 8px;\n    background-color: var(--fail-red);\n    padding: 0 1.5em;\n    font-weight: bold;\n    color: white;\n    width: 40px;\n    height: 16px;\n    line-height: 16px;\n    text-align: center;\n    align-self: center;\n    display: none;\n}\n.test #status { display: block;}\n.test.pass #status { background-color: var(--pass-green); }\n\n.details-box {\n    display: flex;\n}\n.details-box.hidden {\n    display: none;\n}\n#details {\n    line-height: 150%;\n    font-size: 11px;\n    margin-left: 2.5em;\n    margin-right: 1em;\n    background-color: var(--error-red-bg);\n    padding: 1em;\n    overflow-x: auto;\n    flex: 1;\n}\n\n.view-btn {\n    outline: none;\n    border: none;\n    background-color: transparent;\n    border-radius: 0.5em;\n    width: 3em;\n    height: 2em;\n    padding: 0 0.9rem;\n    display: none;\n}\n.error .view-btn { display: block; }\n.error .view-btn.hidden { display: none; }\n.view-btn:hover { background-color: #0001; }\n\n\n.infoLinks {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    width: 65px;\n    margin-left: 1rem;\n}\n\n.infoLinks a {\n    width: 22px;\n    filter: grayscale(100%);\n    text-decoration: none;\n}\n.infoLinks a.ggl-search { width: 20px; }\n.infoLinks a:hover { filter: none; }\n");class se extends HTMLElement{static DefineElement(){customElements.define("python-message",se)}constructor(){super(),this.pass=!1,this.type="message",this.message="",this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(ne);const e=document.createElement("template");e.innerHTML='<div class="python-message">\n    <div class="message-box">\n        <div class="icon"></div>\n\n        <div id="message"></div>\n\n        <div id="status">PASSED</div>\n\n        <button id="collapse-button" class="view-btn hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                <path d="M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z"/>\n            </svg>\n        </button>\n        <button id="expand-button" class="view-btn">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                <path d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/>\n            </svg>\n        </button>\n    </div>\n    <div class="details-box hidden">\n        <pre id="details">No stack trace available.</pre>\n        <div class="infoLinks">\n            <a class="ggl-search" target="_blank" rel="noreferrer" title="Search for error on Google"></a>\n            <a class="ddg-search" target="_blank" rel="noreferrer" title="Search for error on DuckDuckGo"></a>\n            \x3c!--\n             <a className={ styles.ddg }\n              target="_blank"\n              rel="noreferrer"\n              href={ "//duckduckgo.com?q=" + error?.name + " " + error?.message } \n              data-tooltip="search for error message on DuckDuckGo">\n            &nbsp;\n            </a>\n            --\x3e\n        </div>\n    </div>\n</div>',this.root.appendChild(e.content.cloneNode(!0)),this.setHTML(".ggl-search",'<svg viewBox="0 0 533.5 544.3" xmlns="http://www.w3.org/2000/svg"><path d="M533.5 278.4c0-18.5-1.5-37.1-4.7-55.3H272.1v104.8h147c-6.1 33.8-25.7 63.7-54.4 82.7v68h87.7c51.5-47.4 81.1-117.4 81.1-200.2z" fill="#4285f4"/><path d="M272.1 544.3c73.4 0 135.3-24.1 180.4-65.7l-87.7-68c-24.4 16.6-55.9 26-92.6 26-71 0-131.2-47.9-152.8-112.3H28.9v70.1c46.2 91.9 140.3 149.9 243.2 149.9z" fill="#34a853"/><path d="M119.3 324.3c-11.4-33.8-11.4-70.4 0-104.2V150H28.9c-38.6 76.9-38.6 167.5 0 244.4l90.4-70.1z" fill="#fbbc04"/><path d="M272.1 107.7c38.8-.6 76.3 14 104.4 40.8l77.7-77.7C405 24.6 339.7-.8 272.1 0 169.2 0 75.1 58 28.9 150l90.4 70.1c21.5-64.5 81.8-112.4 152.8-112.4z" fill="#ea4335"/></svg>'),this.setHTML(".ddg-search",'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg viewBox="0 0 256 255" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid">\n    <defs>\n        <linearGradient x1="71.0046292%" y1="100%" x2="0%" y2="100%" id="linearGradient-1">\n            <stop stop-color="#394A9F" offset="0%"></stop>\n            <stop stop-color="#6176B9" offset="100%"></stop>\n        </linearGradient>\n    </defs>\n\t<g>\n\t\t<path d="M128.145,18.841 C188.147,18.841 236.788,67.482 236.788,127.484 C236.788,187.485 188.147,236.126 128.145,236.126 C68.144,236.126 19.503,187.485 19.503,127.484 C19.503,67.482 68.144,18.841 128.145,18.841" fill="#DE5833"></path>\n\t\t<path d="M128.143,254.922 C198.526,254.922 255.583,197.865 255.583,127.482 C255.583,57.099 198.526,0.042 128.143,0.042 C57.76,0.042 0.703,57.099 0.703,127.482 C0.703,197.865 57.76,254.922 128.143,254.922 L128.143,254.922 Z M128.143,244.302 C63.625,244.302 11.323,192 11.323,127.482 C11.323,62.964 63.625,10.662 128.143,10.662 C192.661,10.662 244.963,62.964 244.963,127.482 C244.963,192 192.661,244.302 128.143,244.302 L128.143,244.302 Z" fill="#DE5833"></path>\n\t\t<g transform="translate(66.000000, 42.000000)">\n\t\t\t<path d="M9.219,12.13 C9.198,10.303 10.525,9.28 12.288,8.563 C11.481,8.695 10.708,8.897 10.012,9.209 C8.174,10.042 6.8,13.196 6.813,14.689 C15.736,13.787 28.931,14.411 38.58,17.291 C39.292,17.191 40.004,17.091 40.727,17.008 C31.103,12.735 19.661,11.085 9.219,12.13" fill="#D5D7D8"></path>\n\t\t\t<path d="M11.048,1.15 C11.249,1.114 11.453,1.089 11.655,1.055 C9.73,1.294 8.715,1.982 7.27,2.219 C8.839,2.358 14.784,5.133 18.52,6.659 C19.044,6.46 19.516,6.239 19.901,5.978 C17.964,5.692 13.151,1.342 11.048,1.15" fill="#D5D7D8"></path>\n\t\t\t<path d="M20.326,22.756 C19.791,22.962 19.283,23.177 18.843,23.408 C4.298,31.071 -2.127,48.97 1.702,70.418 C5.197,89.936 19.522,156.623 26.081,187.989 C27.996,188.662 29.934,189.287 31.896,189.854 C26.055,161.614 10.112,87.614 6.392,66.831 C2.621,45.688 6.29,30.517 20.326,22.756" fill="#D5D7D8"></path>\n\t\t\t<path d="M79.184,176.618 C78.944,176.778 78.658,176.928 78.353,177.074 C78.127,177.95 77.782,178.614 77.279,178.948 C74.275,180.941 65.79,181.945 61.31,180.941 C60.539,180.77 59.955,180.487 59.499,180.098 C51.85,184.345 40.85,189.999 38.616,188.725 C35.126,186.724 34.62,160.274 35.126,153.783 C35.495,148.883 52.707,156.82 61.08,160.983 C62.931,159.254 67.466,158.097 71.48,157.704 C65.415,142.943 60.942,126.059 63.684,114.086 C59.894,111.445 54.871,105.32 55.917,98.927 C56.723,94.061 69.297,84.855 78.2,84.299 C87.123,83.736 89.904,83.863 97.338,82.083 C97.71,81.994 98.119,81.896 98.547,81.793 C103.123,65.706 92.148,37.719 79.906,25.472 C75.915,21.481 69.779,18.969 62.865,17.643 C60.206,13.994 55.917,10.505 49.845,7.274 C38.57,1.288 24.636,-1.149 11.655,1.055 C11.453,1.089 11.249,1.114 11.048,1.15 C13.151,1.342 17.964,5.692 19.901,5.978 C19.516,6.239 19.044,6.46 18.52,6.659 C16.702,7.351 14.231,7.771 12.288,8.563 C10.525,9.28 9.198,10.303 9.219,12.13 C19.661,11.085 31.103,12.735 40.727,17.008 C40.004,17.091 39.292,17.191 38.58,17.291 C31.755,18.251 25.482,20.019 20.95,22.41 C20.737,22.521 20.535,22.641 20.326,22.756 C6.29,30.517 2.621,45.688 6.392,66.831 C10.112,87.614 26.1589994,162.759995 31.9999994,190.999995 C41.6029994,193.778995 50.5819993,195.999995 61.0799993,195.999995 C69.9919993,195.999995 80.7110013,194.024995 89.0000013,191.999995 C86.0890013,186.386995 82.344,180.18 80.036,175.729 C79.728,176.096 79.485,176.417 79.184,176.618 Z M85.057,70.057 C81.253,70.057 78.15,66.963 78.15,63.137 C78.15,59.329 81.253,56.234 85.057,56.234 C88.882,56.234 91.973,59.329 91.973,63.137 C91.973,66.963 88.882,70.057 85.057,70.057 L85.057,70.057 Z M89.218,44.049 C89.218,44.049 84.861,41.56 81.48,41.602 C74.532,41.693 72.64,44.763 72.64,44.763 C72.64,44.763 73.806,37.445 82.691,38.913 C87.508,39.714 89.218,44.049 89.218,44.049 L89.218,44.049 Z M15.963,53.046 C15.963,53.046 12.834,46.073 21.173,42.656 C29.521,39.238 33.586,44.601 33.586,44.601 C33.586,44.601 27.524,41.859 21.63,45.563 C15.746,49.263 15.963,53.046 15.963,53.046 L15.963,53.046 Z M23.253,67.908 C23.253,63.462 26.848,59.864 31.3,59.864 C35.74,59.864 39.34,63.462 39.34,67.908 C39.34,72.355 35.74,75.949 31.3,75.949 C26.848,75.951 23.253,72.355 23.253,67.908 L23.253,67.908 Z" fill="#FFFFFF"></path>\n\t\t\t<path d="M39.34,67.908 C39.34,63.462 35.74,59.864 31.3,59.864 C26.848,59.864 23.253,63.462 23.253,67.908 C23.253,72.355 26.848,75.951 31.3,75.949 C35.74,75.949 39.34,72.355 39.34,67.908 L39.34,67.908 Z M34.862,67.317 C33.72,67.32 32.781,66.381 32.781,65.227 C32.781,64.07 33.717,63.139 34.862,63.139 C36.016,63.139 36.952,64.07 36.952,65.227 C36.952,66.381 36.016,67.317 34.862,67.317 L34.862,67.317 Z" fill="#2D4F8E"></path>\n\t\t\t<path d="M34.862,63.139 C33.717,63.139 32.781,64.07 32.781,65.227 C32.781,66.381 33.72,67.32 34.862,67.317 C36.016,67.317 36.952,66.381 36.952,65.227 C36.952,64.07 36.016,63.139 34.862,63.139" fill="#FFFFFF"></path>\n\t\t\t<path d="M85.057,56.234 C81.253,56.234 78.15,59.329 78.15,63.137 C78.15,66.963 81.253,70.057 85.057,70.057 C88.882,70.057 91.973,66.963 91.973,63.137 C91.973,59.329 88.882,56.234 85.057,56.234 L85.057,56.234 Z M88.124,62.628 C87.149,62.628 86.344,61.835 86.344,60.839 C86.344,59.856 87.149,59.049 88.124,59.049 C89.141,59.049 89.921,59.856 89.921,60.839 C89.921,61.835 89.141,62.628 88.124,62.628 L88.124,62.628 Z" fill="#2D4F8E"></path>\n\t\t\t<path d="M88.124,59.049 C87.149,59.049 86.344,59.856 86.344,60.839 C86.344,61.835 87.149,62.628 88.124,62.628 C89.141,62.628 89.921,61.835 89.921,60.839 C89.921,59.856 89.141,59.049 88.124,59.049" fill="#FFFFFF"></path>\n\t\t\t<path d="M33.586,44.601 C33.586,44.601 29.521,39.238 21.173,42.656 C12.834,46.073 15.963,53.046 15.963,53.046 C15.963,53.046 15.746,49.263 21.63,45.563 C27.524,41.859 33.586,44.601 33.586,44.601" fill="url(#linearGradient-1)"></path>\n\t\t\t<path d="M82.691,38.913 C73.806,37.445 72.64,44.763 72.64,44.763 C72.64,44.763 74.532,41.693 81.48,41.602 C84.861,41.56 89.218,44.049 89.218,44.049 C89.218,44.049 87.508,39.714 82.691,38.913" fill="url(#linearGradient-1)"></path>\n\t\t\t<path d="M78.2,84.299 C69.297,84.855 56.723,94.061 55.917,98.927 C54.871,105.32 59.894,111.445 63.684,114.086 C63.694,114.093 63.705,114.102 63.715,114.109 C67.504,116.745 92.733,125.256 105.25,125.02 C117.781,124.776 138.361,117.102 136.101,110.953 C133.851,104.802 113.412,116.38 92.094,114.404 C76.306,112.937 73.519,105.864 77.015,100.698 C81.412,94.205 89.421,101.93 102.631,97.977 C115.861,94.035 134.363,86.979 141.228,83.137 C157.101,74.288 134.586,70.618 129.268,73.073 C124.227,75.402 106.681,79.83 98.547,81.793 C98.119,81.896 97.71,81.994 97.338,82.083 C89.904,83.863 87.123,83.736 78.2,84.299" fill="#FDD209"></path>\n\t\t</g>\n\t\t<g transform="translate(100.000000, 189.000000)">\n\t\t\t<path d="M24.316,17.97 C24.316,17.049 25.057,16.234 26.233,15.539 C26.266,14.98 26.57,14.46 27.08,13.983 C18.707,9.82 1.495,1.883 1.126,6.783 C0.62,13.274 1.126,39.724 4.616,41.725 C6.85,42.999 17.85,37.345 25.499,33.098 C23.292,31.217 24.316,26.651 24.316,17.97" fill="#65BC46"></path>\n\t\t\t<path d="M45.925,28.686 C45.961,28.7 46,28.715 46.036,28.729 C52.89,31.374 66.534,36.353 69.497,35.266 C73.492,33.739 72.492,1.813 68.008,0.796 C64.416,-0.001 50.665,9.688 45.255,13.635 C46.212,17.676 47.37,25.68 45.925,28.686" fill="#65BC46"></path>\n\t\t\t<path d="M29.214,31.611 C24.719,30.615 26.221,26.118 26.221,15.64 C26.221,15.606 26.231,15.573 26.233,15.539 C25.057,16.234 24.316,17.049 24.316,17.97 C24.316,26.651 23.292,31.217 25.499,33.098 C25.955,33.487 26.539,33.77 27.31,33.941 C31.79,34.945 40.275,33.941 43.279,31.948 C43.782,31.614 44.127,30.95 44.353,30.074 C40.837,31.758 33.329,32.547 29.214,31.611" fill="#43A244"></path>\n\t\t\t<path d="M27.08,13.983 C26.57,14.46 26.266,14.98 26.233,15.539 C26.231,15.573 26.221,15.606 26.221,15.64 C26.221,26.118 24.719,30.615 29.214,31.611 C33.329,32.547 40.837,31.758 44.353,30.074 C44.658,29.928 44.944,29.778 45.184,29.618 C45.485,29.417 45.728,29.096 45.925,28.686 C47.37,25.68 46.212,17.676 45.255,13.635 C45.044,12.746 44.844,12.046 44.683,11.636 C44.27,10.614 41.089,10.351 37.48,10.704 C33.466,11.097 28.931,12.254 27.08,13.983" fill="#65BC46"></path>\n\t\t</g>\n\t</g>\n</svg>')}connectedCallback(){this.message=this.root.host.innerHTML.trim(),this.setFields(),this.root.querySelector("#expand-button")?.addEventListener("pointerup",(e=>{this.addClass("#expand-button","hidden"),this.removeClass("#collapse-button","hidden"),this.removeClass(".details-box","hidden")})),this.root.querySelector("#collapse-button")?.addEventListener("pointerup",(e=>{this.removeClass("#expand-button","hidden"),this.addClass("#collapse-button","hidden"),this.addClass(".details-box","hidden")}))}disconnectedCallback(){}attributeChangedCallback(e,t,n){n!==t&&("type"===e&&["message","error","warning","test"].includes(n)?this.type=n:"pass"===e?this.pass="true"===n:"details"===e&&(this.details=n),this.setFields())}setFields(){this.addClass(".python-message",this.type),this.setHTML("#message",this.message),this.setHTML("#details",this.details?this.details:"No stack trace available."),this.pass&&this.addClass(".python-message","pass"),this.setHTML("#status",this.pass?"PASSED":"FAILED"),"message"===this.type?this.setHTML(".icon",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n    \x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e\n    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/>\n</svg>'):"warning"===this.type?this.setHTML(".icon",'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512">\n  <path fill="white" d="M258,108c10.5,0,20.3,5.6,25.6,14.7l160.3,273.1c5.4,9.2,5.4,20.6.1,29.8s-15.1,14.9-25.8,14.9H97.7c-10.6,0-20.5-5.7-25.8-14.9s-5.2-20.6.1-29.8L232.4,122.7c5.3-9.1,15.1-14.7,25.6-14.7Z"/>\n  <path d="M256,32c14.2,0,27.3,7.5,34.5,19.8l216,368c7.3,12.4,7.3,27.7.2,40.1s-20.4,20.1-34.7,20.1H40c-14.3,0-27.6-7.7-34.7-20.1s-7-27.8.2-40.1L221.5,51.8c7.2-12.3,20.3-19.8,34.5-19.8ZM256,160c-13.3,0-24,10.7-24,24v112c0,13.3,10.7,24,24,24s24-10.7,24-24v-112c0-13.3-10.7-24-24-24ZM288,384c0-17.7-14.3-32-32-32s-32,14.3-32,32,14.3,32,32,32,32-14.3,32-32Z"/>\n</svg>'):"error"===this.type?this.setHTML(".icon",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n    <circle cx="256" cy="256" r="250" fill="white"/>\n    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>\n</svg>'):"test"===this.type&&this.pass?this.setHTML(".icon",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n    \x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e\n    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>\n</svg>'):"test"===this.type&&this.setHTML(".icon",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n    \x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e\n    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/>\n</svg>');const e=encodeURI(`q=${this.message.replace(/<[^>]*>?/gm,"")}`);this.root.querySelector(".ddg-search")?.setAttribute("href","//duckduckgo.com?"+e),this.root.querySelector(".ggl-search")?.setAttribute("href","//google.com?"+e)}setHTML(e,t){const n=this.root.querySelector(e);n&&(n.innerHTML=t)}addClass(e,t){const n=this.root.querySelector(e);n&&n.classList.add(t)}removeClass(e,t){const n=this.root.querySelector(e);n&&n.classList.remove(t)}}se.observedAttributes=["type","pass","details"];const ie=new CSSStyleSheet;ie.replaceSync("/*\n * TunePad\n * Northwestern University\n * michael-horn@northwestern.edu\n *\n * This project was funded by the National Science Foundation (grant DRL-1612619).\n * Any opinions, findings and conclusions or recommendations expressed in this\n * material are those of the author(s) and do not necessarily reflect the views\n * of the National Science Foundation (NSF).\n */\n :host {\n    --output-badge-color: #87c44e;\n }\n\n.python-output {\n    background-color: white;\n    color: #444;\n    font-size: 12px;\n    margin: 0.25em 0;\n    padding: 10px;\n    border-left: 10px solid var(--output-badge-color);\n}\n\n.toolbar {\n    font-size: 14px;\n    display: flex;\n    line-height: 2em;\n}\n\n.expander {\n    flex: 1;\n}\n\n.view-btn {\n    outline: none;\n    border: none;\n    background-color: transparent;\n    border-radius: 0.5em;\n    width: 3em;\n    height: 2em;\n    padding: 0 0.9rem;\n    display: block;\n}\n.view-btn:hover { background-color: #0001; }\n.view-btn.hidden { display: none; }\n\n#output-container {\n    max-height: 250px;\n    font-family: monospace;\n    overflow-y: auto;\n    line-height: 140%;\n    padding: 1em;\n    text-wrap: wrap;\n    font-size: 12px;\n    background-color: #eee;\n    display: block;\n    box-shadow: 0 0 3px inset #0003;\n}\n#output-container.hidden { display: none; }\n\n.counter {\n    color: white;\n    background-color: var(--output-badge-color);\n    font-size: 90%;\n    border-radius: 0.65em;\n    margin-right: 1em;\n    text-align: center;\n    height: 20px;\n    min-width: 1.5em;\n    line-height: 20px;\n    padding: 0 0.4em;\n    align-self: center;\n}");class ae extends HTMLElement{static DefineElement(){customElements.define("python-output",ae)}constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(ie);const e=document.createElement("template");e.innerHTML='<div class="python-output">\n    <div class="toolbar">\n        <div class="counter"></div>\n        Python Output\n        <div class="expander"></div>\n        <button id="collapse-button" class="view-btn hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                <path d="M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z"/>\n            </svg>\n        </button>\n        <button id="expand-button" class="view-btn">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                <path d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/>\n            </svg>\n        </button>\n    </div>\n    <pre id="output-container" class="hidden">Output Uo</pre>\n</div>\n',this.root.appendChild(e.content.cloneNode(!0))}connectedCallback(){const e=this.root.host.innerHTML.trim(),t=e.split("\n").length;this.setHTML("#output-container",e),this.setHTML(".counter",`${t}`),this.root.querySelector(".toolbar")?.addEventListener("pointerup",(e=>{this.toggleClass("#expand-button","hidden"),this.toggleClass("#collapse-button","hidden"),this.toggleClass("#output-container","hidden")}))}disconnectedCallback(){}setHTML(e,t){const n=this.root.querySelector(e);n&&(n.innerHTML=t)}toggleClass(e,t){const n=this.root.querySelector(e);n&&n.classList.toggle(t)}addClass(e,t){const n=this.root.querySelector(e);n&&n.classList.add(t)}removeClass(e,t){const n=this.root.querySelector(e);n&&n.classList.remove(t)}}ae.observedAttributes=[];const oe=new CSSStyleSheet;oe.replaceSync(".code-view-wrapper {\n    overflow: hidden;\n    position: relative;\n    background-color: #e3e9f2;\n}\n\n.code-view-wrapper.light { background-color: #e3e9f2; }\n.code-view-wrapper.dark { background-color: #2E303F; }\n\n@media print {\n    .buttons { display: none; }\n}\n\n@keyframes spin-animation {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(359deg);\n    }\n}");const re=new CSSStyleSheet;re.replaceSync("/*\n * TunePad\n * Northwestern University\n * michael-horn@northwestern.edu\n *\n * This project was funded by the National Science Foundation (grant DRL-1612619).\n * Any opinions, findings and conclusions or recommendations expressed in this\n * material are those of the author(s) and do not necessarily reflect the views\n * of the National Science Foundation (NSF).\n */\n:host {\n    --error-red: #da575d;\n    --error-red-bg: #f9e4e5;\n    --fail-red: #da575d;\n    --fail-red-bg: #f9e4e5;\n    --info-blue: #4b90d7;\n    --pass-green: green;\n    --pass-green-bg: #ded;\n    --warn-yellow: orange;\n    --warn-yellow-bg: #fed;\n    --output-badge-color: #87c44e;\n    --error-badge-color: #da575d;\n    --warn-badge-color: orange;\n    --fail-badge-color: #da575d;\n    --pass-badge-color: green;\n    --piano-color: #2f9aef;\n    --guitar-color: #f0c229;\n    --marimba-color: #f6843f;\n    --sequencer-color: #f6843f;\n    --bass-color: #ec5eb2;\n    --drum-color: #86c44e;\n    --sound-color: lightseagreen;\n    --text-color: #30acac;\n    --definitions-color: #996dd9;\n    --cell-header-bg-color: #2e303f;\n}\n");class he extends HTMLElement{get code(){return this.editor.code}set initialContent(e){this.editor.initialContent=e}constructor(){super(),this.uuid=self.crypto.randomUUID(),this.name="tunepad-editor",this._preloaded=!1,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(re),this.root.adoptedStyleSheets.push(oe);const e=document.createElement("template");e.innerHTML='<div class="code-view-wrapper">\n    <div class="codemirror-container"></div>\n    <div class="message-wrapper">\n        <div id="errors"></div>\n        <div id="warnings"></div>\n        <div id="messages"></div>\n        <div id="tests"></div>\n        <div id="output"></div>\n    </div>\n</div>\n',this.root.appendChild(e.content.cloneNode(!0)),this.editor=document.createElement("python-editor")}async connectedCallback(){this.editor.innerHTML=this.innerHTML,this.root.querySelector(".codemirror-container")?.appendChild(this.editor)}disconnectedCallback(){}attributeChangedCallback(e,t,n){"name"===e?this.name=n:"uuid"===e?this.uuid=n:"readonly"===e?this.editor.setAttribute("readonly",`${"true"===n}`):"theme"===e&&(this.editor.setAttribute("theme",n),this.removeClass(".code-view-wrapper",t),this.addClass(".code-view-wrapper",n))}set errors(e){this.setHTML("#errors",""),e.forEach((e=>{let t=`<b>${e.name}:</b> ${e.message}`;e.line>0&&(t+=` on line ${e.line}`);const n=document.createElement("python-message");n.setAttribute("type","error"),e.details&&n.setAttribute("details",e.details),n.innerHTML=t,this.root.querySelector("#errors")?.appendChild(n)}));const t=e.filter((e=>e.line>0)).map((e=>({line:e.line,message:`${e.name}: ${e.message}`})));this.editor.setMarkers(t,"error")}set warnings(e){this.setHTML("#warnings",""),e.forEach((e=>{let t=`<b>${e.name}:</b> ${e.message}`;e.line>0&&(t+=` on line ${e.line}`);const n=document.createElement("python-message");n.setAttribute("type","warning"),n.innerHTML=t,this.root.querySelector("#warnings")?.appendChild(n)}));const t=e.filter((e=>e.line>0)).map((e=>({line:e.line,message:`${e.name}: ${e.message}`})));this.editor.setMarkers(t,"warning")}set unitTests(e){this.setHTML("#tests",""),e.forEach((e=>{const t=document.createElement("python-message");t.setAttribute("type","test"),t.setAttribute("pass",`${"pass"===e.params.get("type")}`),t.innerHTML=u(e.params.get("message"),""),this.root.querySelector("#tests")?.appendChild(t)}))}set messages(e){this.setHTML("#messages",""),e.forEach((e=>{const t=document.createElement("python-message");t.setAttribute("type","message"),t.innerHTML=u(e.params.get("message"),""),this.root.querySelector("#messages")?.appendChild(t)}))}set output(e){if(this.setHTML("#output",""),e.length>0){const t=document.createElement("python-output");t.innerHTML=e.join("\n"),this.root.querySelector("#output")?.appendChild(t)}}bindCollaboration(e,t){this.editor.bindCollaboration(e,t)}async recompile(){j.init(),this._preloaded||(await j.preload(this),this._preloaded=!0);const e=await j.compile(this);return this.errors=e.errors,this.output=e.output,this.messages=e.trace.messages,this.unitTests=e.trace.unitTests,e}setHTML(e,t){const n=this.root.querySelector(e);n&&(n.innerHTML=t)}addClass(e,t){const n=this.root.querySelector(e);n&&n.classList.add(t)}removeClass(e,t){const n=this.root.querySelector(e);n&&n.classList.remove(t)}}he.ELEMENT="tunepad-python-editor",he.observedAttributes=["uuid","name","readonly","theme"];const ce=new CSSStyleSheet;ce.replaceSync("#scroll-container {\n    overflow-x: auto;\n    overflow-y: hidden;\n    width: 100%;\n    height: 50px;\n    position: relative;\n}\n\n#status {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    background-color: #0009;\n    top: 0;\n    left: 0;\n    z-index: 10;\n    color: white;\n    padding: 2rem;\n    font-size: 15px;\n    display: none;\n}\n#status.show { display: block; }\n\n.dark #timeline { background-color: #414251; }\n.light #timeline { background-color: #dce3ef; }\n\n\n/* String foreground = \"#ddd\"; */\n.playhead {\n    /*        fill: #82838C; */\n    fill: orange;\n}\n\n.dark .ruler { fill: #2E303F; }\n.light .ruler { fill: transparent; }\n\n.ruler-marks {\n    text-anchor: start;\n    font-family: 'Proxima Nova', sans-serif;\n    font-size: 10px;\n    dominant-baseline: middle;\n    pointer-events: none;\n    user-select: none;\n}\n\n.beat-line {\n    stroke-opacity: 0.15;\n    stroke-width: 1.0;\n}\n\n.beat-line.measure {\n    stroke-opacity: 0.3;\n    stroke-width: 2;\n}\n\n.dark .ruler-marks { fill: #ccc; }\n.dark .beat-line { stroke: #ccc; }\n.light .ruler-marks { fill: #000a; }\n.light .beat-line { stroke: #000a; }\n\n\n.timeline-waveform { fill: var(--piano-color); }\n.piano .timeline-waveform { fill: var(--piano-color); }\n.guitar .timeline-waveform { fill: var(--guitar-color); }\n.marimba .timeline-waveform { fill: var(--marimba-color); }\n.bass .timeline-waveform { fill: var(--bass-color); }\n.drum .timeline-waveform { fill: var(--drum-color); }\n.sound .timeline-waveform { fill: var(--sound-color); }\n\n.waveline { stroke: black; stroke-width: 2; }");class le extends HTMLElement{get beats(){return Math.max(this._beats,this.measure)}get beatWidth(){return Math.max(40,this.width/this.beats)}get traceWidth(){return this.beatWidth*this.beats}get pixelsPerSecond(){return this.traceWidth/(this.beats*this.tempo/60)}get scoreHeight(){return this.height-this.rulerHeight}set waveform(e){this._waveform=e,this.render()}constructor(){super(),this._beats=4,this.measure=4,this.tempo=90,this.view="waveform",this.theme="light",this.width=700,this.height=100,this.rulerHeight=20,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(ce),this.root.adoptedStyleSheets.push(re);const e=document.createElement("template");e.innerHTML='<div id="scroll-container">\n    <div id="status"></div>\n    <div id="container" class="light">\n        <svg id="timeline" version="1.1"></svg>\n    </div>\n</div>',this.root.appendChild(e.content.cloneNode(!0)),this.audio=w.init(),this.svg=this.root.querySelector("#timeline")}beatToX(e){return e*this.beatWidth}connectedCallback(){window.addEventListener("resize",(e=>this.render())),this.render()}disconnectedCallback(){}attributeChangedCallback(e,t,n){if(t!==n)if("beats"===e)this._beats=c(n,this.beats),this.render();else if("measure"===e)this.measure=Math.max(1,c(n,this.measure)),this.render();else if("view"===e&&["midi","waveform"].includes(n))this.view=n,this.render();else if("tempo"===e)this.tempo=c(n,this.tempo),this.render();else if("theme"===e&&["dark","light"].includes(n))this.theme=n,this.root.querySelector("#container")?.classList.remove(t),this.root.querySelector("#container")?.classList.add(n);else if("status"===e){const e=this.root.querySelector("#status");e&&n?(e.innerHTML=n,e.classList.add("show")):e&&(e.innerHTML="",e.classList.remove("show"))}}render(){this.resize(),this.svg.innerHTML="";const e=document.createElementNS("http://www.w3.org/2000/svg","g"),t=this.renderRuler();e.append(t),this._waveform&&e.append(this.renderWaveform(this._waveform)),this.svg.append(e)}renderRuler(){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.classList.add("ruler"),t.setAttribute("x",`${this.beatToX(0)}`),t.setAttribute("y","0"),t.setAttribute("width",`${this.traceWidth}`),t.setAttribute("height",`${this.rulerHeight}`),e.append(t);for(let t=1;t<=this.beats;t++){let n=this.beatToX(t-1);const s=document.createElementNS("http://www.w3.org/2000/svg","text");if(s.classList.add("ruler-marks"),s.setAttribute("x",`${n+5}`),s.setAttribute("y",""+this.rulerHeight/2),s.innerHTML=1===t?"BEAT":`${t}`,e.append(s),1===t)continue;const i=document.createElementNS("http://www.w3.org/2000/svg","line");i.classList.add("beat-line"),i.setAttribute("x1",`${n}`),i.setAttribute("y1","0"),i.setAttribute("x2",`${n}`),i.setAttribute("y2",`${this.height}`),(t-1)%this.measure==0&&i.classList.add("measure"),e.append(i)}return e}renderWaveform(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=e.wavepath;return n&&(n.classList.add("timeline-waveform"),t.setAttribute("transform",`translate(0, ${this.height/2}), scale(${this.pixelsPerSecond}, ${this.scoreHeight/2})`),t.append(n)),t}resize(){const e=this.root.querySelector("#scroll-container"),t=this.root.querySelector("#container");t&&e&&(this.width=e.getBoundingClientRect().width,this.height=e.getBoundingClientRect().height,console.log(this.width,this.height),t.style.width=`${this.traceWidth}px`,this.svg.setAttribute("viewBox",`0 0 ${this.traceWidth} ${this.height}`))}}le.ELEMENT="tunepad-timeline",le.observedAttributes=["beats","measure","tempo","theme","status","view"];const de=new CSSStyleSheet;de.replaceSync(".cell-wrapper {\n    border-radius: 10px;\n    max-width: 750px;\n    min-width: 400px;\n    padding: 0 8px;\n    background-color: #946161;\n    margin-bottom: 3rem;\n    position: relative;\n}\n\nheader {\n    background-color: var(--cell-header-bg-color);\n    height: 60px;\n    border-top: 2px solid #667;\n    border-bottom: 2px solid #667;\n    border-left: 2px solid #414252;\n    border-right: 2px solid #414252;\n    padding: 10px 10px 10px 15px;\n    box-sizing: border-box;\n    display: flex;\n}\n\n.gadget-icon {\n    width: 35px;\n    height: 35px;\n    background-color: var(--piano-color);\n    border-radius: 50%;\n    margin-right: 10px;\n    background-image: url(/images/instruments/synth.svg);\n    background-size: 70%;\n    background-repeat: no-repeat;\n    background-position: center;\n}\n.definitions .gadget-icon {\n    background-color: var(--definitions-color);\n    background-image: url(/images/instruments/definitions.svg);\n}\nheader .gadget-name {\n    width: 100%;\n    max-width: 450px;\n    color: white;\n    font-weight: bold;\n    font-family: var(--main-font);\n    font-size: 15px;\n    border: 1px solid transparent;\n    outline: none;\n    background-color: transparent;\n    padding: 2px 5px;\n    position: relative;\n    top: -5px;\n    border-radius: 3px;\n}\nheader .gadget-name:hover {\n    background-color: #fff2;\n    border: 1px solid #fff6;\n}\nheader .gadget-name:focus {\n    background-color: #fffd;\n    color: #333;\n    font-weight: normal;\n    border: 1px solid black;\n}\nheader .gadget-info {\n    color: #fff8;\n    font-size: 11px;\n    font-weight: normal;\n    padding-left: 7px;\n    position: relative;\n    top: -8px;\n}\n#uncompiled {\n    color: white;\n    font-weight: bold;\n    font-size: 120%;\n}\n\n.badges {\n    display: flex;\n    align-items: center;\n}\n.badge {\n    min-width: 30px;\n    text-align: center;\n    margin: 0 0.25rem;\n}\n.badge svg { \n    width: 25px;\n    height: 25px;\n    vertical-align: middle;\n}\n.badge#error-badge svg { fill: var(--error-badge-color); }\n.badge#warning-badge svg { fill: var(--warn-badge-color); }\n.badge#pass-badge svg,\n.badge#fail-badge svg { \n    fill: white; \n    width: 15px; height: 15px;\n    position: relative;\n    top: -1px;\n}\n.badge#pass-badge {\n    background-color: var(--pass-badge-color);\n    border-radius: 0.75em;\n    padding: 0.2em 0.4em;\n    color: white;\n}\n.badge#fail-badge {\n    background-color: var(--fail-badge-color);\n    border-radius: 0.75em;\n    padding: 0.2em 0.4em;\n    color: white;\n}\n.badge#output-badge { \n    background-color: var(--output-badge-color);\n    color: white;\n    border-radius: 0.75em;\n    min-width: 1.5em;\n    padding: 0.2em 0.4em;\n}\n.badge.hidden { display: none; }\n\nfooter, .toolbar {\n    display: flex;\n    background-color: #535563;\n    border-left: 2px solid #414252;\n    border-right: 2px solid #414252;\n    color: #fffc;\n}\n.toolbar {\n    padding: 8px 10px;\n    line-height: 34px;\n}\nfooter {\n    padding: 3px 20px;\n}\n\n.autocompile-status {\n    font-size: 90%;\n    line-height: 30px;\n}\n\n.expander { flex: 1; }\n\n.toolbar button {\n    outline: none;\n    border: 2px solid #9194A1;\n    color: rgba(255, 255, 255, 0.75);\n    background-color: #fff2;\n    box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1);\n    width: 40px;\n    height: 35px;\n    border-radius: 5px;\n    margin: 3px;\n    font-size: 14px;\n    text-align: center;\n    white-space: nowrap;\n    transition: all 100ms ease-out;\n}\n.toolbar button svg { \n    width: 17px;\n    height: 17px; \n    fill: rgba(255, 255, 255, 0.75);; \n    vertical-align: middle;\n}\n.toolbar button:active { background-color: rgba(255, 255, 255, 0.45); }\n.toolbar button:hover { border: 2px solid #DDD; }\n.toolbar button.hidden { display: none; }\n.toolbar button:disabled svg { fill: #fff3; }\n.toolbar button:disabled:hover { border: 2px solid #9194A1; }\n.toolbar button:disabled:active { background-color: #fff2; }\n\n#loader svg {\n    animation: spin-animation 2s infinite;\n    animation-timing-function: linear;\n}\n.module-name {\n    font-family: monospace;\n    font-weight: normal;\n    font-size: 11px;\n    color: #fffc;\n    flex: 1;\n    text-align: left;\n}\n.cell-contents {\n    padding: 0 12px;\n    border-left: 2px solid #414252;\n    border-right: 2px solid #414252;\n    background-color: #535563;\n    position: relative;\n}\n\nfooter button {\n    outline: none;\n    border: none;\n    color: rgba(255, 255, 255, 0.75);\n    width: 40px;\n    height: 30px;\n    font-size: 14px;\n    background-color: transparent;\n}\nfooter button svg { \n    width: 16px;\n    height: 16px; \n    fill: rgba(255, 255, 255, 0.7);\n    vertical-align: middle;\n}\nfooter button:hover svg { fill: rgba(255, 255, 255, 0.8); }\nfooter button:active svg { fill: rgba(255, 255, 255, 0.9); }\n\n#loader-background {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 100;\n    background-color: #000a;\n    display: none;\n    align-items: center;\n    border-radius: 10px;\n}\n#loader-background.show {\n    display: flex;\n}\n.loader-text {\n    color: white;\n    text-align: center;\n    flex: 1;\n    font-size: 110%;\n}\n#loader-background img {\n    display: block;\n    margin: 1rem auto;\n    width: 90px;\n}\n@media print {\n    .buttons { display: none; }\n}\n\n@keyframes spin-animation {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(359deg);\n    }\n}\n");const ue=new CSSStyleSheet;ue.replaceSync('\n.drop-menu {\n    position: absolute;\n    background-color: white;\n    border: 1px solid #0001;\n    border-radius: 8px;\n    padding: 8px 0;\n    z-index: 100;\n    display: flex;\n    flex-direction: column;\n    min-width: 200px;\n    box-shadow: 0px 3px 5px #0005;\n    -webkit-touch-callout: none;\n    user-select: none;\n    margin: 0;\n}\n.drop-menu.hidden { display: none; }\n.drop-menu:hover { cursor: pointer; }\n.drop-menu.terminal {\n    max-height: 70vh;\n    overflow-y: auto !important;\n}\n.menu-item {\n    line-height: 140%;\n    display: flex;\n    align-items: center;\n    font-size: 14px;\n    font-weight: normal;\n    color: #3C4E60;\n    outline: none;\n    border: none;\n    padding: 5px 20px 5px 10px;\n    white-space: nowrap;\n    position: relative;\n    text-align: left;\n}\n.menu-item:hover { background: rgba(0, 0, 0, 0.15); }\n.menu-item:not(:has(.drop-menu)):active { background: rgba(0, 0, 0, 0.2); }\n.menu-item.highlight { background: rgba(0, 0, 0, 0.085); }\n.menu-item.disabled { color: #aaa; }\n.menu-item.disabled:hover { background-color: transparent; }\n.menu-item.disabled:active { background-color: transparent; }\n.menu-item.disabled .icon { opacity: 0.3; }\n.menu-item.hidden { display: none; }\n\n.menu-item:hover > .drop-menu {\n  display: flex;\n  left: 88%;\n  top: -10px;\n}\n\n.menu-item .icon {\n    width: 1.1rem;\n    height: 1.1rem;\n    margin: 0 0.85rem 0 0.5rem;\n    text-align: center;\n    opacity: 0.6;\n    background-repeat: no-repeat;\n    background-size: contain;\n    background-position: center;\n}\n.menu-item .expand {\n  text-align: right;\n  position: relative;\n  left: 5px;\n  font-size: 90%;\n  width: 2em;\n  flex: 1;\n}\n.menu-item .name {\n  flex: 1;\n}\n.menu-item .expand::before {\n  content: "▸";\n  font-size: 17px;\n  color: rgba(0,0,0,0.6);\n  font-weight: 600;\n}\n.menu-separator {\n    border-top: 1px solid #0005;\n    margin: 10px;\n    height: 2px;\n}');class pe extends HTMLElement{get code(){return this.editor.code}constructor(){super(),this.uuid=self.crypto.randomUUID(),this.name="tunepad_code",this.autocompile=!1,this.codeChanged=!1,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(re),this.root.adoptedStyleSheets.push(de),this.root.adoptedStyleSheets.push(ue);const e=document.createElement("template");e.innerHTML='<div class="cell-wrapper definitions">\n    <header>\n        <div class="gadget-icon"></div>\n        <div style="flex: 1;">\n            <input class="gadget-name">\n            <div class="gadget-info">\n                <span id="line-count"></span>\n                <span id="uncompiled"></span>\n            </div>\n        </div>\n        <div class="badges">\n            <div id="error-badge" class="badge hidden">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                    <circle cx="256" cy="256" r="250" fill="white"/>\n                    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>\n                </svg>\n            </div>\n            <div id="warning-badge" class="badge hidden">\n                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512">\n                    <path fill="white" d="M258,108c10.5,0,20.3,5.6,25.6,14.7l160.3,273.1c5.4,9.2,5.4,20.6.1,29.8s-15.1,14.9-25.8,14.9H97.7c-10.6,0-20.5-5.7-25.8-14.9s-5.2-20.6.1-29.8L232.4,122.7c5.3-9.1,15.1-14.7,25.6-14.7Z"/>\n                    <path d="M256,32c14.2,0,27.3,7.5,34.5,19.8l216,368c7.3,12.4,7.3,27.7.2,40.1s-20.4,20.1-34.7,20.1H40c-14.3,0-27.6-7.7-34.7-20.1s-7-27.8.2-40.1L221.5,51.8c7.2-12.3,20.3-19.8,34.5-19.8ZM256,160c-13.3,0-24,10.7-24,24v112c0,13.3,10.7,24,24,24s24-10.7,24-24v-112c0-13.3-10.7-24-24-24ZM288,384c0-17.7-14.3-32-32-32s-32,14.3-32,32,14.3,32,32,32,32-14.3,32-32Z"/>\n                </svg>\n            </div>\n            <div id="pass-badge" class="badge hidden">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>\n                </svg>\n                <span id="pass-count"></span>\n            </div>\n            <div id="fail-badge" class="badge hidden">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/>\n                </svg>\n                <span id="fail-count"></span>\n            </div>\n            <div id="output-badge" class="badge hidden"></div>\n        </div>\n    </header>\n    <div class="toolbar">\n        <button id="loader" title="Recompiling" disabled="disabled">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                <path d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"/>\n            </svg>\n        </button>\n        <button id="compile-button" class="hidden" title="Compile">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n                <path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/>\n            </svg>\n        </button>\n        <div class="expander"></div>\n        <button id="theme-button" title="Toggle Dark Mode">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                <path d="M448 256c0-106-86-192-192-192V448c106 0 192-86 192-192zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/>\n            </svg>\n        </button>\n        <div class="menu-container">\n            <button id="menu-trigger" title="Cell Menu...">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                    <path d="M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z"/>\n                </svg>\n            </button>\n            <context-menu>\n                <context-menu-item action="copy" name="Copy Cell" icon="/images/copy-icon.svg" disabled="true"></context-menu-item>\n                <context-menu-item action="delete" name="Delete Cell" icon="/images/trash-icon.svg" disabled="true"></context-menu-item>\n                <div class="menu-separator"></div>\n                <context-menu-item action="autocomp" checked="false" name="Autocompile" id="autocomp"></context-menu-item>\n                <context-menu-item action="readonly" checked="false" name="Readonly" id="readonly"></context-menu-item>\n            </context-menu>\n        </div>\n    </div>\n    <div class="cell-contents"></div>\n    <footer>\n        <div class="module-name">\n            <span id="import-text"></span>\n            <button id="copy-button" title="Copy to Clipboard">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                    <path d="M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"/>\n                </svg>\n            </button>\n        </div>\n        <div class="autocompile-status"></div>\n    </footer>\n    <div id="loader-background">\n        <div style="width: 100%;">\n            <img src="/images/animated_bars.svg" alt="">\n            <div class="loader-text"></div>\n        </div>\n    </div>\n</div>\n',this.root.appendChild(e.content.cloneNode(!0)),this.editor=document.createElement("tunepad-python-editor"),this.editor.setAttribute("uuid",this.uuid),this.editor.setAttribute("name",this.name),this.nameField=this.root.querySelector(".gadget-name"),j.init(),this.state=document.createElement("cell-state")}connectedCallback(){this.showLoader("Loading cell data..."),window.addEventListener("load",(()=>{this.loadState()})),this._bindUserEvents()}async loadState(){this.state.setAttribute("cell-id",this.uuid),this.state.setAttribute("project-id","test-project3"),this.state.setAttribute("wss","wss://tunepad.space/websocket/"),this.root.appendChild(this.state),this.editor.innerHTML="",await this.state.connectToDatastore(),this.state.existed?(this.setName(u(this.state.get("name"),"tunepad_cell")),this.setAutoCompile(d(this.state.get("settings-autocompile"),!1)),this.setTheme(u(this.state.get("settings-theme"),"light")),this.setReadOnly(d(this.state.get("settings-readonly"),!1)),this.editor.initialContent=this.state.content):(this.state.set("name",this.name),this.state.set("settings-autocompile",this.autocompile),this.state.set("settings-theme",u(this.getAttribute("theme"),"light")),this.state.set("settings-readonly",d(this.getAttribute("readonly"),!1)),this.state.content=this.innerHTML,this.editor.initialContent=this.innerHTML.trim().split("\n").map((e=>e.startsWith("/")?e.substring(1):e)).join("\n")),this.state.bindEditor(this.editor),this.root.querySelector(".cell-contents")?.appendChild(this.editor),this.setHTML("#line-count","LOADING PYTHON..."),this.setHTML("#uncompiled",""),this.recompile(),this.hideLoader(),this.state.addEventListener("datastore-event",(e=>{const{event:t,message:n}=e.detail;"connection-error"===t?this.showLoader(n):("connected"===t||"synced"===t)&&this.hideLoader()})),this.state.addEventListener("datastate-event",(e=>{const{action:t,key:n,newValue:s,oldValue:i}=e.detail;"update"===t&&("name"===n?this.setName(s):"settings-autocompile"===n?this.setAutoCompile(d(s,!1)):"settings-theme"===n?this.setAttribute("theme",s):"settings-readonly"===n&&this.setReadOnly(d(s,!1)))}))}setName(e){e!==this.name&&(this.name=j.makePythonSafe(e,this.uuid),j.renameCell(this),this.nameField.value=this.name,this.editor.setAttribute("name",this.name),this.setHTML("#import-text",`from ${this.name} import *`),this.setAttribute("name",this.name))}setAutoCompile(e){e!==this.autocompile&&(this.autocompile=e,this.root.querySelector("#autocomp")?.setAttribute("checked",`${e}`),this.setAttribute("autocompile",`${e}`),this.setHTML(".autocompile-status",e?"Autocompile":""))}setReadOnly(e){this.setAttribute("readonly",`${e}`),this.editor.setAttribute("readonly",`${e}`),this.nameField.readOnly=e,this.root.querySelector("#readonly")?.setAttribute("checked",`${e}`)}setTheme(e){["light","dark"].includes(e)&&this.setAttribute("theme",e)}disconnectedCallback(){j.removeWarningListener(this.uuid)}attributeChangedCallback(e,t,n){"uuid"===e?(this.uuid=n,this.editor.setAttribute("uuid",this.uuid)):"name"===e?this.setName(n):"readonly"===e&&n!=t?this.setReadOnly("true"===n):"theme"===e?this.editor.setAttribute("theme",n):"autocompile"===e&&this.setAutoCompile("true"===n)}async recompile(){this.addClass("#compile-button","hidden"),this.removeClass("#loader","hidden");const e=await this.editor.recompile();this.setHTML("#output-badge",`${e.output.length}`),this.setHTML("#fail-count",`${e.trace.fails.length}`),this.setHTML("#pass-count",`${e.trace.passes.length}`),this.setClass("#output-badge","hidden",0===e.output.length),this.setClass("#error-badge","hidden",e.hasNoErrors),this.setClass("#fail-badge","hidden",0===e.trace.fails.length),this.setClass("#pass-badge","hidden",0===e.trace.passes.length),this.removeClass("#compile-button","hidden"),this.addClass("#loader","hidden"),this.setHTML("#uncompiled",""),this.codeChanged=!1,this.setHTML("#line-count",`${this.editor.code.split("\n").length} LINES`)}showLoader(e){this.setHTML(".loader-text",e),this.addClass("#loader-background","show")}hideLoader(){this.setHTML(".loader-text",""),this.removeClass("#loader-background","show")}_bindUserEvents(){j.addWarningListener(this.uuid,(e=>{this.setClass("#warning-badge","hidden",0===e.length),this.editor.warnings=e})),this.editor.addEventListener("codemirror-event",(e=>{switch(e.detail.event){case"lines-inserted":case"lines-removed":this.autocompile&&this.recompile();break;case"cursor-moved":this.autocompile&&this.codeChanged&&this.recompile();break;case"editor-blur":this.codeChanged&&this.recompile();break;case"content-changed":this.setHTML("#uncompiled","*"),this.codeChanged=!0}})),this.root.querySelector("#copy-button")?.addEventListener("click",(e=>{navigator.clipboard.writeText(`from ${this.name} import *`)})),this.root.querySelector("#theme-button")?.addEventListener("click",(e=>{const t="dark"===this.getAttribute("theme")?"light":"dark";this.setAttribute("theme",t),this.state?.set("settings-theme",t)})),this.root.querySelector("#compile-button")?.addEventListener("click",(e=>{this.setHTML("#line-count","COMPILING..."),this.recompile()})),this.root.addEventListener("context-menu-action",(e=>{const t=e.detail.action;"autocomp"===t?(this.setAutoCompile(e.detail.origin.checked),this.state?.set("settings-autocompile",this.autocompile)):"readonly"===t&&(this.setReadOnly(e.detail.origin.checked),this.state?.set("settings-readonly",e.detail.origin.checked))})),this.nameField.addEventListener("blur",(e=>{this.setName(this.nameField.value),this.state?.set("name",this.name)})),this.nameField.addEventListener("keypress",(e=>{"Enter"===e.key&&this.nameField.blur()}))}setClass(e,t,n){n?this.addClass(e,t):this.removeClass(e,t)}addClass(e,t){const n=this.root.querySelector(e);n&&n.classList.add(t)}removeClass(e,t){const n=this.root.querySelector(e);n&&n.classList.remove(t)}setHTML(e,t){const n=this.root.querySelector(e);n&&(n.innerHTML=t)}}pe.ELEMENT="tunepad-code-cell",pe.observedAttributes=["uuid","name","readonly","autocompile","theme"];class me extends HTMLElement{constructor(){super(),this.classList.add("drop-menu","hidden")}emitEvent(e){this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,detail:{origin:this}}))}async connectedCallback(){this.parentElement.addEventListener("pointerdown",(e=>{this.classList.toggle("hidden"),e.stopPropagation(),this.emitEvent("context-menu-open")})),document.addEventListener("pointerdown",(e=>{this.classList.add("hidden")})),document.addEventListener("context-menu-open",(e=>{e.detail.origin!==this&&this.classList.add("hidden")})),this.addEventListener("context-menu-action",(e=>{this.classList.add("hidden")}))}}me.ELEMENT="context-menu";class ge extends HTMLElement{constructor(){super(),this.disabled=!1,this.classList.add("menu-item"),this.name=document.createElement("div"),this.name.classList.add("name"),this.icon=document.createElement("div"),this.icon.classList.add("icon"),this.expand=document.createElement("div"),this.expand.classList.add("expand")}emitEvent(e){this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,detail:{origin:this,action:this.getAttribute("action"),checked:this.checked}}))}async connectedCallback(){this.appendChild(this.icon),this.appendChild(this.name);const e=this.querySelector("context-menu");e&&this.appendChild(this.expand),this.addEventListener("pointerdown",(e=>e.stopPropagation())),this.addEventListener("pointerup",(t=>{this.disabled||e||(this.toggleChecked(),setTimeout((()=>this.emitEvent("context-menu-action")),100))}))}attributeChangedCallback(e,t,n){"name"===e?this.name.innerHTML=n:"icon"===e?this.icon.style.backgroundImage=`url(${n})`:"disabled"===e?(this.disabled="true"===n,this.classList.toggle("disabled",this.disabled)):"checked"===e&&this.setChecked("true"===n)}toggleChecked(){if(this.hasAttribute("radio-group")){const e=this.getAttribute("radio-group");this.parentElement?.querySelectorAll(`.menu-item[radio-group=${e}]`).forEach((e=>e.setChecked(e==this)))}else void 0===this.checked?this.setChecked(void 0):!0===this.checked?this.setChecked(!1):this.setChecked(!0)}setChecked(e){this.checked=e,this.icon.style.backgroundImage=this.checked?"url(/images/check-icon.svg)":"none"}}return ge.ELEMENT="context-menu-item",ge.observedAttributes=["name","icon","action","disabled","checked"],customElements.define(K.ELEMENT,K),customElements.define(o.ELEMENT,o),customElements.define(te.ELEMENT,te),customElements.define(J.ELEMENT,J),customElements.define(le.ELEMENT,le),customElements.define(he.ELEMENT,he),customElements.define(pe.ELEMENT,pe),customElements.define(me.ELEMENT,me),customElements.define(ge.ELEMENT,ge),se.DefineElement(),ae.DefineElement(),e.AudioLoadingService=G,e.CompileResponse=X,e.GrowableAudioBuffer=y,e.MIDIEvent=i,e.MIDIManager=a,e.MusicTrace=M,e.Note=_,e.PythonRuntime=j,e.Synthesizer=W,e.TraceEvent=S,e.TunePadAudio=w,e.WaveformData=L,e.clamp=v,e.dBToGain=p,e.dBToValue=g,e.gainToValue=function(e){return g(m(e))},e.gainTodB=m,e.mix=function(e,t,n){return e+n*(t-e)},e.toBool=d,e.toDateTime=function(e){return Date.parse(e)},e.toInt=c,e.toNum=l,e.toStr=u,e.valueToGain=b,e.valueTodB=f,e.veloctyToGain=function(e){return b(e/127)},e}({},Prism);
//# sourceMappingURL=tunepad.min.js.map
