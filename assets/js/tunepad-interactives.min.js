!function(){"use strict";var t="undefined"!=typeof document?document.currentScript:null;const e=new CSSStyleSheet;e.replaceSync(".explore-wrapper {\n    width: 95%;\n    margin: 2rem auto;\n    padding: 1rem 0;\n    border-radius: 20px;\n    display: flex;\n    flex-direction: column;\n}\n#code-hint {\n    margin: 0rem 0.25rem 0 0;\n    padding: 0 1rem;\n    background: #0002;\n    height: 35px;\n    line-height: 35px;\n    border: 1px solid #887;\n    border-radius: 5px;\n    user-select: none;\n    box-sizing: border-box;\n    flex: 1;\n}\n.shelf {\n    display: flex;\n    margin: 1rem 4.5rem;\n}\n.keyboard-wrapper {\n    display: flex;\n}\n#copy-button {\n    color: #000a;\n    outline: none;\n    border: 1px solid #555;\n    height: 35px;\n    background-color: transparent;\n    border-radius: 5px;\n    font-weight: 500;\n    user-select: none;\n}\n#copy-button:hover { color: black; }\n#copy-button:active { color: rgb(45, 113, 134); }\npiano-instrument { flex: 1; }\n");const s=16.3516,n=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],i=["rgb(229, 76, 78)","rgb(223, 132, 74)","rgb(228, 171, 81)","rgb(227, 199, 73)","rgb(223, 228, 78)","rgb(174, 215, 71)","rgb(63, 188, 70)","rgb(63, 169, 180)","rgb(64, 124, 180)","rgb(78, 69, 179)","rgb(141, 69, 183)","rgb(202, 69, 147)"];let r=class t{get note(){return this._note}set note(t){this._note=t}get end(){return this.start+this.duration}get octave(){return Math.floor(this.note/12)}set octave(t){this.note=12*t+this.step}get step(){return this.note%12}set step(t){this.note=12*this.octave+t}get cents(){return Math.round(100*(this.note-Math.floor(this.note)))}get velocity(){return this._velocity}set velocity(t){this._velocity=a(t,0,127)}get gain(){return this.velocity*this.velocity/16129}set gain(t){this.velocity=Math.sqrt(127*t*127)}get name(){return`${n[Math.floor(this.step)]}`}get accidental(){return this.name.substring(1)}get nameWithOctave(){return`${n[Math.round(this.step)]}${this.octave-1}`}get stepColor(){return i[Math.round(this.step)%i.length]}get detune(){return this._detune}set detune(t){this._detune=t}get rate(){return Math.pow(2,(this.note+this.detune/100)/12-1)}get frequency(){return s*this.rate}set frequency(t){t>0&&(this.note=12*Math.log(t/s)/Math.LN2)}constructor(t){this._note=60,this.start=0,this.duration=1,this._velocity=90,this._detune=0,this.note=t}isEqual(t){return this.note===t.note&&this.start===t.start&&this.duration===t.duration&&this.velocity===t.velocity}clone(){let e=new t(this.note);return e.start=this.start,e.duration=this.duration,e.velocity=this.velocity,e.detune=this.detune,e}static fromName(e){const s=new t(60);return s.octave=t.nameToOctave(e),s.step=t.nameToStep(e),s}static fromFrequency(e){const s=new t(60);return s.frequency=e,s}static nameToOctave(t){if(2==t.length){let e=t.codePointAt(1);if(e)return a(e-48,0,8)}else if(t.length>2){let e=t.codePointAt(2);if(e)return a(e-48,0,8)}return 0}static nameToStep(t){return null==t||""==t?0:(t=t.length<=2?t[0].toUpperCase():t.substring(0,2).toUpperCase(),Math.max(0,n.indexOf(t)))}static nameToNote(t){if(t.length<2||t.length>3)return-1;t=t.replaceAll("#","♯");for(let e=0;e<12;e++)if(t.startsWith(n[e])){const s=t.substring(n[e].length);if(["0","1","2","3","4","5","6","7","8"].includes(s)){return 12*((s.codePointAt(0)||48)-48)+e}}return-1}};function a(t,e,s){return Math.max(e,Math.min(s,t))}const o=["C","F","B♭","E♭","A♭","C♯/D♭","F♯/G♭","B/C♭","E","A","D","G"],h=["A","D","G","C","F","A♯/B♭","D♯/E♭","A♭/G♯","C♯","F♯","B","E"],c=[0,5,10,3,8,1,6,11,4,9,2,7],l=[9,2,7,0,5,10,3,8,1,6,11,4],d=new Map([["C",["C","D♭","D","E♭","E","F","F♯","G","A♭","A","B♭","B"]],["F",["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"]],["B♭",["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"]],["E♭",["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"]],["A♭",["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"]],["C♯/D♭",["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"]],["F♯/G♭",["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"]],["B/C♭",["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"]],["E",["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"]],["A",["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"]],["D",["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"]],["G",["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"]]]),u=[0,2,4,5,7,9,11,12],p=[0,2,3,5,7,8,10,12];class m{get name(){return`${this.key} ${this.mode}`}get isMajor(){return"major"===this.mode}get isMinor(){return"minor"===this.mode}get signature(){const t=this.key.replace("♭","b").replace("♯","#");return t.length>2?t.substring(0,2):t}constructor(t){this.key="C",this.mode="major",this.base=0;const e=t.split(" ");2===e.length&&("major"===e[1].toLowerCase()&&o.includes(e[0])?(this.key=e[0],this.mode="major",this.base=c[o.indexOf(e[0])]):"minor"===e[1].toLowerCase()&&h.includes(e[0])&&(this.key=e[0],this.mode="minor",this.base=l[h.indexOf(e[0])]))}get relativeMajor(){return"minor"===this.mode?new m(o[h.indexOf(this.key)]+" major"):this}get relativeMinor(){return"major"===this.mode?new m(h[o.indexOf(this.key)]+" minor"):this}getNoteName(t,e=!0){const s=this.relativeMajor,n=d.get(s.key),i=n?n[t.step]:t.name;return e?i:this.stripAccidental(i)}getAccidental(t){const e=this.getNoteName(t);return this.containsNote(t)?"":1===e.length?"♮":e.endsWith("♯")?"♯":e.endsWith("♭")?"♭":""}getChordRoman(t){switch(t){case 1:default:return this.isMajor?"I":"i";case 2:return this.isMajor?"ii":"ii°";case 3:return this.isMajor?"iii":"III";case 4:return this.isMajor?"IV":"iv";case 5:return"V";case 6:return this.isMajor?"vi":"VI";case 7:return"vii°"}}getChordName(t){t=Math.max(1,Math.min(7,t));let e=this.base+24;e+=this.isMajor?u[t-1]:p[t-1];const s=this.getNoteName(new r(e));switch(t){case 1:case 4:default:return s+(this.isMajor?"maj":"min");case 2:return s+(this.isMajor?"min":"dim");case 3:case 6:return s+(this.isMajor?"min":"maj");case 5:return s+"maj";case 7:return s+"dim"}}getDiatonicTriad(t,e=4){t=Math.max(1,Math.min(7,t));let s=this.base+12*e;s+=this.isMajor?u[t-1]:p[t-1];const n=[s,s+4,s+7],i=[s,s+3,s+7],r=[s,s+3,s+6];switch(t){case 1:case 4:default:return this.isMajor?n:i;case 2:return this.isMajor?i:r;case 3:case 6:return this.isMajor?i:n;case 5:return n;case 7:return r}}containsNote(t){const e=(t.step+12-this.base)%12;return this.isMajor?u.includes(e):p.includes(e)}stripAccidental(t){return t.endsWith("♯")||t.endsWith("#")||t.endsWith("♭")||t.endsWith("b")||t.endsWith("♮")||t.endsWith("n")?t.substring(0,t.length-1):t}}function f(t,e=0){const s=parseInt(t);return isNaN(s)?e:s}function g(t,e=0){const s=parseFloat(t);return isNaN(s)?e:s}function y(t,e=!1){if(null==t)return e;if("boolean"==typeof t)return t;{const e=t.toString().toLowerCase();if("true"===e||"t"===e)return!0;if("false"===e||"f"===e)return!1}return e}function v(t,e=""){return t?t.toString():e}function b(t){return Math.max(0,Math.pow(10,t/20))}function w(t,e,s){return Math.max(e,Math.min(s,t))}class x{get bpm(){return this._bpm}set bpm(t){this.setTempo(t)}get meter(){return this._meter}set meter(t){this.setTimeSignature(t)}get beatsPerMeasure(){return this._beatsPerMeasure}get beatValue(){return this._beatValue}get key(){return this._key}set key(t){this._key=t,this._subscribers.forEach((t=>t.onKeyChange()))}get contextTime(){return this.context.currentTime}get time(){return this.isPaused?this._start:this.contextTime-this._start}get timeString(){let t=""+Math.floor(this.time/60)%60,e=""+Math.round(this.time)%60,s=""+Math.floor(100*this.time)%100;return 1==t.length&&(t=`0${t}`),1==e.length&&(e=`0${e}`),1==s.length&&(s=`0${s}`),`${t}:${e}.${s}`}get beats(){return this.time*this.bpm/60+this._elapsedBeats}get isPaused(){return 0===this._playing.size}static init(){return null==x._instance&&(x._instance=new x),x._instance}constructor(){this._start=0,this._elapsedBeats=0,this._bpm=90,this._meter="4/4",this._beatsPerMeasure=4,this._beatValue=4,this._key=new m("C major"),this._playing=new Set,this._subscribers=new Set,this.context=new AudioContext,this._metronomes=new Set,this._timer=-1}addSubscriber(t){this._subscribers.add(t)}removeSubscriber(t){this._subscribers.delete(t)}isPlaying(t){return this._playing.has(t)}play(t){this.isPaused&&(this._start=this.contextTime-this._start),this._playing.add(t),this._subscribers.add(t)}pause(t){this._subscribers.add(t),this.isPlaying(t)&&(this._playing.delete(t),this.isPaused&&(this._start=this.contextTime-this._start))}stopAll(){this._elapsedBeats=0,this._start=0,this._playing.clear(),this._subscribers.forEach((t=>t.onClockReset()))}setTime(t){this._elapsedBeats=t,this._start=0,this._playing.clear(),this._subscribers.forEach((t=>t.onClockTimeChange()))}setTempo(t){if(isNaN(t))return;const e=this.beats;t!=this._bpm&&(this._bpm=Math.max(5,t),this._start=this.contextTime-60*e/this._bpm,this._subscribers.forEach((t=>t.onTempoChange())))}setTimeSignature(t){2!=t.split("/").length&&(t="4/4"),this._beatsPerMeasure=f(t.split("/")[0],-1),this._beatValue=f(t.split("/")[1],-1),(this._beatsPerMeasure<0||this._beatValue<0)&&(this._beatsPerMeasure=4,this._beatValue=4),[1,2,4,8,16,32,64].includes(this._beatValue)||(this._beatValue=4),this._beatsPerMeasure>32&&(this._beatsPerMeasure=32);const e=`${this._beatsPerMeasure}/${this._beatValue}`;this._meter!=e&&(this._meter=e,this._subscribers.forEach((t=>t.onTimeSignatureChange())))}startMetronome(t){if(this._metronomes.add(t),-1==this._timer){const t=this.contextTime;let e=0;this._metronomes.forEach((t=>t.pulse(0))),this._timer=window.setInterval((()=>{if(0==this._metronomes.size)window.clearInterval(this._timer),this._timer=-1;else{const s=60/this.bpm,n=this.contextTime-t,i=Math.floor(n/s)%this.beatsPerMeasure;i!=e&&(e=i,this._metronomes.forEach((t=>t.pulse(e))))}}),30)}}stopMetronome(t){this._metronomes.delete(t)}isMetronomePlaying(t){return this._metronomes.has(t)}}class k{constructor(t,e,s){this.value=1,this.gain=new GainNode(t),this.name=e,this.value=s,this.gain.gain.value=s}connect(t,e){return e==this.name&&(t.level.connect(this.gain),!0)}destroy(){this.gain.disconnect()}updateParameter(t,e){return t==`${this.name}-mod}`&&(this.value=g(e,this.value),this.gain.gain.value=this.value,!0)}}class A{constructor(t,e){this.id=0,this.modulators=new Array,this.connectors=new Array,this.context=t,this.id=parseInt(e.id),this.level=t.createGain();const s=g(e.level,0);this.level.gain?.setValueAtTime(b(s),0),this.level.gain.value=b(s),this.addModulator("gain",g(e["gain-mod"],1),this.level.gain)}connect(t,e){for(let s of this.modulators)if(s.connect(t,e))return;"level"==e?t.level.connect(this.level.gain):t.level.connect(this.level)}addConnector(t){this.connectors.push(t),this.level?.connect(t.level)}addModulator(t,e,s){const n=new k(this.context,t,e);n.gain.connect(s),this.modulators.push(n)}playNote(t){}releaseNote(){}scheduleNote(t,e,s,n){}cancelNotes(){}destroy(){this.level.disconnect(),this.modulators.forEach((t=>t.destroy())),this.connectors.forEach((t=>t.destroy()))}pitchBend(t){}schedulePitchBend(t,e){}updateParameter(t,e){for(let s of this.modulators)if(s.updateParameter(t,e))return;if("level"==t){const t=g(e,0);this.level.gain?.setValueAtTime(b(t),0),this.level.gain.value=b(t)}}updateConnectorLevel(t,e){this.connectors.forEach((s=>{s.id==t&&s.updateLevel(e)}))}attachAnalyzer(t,e,s){for(let n of this.connectors)n.id==t&&n.attachAnalyzer(e,s)}detachAnalyzer(t){this.connectors.forEach((e=>{e.id==t&&e.detachAnalyzer()}))}getFloatTimeDomainData(t,e,s){this.connectors.forEach((n=>{n.id==t&&n.getFloatTimeDomainData(e,s)}))}}class E extends A{constructor(t,e){super(t,e),this.A=.1,this.D=.1,this.S=1,this.R=.2,this.aShape=5,this.dShape=2,this.rShape=2,this.attackCurve=[],this.decayCurve=[],this.releaseCurve=[],this.A=g(e.A,this.A),this.D=g(e.D,this.D),this.S=g(e.S,this.S),this.R=g(e.R,this.R),this.R=Math.max(this.R,.01),this.aShape=g(e["a shape"],this.aShape),this.dShape=g(e["d shape"],this.dShape),this.rShape=g(e["r shape"],this.rShape),this._attack=t.createGain(),this._decay=t.createGain(),this._release=t.createGain(),this._attack.gain.value=0,this._decay.gain.value=1,this._release.gain.value=1,this._attack.connect(this._decay),this._decay.connect(this._release),this._release.connect(this.level),this._buildCurves()}connect(t,e){t.level.connect(this._attack)}playNote(t){let e=this.context.currentTime;try{this._attack.gain?.cancelScheduledValues(0),this._decay.gain?.cancelScheduledValues(0),this._release.gain?.cancelScheduledValues(0),this.A>0?this._attack.gain?.setValueAtTime(0,e):this._attack.gain?.setValueAtTime(1,e),this._decay.gain?.setValueAtTime(1,e),this._release.gain?.setValueAtTime(1,e),e=this.context.currentTime+.01,this.A>0?this._attack.gain?.setValueCurveAtTime(this.attackCurve,e,this.A):this._attack.gain?.setValueAtTime(1,e),this.D>0?this._decay.gain?.setValueCurveAtTime(this.decayCurve,e+this.A,this.D):this._decay.gain?.setValueAtTime(this.S,e+this.A)}catch(t){console.log("Exception in ADSR playNote $x.")}}releaseNote(){const t=this.context.currentTime;this.R>0?(this._attack.gain?.cancelScheduledValues(t),this._decay.gain?.cancelScheduledValues(t),this._release.gain?.setValueCurveAtTime(this.releaseCurve,t,this.R)):this._release.gain?.setValueAtTime(0,t)}scheduleNote(t,e,s,n){const i=e<0?-e:0;let r=(e=e<0?0:e)+this.context.currentTime;if(this.A>0?this._attack.gain?.setValueAtTime(0,r):this._attack.gain?.setValueAtTime(1,r),this._decay.gain?.setValueAtTime(1,r),this._release.gain?.setValueAtTime(1,r),r+=.01,this.A>0&&this.A>i){const t=this.A-i;this._attack.gain?.setValueCurveAtTime(this.attackCurve,r,t)}else this._attack.gain?.setValueAtTime(1,r);if(this.D>0&&this.A+this.D>i&&s>this.A){const t=i>=this.A?this.D-(i-this.A):this.D,e=i>=this.A?r:r+this.A-i;this._decay.gain?.setValueCurveAtTime(this.decayCurve,e,t),this.A+this.D>s&&this._decay.gain?.cancelScheduledValues(r+s-i)}else this._decay.gain?.setValueAtTime(this.S,Math.max(0,r+this.A+this.D-i));if(s+this.R>i){const t=i>=s?this.R-(i-s):this.R;this._release.gain?.setValueCurveAtTime(this.releaseCurve,r+s-i,t)}else this._release.gain?.setValueAtTime(0,r)}cancelNotes(){super.cancelNotes();const t=this.context.currentTime;this._release.gain?.cancelScheduledValues(t),this._release.gain.value=0,this._attack.gain?.cancelScheduledValues(t),this._attack.gain.value=0,this._decay.gain?.cancelScheduledValues(t),this._decay.gain.value=0}destroy(){super.destroy(),this._attack.disconnect(),this._decay.disconnect(),this._release.disconnect()}updateParameter(t,e){switch(super.updateParameter(t,e),t){case"A":this.A=g(e,this.A);break;case"D":this.D=g(e,this.D);break;case"S":this.S=g(e,this.S);break;case"R":this.R=g(e,this.R);break;case"a shape":this.aShape=g(e,this.aShape);break;case"d shape":this.dShape=g(e,this.dShape);break;case"r shape":this.rShape=g(e,this.rShape)}this.R=Math.max(this.R,.01),this._buildCurves()}_buildCurves(){this._buildAttackCurve(this.aShape),this._buildDecayCurve(this.dShape),this._buildReleaseCurve(this.rShape)}_buildAttackCurve(t){t=w(t,.001,8),this.attackCurve=[];const e=Math.ceil(E.samplesPerSecond*this.A);if(e>0)for(let s=0;s<=e;s++){let n=s/e;n=Math.pow(n,t),this.attackCurve.push(n)}}_buildDecayCurve(t){t=w(t,.001,4),this.decayCurve=[];const e=Math.ceil(E.samplesPerSecond*this.D);if(e>0)for(let s=0;s<=e;s++){let n=s/e;n=1-Math.pow(n,t),this.decayCurve.push((1-this.S)*n+this.S)}}_buildReleaseCurve(t){t=w(t,.001,4),this.releaseCurve=[];const e=Math.ceil(E.samplesPerSecond*this.R);if(e>0)for(let s=0;s<=e;s++){let n=s/e;n=1-Math.pow(n,t),this.releaseCurve.push(n)}}}E.samplesPerSecond=300;class S extends A{constructor(t,e){super(t,e),this.compressor=t.createDynamicsCompressor(),this.compressor.connect(this.level),this.compressor.threshold.value=g(e.threshold,-24),this.compressor.knee.value=g(e.knee,30),this.compressor.ratio.value=g(e.ratio,12),this.compressor.attack.value=g(e.attack,.003),this.compressor.release.value=g(e.release,.25)}connect(t,e){"audio"===e?t.level.connect(this.compressor):super.connect(t,e)}destroy(){super.destroy(),this.compressor.disconnect()}updateParameter(t,e){super.updateParameter(t,e),"threshold"===t?this.compressor.threshold.value=w(g(e,-24),-100,0):"knee"==t?this.compressor.knee.value=w(g(e,30),0,40):"ratio"==t?this.compressor.ratio.value=w(g(e,12),1,20):"release"==t?this.compressor.release.value=w(g(e,.25),0,1):"attack"==t&&(this.compressor.attack.value=w(g(e,.003),0,1))}}class T{get context(){return this.source.context}constructor(t,e){this.id=0,this.dB=0,this._pre=null,this._analyzers=new Array,this._splitter=null,this._merger=null,this._buffer=null,this.type="",this.source=t,this.id=f(e.id,-1),this.level=new GainNode(this.context),this.dB=g(e.level,0),this.level.gain?.setValueAtTime(b(this.dB),0),this.type=v(e.type,"")}updateLevel(t){this.dB=t,(this._pre??this.level).gain?.setValueAtTime(b(t),0)}destroy(){this.level.disconnect()}attachAnalyzer(t,e,s=-60,n=5){e=w(e,1,6),this._pre=new GainNode(this.context),this._splitter=this.context.createChannelSplitter(e),this._merger=this.context.createChannelMerger(e),this._pre.gain?.setValueAtTime(b(this.dB),0),this.level.gain?.setValueAtTime(1,0),this.source.level.disconnect(this.level),this.source.level.connect(this._pre),this._pre?.connect(this._splitter),this._merger?.connect(this.level);for(let i=0;i<e;i++){let e=new AnalyserNode(this.level.context);this._analyzers.push(e),e.fftSize=t,e.minDecibels=s,e.maxDecibels=n,this._splitter?.connect(e,i,0),e.connect(this._merger,0,i),0==i&&(this._buffer=new Float32Array(e.frequencyBinCount))}}detachAnalyzer(){if(null!=this._pre){this.level.gain?.setValueAtTime(b(this.dB),0),this.source.level.disconnect(this._pre),this._pre?.disconnect(),this._splitter?.disconnect(),this._merger?.disconnect();for(let t of this._analyzers)t.disconnect();this.source.level.connect(this.level),this._pre=null,this._buffer=null,this._splitter=null,this._merger=null,this._analyzers=[]}}getFloatTimeDomainData(t,e){if(t<this._analyzers.length){const s=this._analyzers[t];if(null!=this._buffer&&e.length==this._buffer.length){s.getFloatTimeDomainData(this._buffer);for(let t=0;t<e.length;t++)e[t]+=this._buffer[t]}}}}class _ extends A{constructor(t,e){super(t,e),this.csn=t.createConstantSource(),this.csn.offset.value=g(e.signal,1),this.csn.connect(this.level),this.csn.start()}destroy(){super.destroy(),this.csn.stop(),this.csn.disconnect()}updateParameter(t,e){super.updateParameter(t,e),"signal"===t&&this.csn.offset.setValueAtTime(g(e,1),this.context.currentTime)}}class P extends A{constructor(t,e){super(t,e),this.gates=new Array,this.delayTime=.1,this.delayTime=g(e.delay,.1),this.audioIn=t.createGain(),this.delayIn=t.createGain(),this.addModulator("delay",g(e["delay-mod"],.5),this.delayIn.gain)}connect(t,e){"audio"==e?t.level.connect(this.audioIn):"delay"==e?t.level.connect(this.delayIn):super.connect(t,e)}updateParameter(t,e){"delay"==t?(this.delayTime=g(e,this.delayTime),this.gates.forEach((t=>{t.delay.delayTime.linearRampToValueAtTime(this.delayTime,this.context.currentTime+.1)}))):super.updateParameter(t,e)}playNote(t){const e=this.context.createGain();e.gain.value=1,e.gain.setValueAtTime(1,0);const s=this.context.createDelay();s.delayTime.setValueAtTime(this.delayTime,0),this.audioIn.connect(e),this.delayIn.connect(s.delayTime),e.connect(s),s.connect(this.level),this.gates.push({free:-1,gate:e,delay:s}),this._freeGates()}releaseNote(){this._freeGates(),this.gates.forEach((t=>{t.free<0&&(t.free=this.level.context.currentTime)}))}_freeGates(){const t=this.context.currentTime;this.gates=this.gates.filter((e=>!(e.free>=0&&e.free<t&&(e.gate.disconnect(),e.delay.disconnect(),1))))}scheduleNote(t,e,s,n){const i=this.context.currentTime,r=i+e+s+n,a=this.context.createGain();a.gain.value=0,a.gain.setValueAtTime(0,0),a.gain.setValueAtTime(1,Math.max(i,i+e)),a.gain.setValueAtTime(0,r);const o=this.context.createDelay();o.delayTime.setValueAtTime(this.delayTime,i),this.audioIn.connect(a),this.delayIn.connect(o.delayTime),a.connect(o),o.connect(this.level),this.gates.push({free:r,gate:a,delay:o}),this._freeGates()}destroy(){super.destroy(),this.gates.forEach((t=>{t.gate.disconnect(),t.delay.disconnect()})),this.gates=[],this.audioIn.disconnect(),this.delayIn.disconnect()}cancelNotes(){this.gates.forEach((t=>{t.gate.disconnect(),t.delay.disconnect()})),this.gates=[]}}class N extends A{constructor(t,e){super(t,e),this.param=0,this.curve="tanh",this.param=g(e.param,this.param),this.curve=v(e.curve,this.curve),this.dist=new WaveShaperNode(t),this.dist.curve=this._makeCurve(),this.dist.oversample="4x",this.gain=new GainNode(t),this.gain.gain.value=g(e["pre-gain"],1),this.gain.connect(this.dist),this.dist.connect(this.level)}connect(t,e){"audio"===e?t.level.connect(this.gain):super.connect(t,e)}destroy(){super.destroy(),this.gain.disconnect(),this.dist.disconnect()}updateParameter(t,e){super.updateParameter(t,e),"param"===t?(this.param=g(e,this.param),this.dist.curve=this._makeCurve()):"curve"===t?(this.curve=v(e,this.curve),this.dist.curve=this._makeCurve()):"pre-gain"===t&&(this.gain.gain.value=g(e,1))}_makeCurve(){const t=new Float32Array(512),e=this._curve(this.curve);for(let s=0;s<t.length;s++){const n=q(-1,1,s/(t.length-1));t[s]=e(n,this.param)}return t}_curve(t){switch(t){case"tanh":default:return M;case"sigmoid":return C;case"sin":case"sine":return L;case"steep sin":case"steep sine":return B}}}function M(t,e){const s=6-5*e,n=Math.pow(Math.E,s*t);return(n-1)/(n+1)}function C(t,e){const s=50*e;return(3+s)*t*20*(Math.PI/180)/(Math.PI+s*Math.abs(t))}function L(t,e){const s=1+5*e;return Math.sin(t*(19.8*s)/(2*Math.PI))}function B(t,e){const s=9.9*Math.PI;return q(Math.pow(Math.sin(t*s),5),Math.sin(t*s),e)}function q(t,e,s){return t+s*(e-t)}class R extends A{constructor(t,e){super(t,e),this.tracking=!0,this.ratio=1,this.frequency=350,this.Q=1,this.gain=0,this.detune=0,this.type="lowpass",this.filter=t.createBiquadFilter(),this.filter.connect(this.level),this.Q=w(g(e.Q,1),1e-4,1e3),this.gain=w(g(e.gain,0),-40,40),this.type=v(e["filter type"],"lowpass"),this.detune=g(e.detune,0),this.frequency=w(g(e.frequency,350),0,16700),this.tracking=y(e.tracking,!0),this.ratio=g(e["tracking ratio"],1),this.addModulator("Q",g(e["Q-mod"],1),this.filter.Q),this.addModulator("gain",g(e["gain-mod"],5),this.filter.gain),this.addModulator("frequency",g(e["frequency-mod"],1e3),this.filter.frequency),this.filter.Q.value=this.Q,this.filter.gain.value=this.gain,this.filter.type=this.type,this.filter.detune.value=this.detune,this.filter.frequency.value=this.frequency}playNote(t){const e=this.tracking?t.frequency*this.ratio+this.frequency:this.frequency,s=this.context.currentTime;this.filter.Q?.setValueAtTime(this.Q,s),this.filter.gain?.setValueAtTime(this.gain,s),this.filter.detune?.setValueAtTime(this.detune,s),this.filter.frequency?.setValueAtTime(e,s)}scheduleNote(t,e,s,n){e=e<0?0:e;const i=this.context.currentTime,r=this.tracking?t.frequency*this.ratio+this.frequency:this.frequency;this.filter.Q?.setValueAtTime(this.Q,e+i),this.filter.gain?.setValueAtTime(this.gain,e+i),this.filter.detune?.setValueAtTime(this.detune,e+i),this.filter.frequency?.setValueAtTime(r,e+i)}cancelNotes(){super.cancelNotes(),this.filter.Q?.cancelScheduledValues(0),this.filter.gain?.cancelScheduledValues(0),this.filter.detune?.cancelScheduledValues(0),this.filter.frequency?.cancelScheduledValues(0)}destroy(){super.destroy(),this.filter.disconnect()}connect(t,e){"audio"===e?t.level.connect(this.filter):super.connect(t,e)}updateParameter(t,e){const s=this.context.currentTime;"filter type"===t&&R.FILTERS.includes(e)?(this.type=v(e,"lowpass"),this.filter.type=this.type):"Q"===t?(this.Q=w(g(e,this.Q),1e-4,1e3),this.filter.Q.cancelScheduledValues(0),this.filter.Q.setValueAtTime(this.Q,s),this.filter.Q.value=this.Q):"gain"===t?(this.gain=w(g(e,this.gain),-40,40),this.filter.gain.cancelScheduledValues(0),this.filter.gain.setValueAtTime(this.gain,s),this.filter.gain.value=this.gain):"detune"===t?(this.detune=g(e,this.detune),this.filter.detune?.cancelScheduledValues(0),this.filter.detune?.setValueAtTime(this.detune,s)):"frequency"===t?(this.frequency=w(g(e,this.frequency),0,16700),this.filter.frequency?.cancelScheduledValues(0),this.filter.frequency?.setValueAtTime(this.frequency,s),this.filter.frequency.value=this.frequency):"tracking"===t?this.tracking=y(e,this.tracking):"ratio"===t?this.ratio=g(e,this.ratio):super.updateParameter(t,e)}}R.FILTERS=["lowpass","highpass","bandpass","allpass","lowshelf","highshelf","peaking","notch","allpass"];class V extends A{constructor(t,e){super(t,e),this.inverter=t.createGain(),this.inverter.gain.value=-1,this.inverter.gain.setValueAtTime(-1,0),this.inverter.connect(this.level)}connect(t,e){t.level.connect(this.inverter)}destroy(){super.destroy(),this.inverter.disconnect()}}class O extends A{get buffer(){switch(this.noise){case"pink":return this.pink;case"brown":return this.brown;default:return this.white}}constructor(t,e){super(t,e),this.noise="white",this.noise=v(e.noise,this.noise);const s=t.sampleRate,n=2*s;this.white=t.createBuffer(1,n,s),this.pink=t.createBuffer(1,n,s),this.brown=t.createBuffer(1,n,s);const i=this.white.getChannelData(0),r=this.pink.getChannelData(0),a=this.brown.getChannelData(0);let o=0,h=0,c=0,l=0,d=0,u=0,p=0,m=0;for(let t=0;t<n;t++){i[t]=2*Math.random()-1;let e=Math.random();o=.99886*o+.0555179*e,h=.99332*h+.0750759*e,c=.969*c+.153852*e,l=.8665*l+.3104856*e,d=.55*d+.5329522*e,u=-.7616*u-.016898*e,r[t]=o+h+c+l+d+u+p+.5362*e,r[t]*=.11,p=.115926*e,a[t]=(m+.02*e)/1.02,m=a[t],a[t]*=3.5}this.gain=new GainNode(t),this.gain.gain.value=.3,this.gain.connect(this.level),this.source=new AudioBufferSourceNode(t),this.source.buffer=this.buffer,this.source.loop=!0,this.source.start(),this.source.connect(this.gain)}destroy(){super.destroy(),this.source.stop(),this.source.disconnect(),this.gain.disconnect()}updateParameter(t,e){super.updateParameter(t,e),"noise"===t&&(this.noise=v(e,this.noise),this.source.disconnect(),this.source=new AudioBufferSourceNode(this.context),this.source.buffer=this.buffer,this.source.loop=!0,this.source.start(),this.source.connect(this.gain))}}O.NOISE_TYPES=["white","pink","brown"];class I extends A{constructor(t,e){super(t,e),this.frequency=440,this.multiplier=1,this.detune=0,this.relative=!0,this.waveform="sine",this.waveform=v(e.waveform,"sine"),this.frequency=g(e.frequency,this.frequency),this.detune=g(e.detune,0),this.relative=y(e.relative,!0),this.multiplier=g(e.multiplier,this.multiplier),this.osc=t.createOscillator(),this.gain=new GainNode(t),this.shaper=t.createWaveShaper(),this.addModulator("detune",g(e["detune-mod"],500),this.osc.detune),this.addModulator("frequency",g(e["frequency-mod"],1e3),this.osc.frequency),this.addModulator("amplitude",g(e["amplitude-mod"],1),this.level.gain),this.gain.gain.value=.3,I.Waveforms.includes(this.waveform)||(this.waveform="sine"),this.osc.frequency.setValueAtTime(90,0),this.osc.type="sine",this.osc.start(),this.osc.connect(this.gain),this.shaper.connect(this.gain),this.gain.connect(this.level),this._updateWaveform(this.waveform)}_updateWaveform(t){I.Waveforms.includes(t)&&(this.waveform=t),this.osc.type="sine",I.BasicWaveforms.includes(t)?(this.osc.type=t,this.osc.disconnect(),this.osc.connect(this.gain)):I.PeriodicWaveforms.includes(t)?(this.osc.setPeriodicWave(this._createPeriodicWave(t)),this.osc.disconnect(),this.osc.connect(this.gain)):I.ShaperWaveforms.includes(t)&&(this.shaper.curve=this._createWaveShaper(t),this.osc.disconnect(),this.osc.connect(this.shaper),this.osc.type="pitched noise"===t?"sawtooth":"sine")}_createWaveShaper(t){var e,s=new Float32Array(256);switch(t){case"exp sin":e=t=>Math.pow(t,5);break;case"hump":e=t=>(t<0?0:t)-.5;break;default:e=t=>2*Math.random()-1}for(let t=0;t<s.length;t++)s[t]=e(2*t/s.length-1);return s}_createPeriodicWave(t){let e=new Array;switch(t){case"cello":e=[0,1,.5,.3,.5,.35,.2,.2,.1,.15,.15,.15];break;case"flute":e=[0,.5,.05,.3,.1];break;case"reed":e=[-.15,.5,1,.4,.6,.3,.25,.2];break;case"brass":e=[0,.8,.8,.85,.9,.8,.85,.7,.6,.4,.3,.25,.2,.1];break;case"glass":e=[0,1,0,.25,0,.5,0,.75,0,.8];break;case"vibraphone":e=[0,6,19,.8,13,3];break;case"camel":e.push(0);for(let t=1;t<20;t++)e.push(1/Math.pow(t,2));break;case"soft saw":e.push(-.1);for(let t=1;t<20;t++)e.push(1/t);break;case"soft square":e.push(0);for(let t=1;t<50;t++)e.push(1/t*(t%2));break;case"organ 1":e=[-.1,1,1,1];break;case"organ 2":e=[-.1,1,1,1,0,0,0,0,0,.8];break;case"organ 3":e=[0,1,0,0,0,0,.8,.8,.8,.8];break;case"buzz 1":e.push(0);let t=1;for(let s=1;s<100;s++)s%3==0||s%4==0?(e.push(1/t),t++):e.push(0);break;default:e.push(0),t=1;for(let s=1;s<100;s++)s%5==0||s%2==0?(e.push(.5/t),t++):e.push(0)}return this.osc.context.createPeriodicWave(e,new Float32Array(e.length))}playNote(t){let e=this.relative?t.frequency*this.multiplier:this.frequency;e=w(e,0,23999),this.osc.frequency?.setValueAtTime(e,this.context.currentTime),this.osc.detune?.setValueAtTime(this.detune,this.context.currentTime)}scheduleNote(t,e,s,n){e=e<0?0:e;let i=this.relative?t.frequency*this.multiplier:this.frequency;i=w(i,0,23999),this.osc.frequency?.setValueAtTime(i,e+this.context.currentTime),this.osc.detune?.setValueAtTime(this.detune,e+this.context.currentTime)}cancelNotes(){super.cancelNotes(),this.osc.frequency?.cancelScheduledValues(0),this.osc.detune?.cancelScheduledValues(0)}destroy(){super.destroy(),this.osc.stop(),this.osc.disconnect(),this.gain.disconnect(),this.shaper.disconnect()}pitchBend(t){const e=this.context.currentTime;this.osc.detune?.setTargetAtTime(this.detune+t,e,.1)}schedulePitchBend(t,e){e.apply(this.osc.detune,t,this.context,this.detune)}updateParameter(t,e){if("waveform"===t)this._updateWaveform(e);else if("relative"==t)this.relative=y(e,!0);else if("frequency"==t)this.frequency=g(e,this.frequency),this.osc.frequency?.setValueAtTime(this.frequency,this.context.currentTime);else if("multiplier"==t)if(this.relative){let t=this.osc.frequency.value/this.multiplier;this.multiplier=g(e,this.multiplier),this.multiplier>0&&(t*=this.multiplier),t=w(t,0,23999),this.osc.frequency?.setValueAtTime(t,this.context.currentTime)}else this.multiplier=g(e,this.multiplier);else"detune"==t?(this.detune=g(e,this.detune),this.osc.detune?.setValueAtTime(this.detune,this.context.currentTime)):super.updateParameter(t,e)}}I.BasicWaveforms=["sine","square","triangle","sawtooth"],I.PeriodicWaveforms=["cello","flute","reed","brass","glass","vibraphone","camel","organ 1","organ 2","organ 3","soft saw","soft square","buzz 1","buzz 2"],I.ShaperWaveforms=["pitched noise","exp sin","hump"],I.Waveforms=[...I.BasicWaveforms,...I.PeriodicWaveforms,...I.ShaperWaveforms];class D extends E{constructor(t,e){super(t,e)}}class $ extends A{constructor(t,e){super(t,e),this.panner=new StereoPannerNode(t),this.panner.pan.setValueAtTime(g(e.pan,0),0),this.panner.connect(this.level),this.addModulator("pan",g(e["pan-mod"],.5),this.panner.pan)}connect(t,e){"audio"===e?t.level.connect(this.panner):super.connect(t,e)}destroy(){super.destroy(),this.panner.disconnect()}updateParameter(t,e){super.updateParameter(t,e),"pan"===t&&this.panner.pan.setValueAtTime(g(e,0),0)}}class F extends A{constructor(t,e){super(t,e),this.frequency=220,this.multiplier=1,this.detune=0,this.relative=!0;var s=new Float32Array(512);for(let t=0;t<s.length/2;t++)s[t]=-1,s[t+Math.floor(s.length/2)]=1;this.driver=new OscillatorNode(t),this.driver.type="sawtooth",this.gain=new GainNode(t),this.shaper=new WaveShaperNode(t),this.shaper.curve=s,this.csn=new ConstantSourceNode(t),this.addModulator("pulse width",1,this.csn.offset),this.addModulator("detune",g(e["detune-mod"],400),this.driver.detune),this.addModulator("frequency",g(e["frequency-mod"],100),this.driver.frequency),this.addModulator("amplitude",g(e["amplitude-mod"],1),this.level.gain),this.driver.connect(this.shaper),this.csn.connect(this.shaper),this.shaper.connect(this.gain),this.gain.connect(this.level),this.csn.offset.value=g(e["pulse width"],0),this.frequency=g(e.frequency,this.frequency),this.detune=g(e.detune,this.detune),this.relative=y(e.relative,this.relative),this.gain.gain.value=.3,this.driver.frequency.value=this.frequency,this.driver.detune.value=this.detune,this.csn.start(),this.driver.start()}playNote(t){let e=this.relative?t.frequency*this.multiplier:this.frequency;e=w(e,0,23999),this.driver.frequency.setValueAtTime(e,this.context.currentTime),this.driver.detune.setValueAtTime(this.detune,this.context.currentTime)}scheduleNote(t,e,s,n){e=e<0?0:e;let i=this.relative?t.frequency*this.multiplier:this.frequency;i=w(i,0,23999),this.driver.frequency.setValueAtTime(i,e+this.context.currentTime),this.driver.detune.setValueAtTime(this.detune,e+this.context.currentTime)}cancelNotes(){super.cancelNotes(),this.driver.frequency.cancelScheduledValues(0),this.driver.detune.cancelScheduledValues(0)}destroy(){super.destroy(),this.csn.stop(),this.csn.disconnect(),this.driver.stop(),this.driver.disconnect(),this.gain.disconnect(),this.shaper.disconnect()}pitchBend(t){const e=this.context.currentTime;this.driver.detune.setTargetAtTime(this.detune+t,e,.1)}schedulePitchBend(t,e){e.apply(this.driver.detune,t,this.context,this.detune)}updateParameter(t,e){if("relative"===t)this.relative=y(e,!0);else if("frequency"==t)this.frequency=g(e,this.frequency),this.driver.frequency.setValueAtTime(this.frequency,this.context.currentTime);else if("multiplier"===t)if(this.relative){let t=this.driver.frequency.value/this.multiplier;this.multiplier=g(e,this.multiplier),this.multiplier>0&&(t*=this.multiplier),t=w(t,0,23999),this.driver.frequency.setValueAtTime(t,this.context.currentTime)}else this.multiplier=g(e,this.multiplier);else"detune"===t?(this.detune=g(e,this.detune),this.driver.detune.setValueAtTime(this.detune,this.context.currentTime)):"pulse width"===t?this.csn.offset.value=g(e,0):super.updateParameter(t,e)}}class H extends A{constructor(t,e){super(t,e),this.csn=new ConstantSourceNode(t),this.csn.offset.value=2*Math.random()-1,this.csn.connect(this.level),this.csn.start()}playNote(t){const e=2*Math.random()-1;this.csn.offset.setValueAtTime(e,this.context.currentTime)}scheduleNote(t,e,s,n){const i=2*Math.random()-1;e=e<0?0:e,this.csn.offset.setValueAtTime(i,e+this.context.currentTime)}destroy(){super.destroy(),this.csn.stop(),this.csn.disconnect()}}class G{constructor(){}static hasSound(t){return G.sounds.has(t)}static getAudioBuffer(t){return G.sounds.get(t)}static async loadAudioBuffer(t){const e=G.context;if(G.hasSound(t))return G.getAudioBuffer(t);let s=t;s=s.endsWith(".ogg")||s.endsWith(".wav")?t:G.supportsAudioType("audio/ogg")?`${t}.ogg`:`${t}.wav`;try{let n=await fetch(s),i=await n.arrayBuffer(),r=await e.decodeAudioData(i);return G.sounds.set(t,r),r}catch(t){console.log(t)}}static async loadCustomSound(t){if(G.hasSound(t))return!0;const e=G.context;try{let s=await fetch(t),n=await s.arrayBuffer(),i=await e.decodeAudioData(n);return G.sounds.set(t,i),console.log("Loaded "+t),!0}catch(t){return console.log(t),!1}}static supportsAudioType(t){if(G._supports.has(t))return G._supports.get(t);let e=!1;const s=document.createElement("audio");return s.id="test-audio-node",document.body.append(s),"probably"!=s.canPlayType(t)&&"maybe"!=s.canPlayType(t)||(e=!0,document.querySelector("#test-audio-node")?.remove()),G._supports.set(t,e),e}}function z(t){return"object"==typeof t&&"sample"in t&&"string"==typeof t.sample&&"step"in t&&"number"==typeof t.step}G.sounds=new Map,G.context=x.init().context,G._supports=new Map;class K extends A{constructor(t,e){super(t,e),this.sources=new Array,this.playback=1,this.detune=0,this.sample_pack="piano",this.samples=new Array,this._rate=1,this.drumkit=!1,this.playback=g(e.playback,this.playback),this.detune=g(e.detune,this.detune),this.sample_pack=v(e["sample-pack"],this.sample_pack),this.dIn=new GainNode(t),this.pIn=new GainNode(t),this.dIn.gain.value=g(e["detune-mod"],1),this.pIn.gain.value=g(e["playback-mod"],1),"samples"in e&&Array.isArray(e.samples)&&this.loadSamplePack(e.samples)}loadSamplePack(t){this.samples=t.filter((t=>z(t))).sort(((t,e)=>t.step-e.step)),this.samples.forEach((t=>G.loadAudioBuffer(t.sample)))}static loadAudioBuffers(t,e){t.forEach((t=>G.loadAudioBuffer(t.sample)))}playNote(t){this.scheduleNote(t,0,0,0)}findBestSample(t){let e;if(this.drumkit)e=this.samples.find((e=>e.step===Math.round(t.note)));else{let s=1e5;for(const n of this.samples){if(n.step==t.note)return n;if(n.step>t.note)return n.step-t.note+3<s?n:e;{const i=t.note-n.step;i<s&&(e=n,s=i)}}}return e}scheduleNote(t,e,s,n){const i=e<0?-e:0;e=Math.max(0,e);const r=this.findBestSample(t);if(r){const a=G.getAudioBuffer(r.sample);if(a){const o=t.note-r.step+t.detune/100,h=this.context.currentTime,c=Math.pow(2,o/12),l=new AudioBufferSourceNode(this.context);l.connect(this.level),this.sources.push(l),this.dIn.connect(l.detune),this.pIn.connect(l.playbackRate),l.buffer=a,l.playbackRate.value=c*this.playback,l.start(e+h,i),s>0&&l.stop(e+h+s+n),l.addEventListener("ended",(t=>{this.sources=this.sources.filter((t=>t!==l)),l.disconnect()})),a.duration,this.playback,this._rate=c}}}cancelNotes(){super.cancelNotes(),this.sources.forEach((t=>{t.stop(),t.disconnect()})),this.sources=new Array,this._rate=1}destroy(){super.destroy(),this.sources.forEach((t=>{t.stop(),t.disconnect()})),this.sources=new Array,this._rate=1}pitchBend(t){const e=this.context.currentTime;this.sources.forEach((s=>{s.detune?.setTargetAtTime(this.detune+t,e,.1)}))}schedulePitchBend(t,e){if(this.sources.length>0){const s=this.sources[this.sources.length-1];e.apply(s.detune,t,this.context,this.detune)}}connect(t,e){"detune"==e?t.level.connect(this.dIn):"playback"==e&&t.level.connect(this.pIn)}updateParameter(t,e){"playback"==t?(this.playback=g(e,this.playback),this.sources.forEach((t=>{t.playbackRate?.setValueAtTime(this._rate*this.playback,this.context.currentTime)}))):"detune"==t?(this.detune=g(e,this.detune),this.sources.forEach((t=>{t.detune?.setValueAtTime(this.detune,this.context.currentTime)}))):"sample-pack"==t||("playback-mod"==t?this.pIn.gain.value=g(e,1):"detune-mod"==t?this.dIn.gain.value=g(e,1):super.updateParameter(t,e))}}class j extends A{constructor(t,e){super(t,e),this.merger=t.createChannelMerger(2),this.leftGain=new GainNode(t),this.rightGain=new GainNode(t);let s=g(e["left-level"],0);this.leftGain.gain.setValueAtTime(b(s),0),s=g(e["right-level"],0),this.rightGain.gain?.setValueAtTime(b(s),0),this.leftGain.connect(this.merger,0,0),this.rightGain.connect(this.merger,0,1),this.merger.connect(this.level),this.addModulator("left-level",g(e["left-level-mod"],.5),this.leftGain.gain),this.addModulator("right-level",g(e["right-level-mod"],.5),this.rightGain.gain)}connect(t,e){"left"===e?t.level.connect(this.leftGain):"right"===e?t.level.connect(this.rightGain):super.connect(t,e)}destroy(){super.destroy(),this.merger.disconnect(),this.leftGain.disconnect(),this.rightGain.disconnect()}updateParameter(t,e){if(super.updateParameter(t,e),"left-level"===t){let t=g(e,0);this.leftGain.gain.setValueAtTime(b(t),0)}else if("right-level"==t){let t=g(e,0);this.rightGain.gain.setValueAtTime(b(t),0)}}}class U{constructor(t){this.id=0,this.free=0,this.nodes=new Map,this.release=0,this.gates=new Array,this.context=t,this.id=U._CHAIN_ID++,this.loadPatch(U._sine_patch)}playNote(t,e){const s=e.context.currentTime;this.free=31536e3,this.disconnect();const n=new GainNode(e.context);n.connect(e),n.gain.value=t.gain,n.gain.setValueAtTime(t.gain,s),this.out?.level.connect(n),this.gates.push({free:this.free,node:n}),this.nodes.forEach(((e,s,n)=>e.playNote(t)))}releaseNote(){this.nodes.forEach(((t,e,s)=>t.releaseNote()))}scheduleNote(t,e,s,n){const i=n.context.currentTime;this.free=i+e+s+this.release+.05;const r=new GainNode(n.context);r.connect(n),r.gain.value=0,r.gain?.setValueAtTime(0,0),r.gain?.setValueAtTime(t.gain,Math.max(i,i+e)),r.gain?.setValueAtTime(0,Math.max(i,i+e+s+this.release)),this.out?.level.connect(r),this.gates.push({free:this.free,node:r});try{this.nodes.forEach(((n,i,r)=>{n.scheduleNote(t,e,s,this.release)}))}catch(t){console.log("Note scheduling exception: $x")}for(let t=0;t<this.gates.length;t++)this.gates[t].free<i&&(this.gates[t].node?.disconnect(),this.out?.level.disconnect(this.gates[t].node),delete this.gates[t]);return this.gates=this.gates.filter((t=>void 0!==t)),this.release}disconnect(){this.out?.level.disconnect(),this.gates.forEach((t=>{t.node?.disconnect()})),this.gates=[]}cancelNotes(){this.disconnect(),this.nodes.forEach((t=>t.cancelNotes())),this.free=0}destroy(){this.disconnect(),this.nodes.forEach((t=>t.destroy())),this.nodes.clear()}pitchBend(t){this.nodes.forEach((e=>e.pitchBend(t)))}schedulePitchBend(t,e){this.nodes.forEach((s=>s.schedulePitchBend(t,e)))}loadSoundPatch(t){const e=U._custom_patch.replaceAll("<SOUNDURL>",t);this.loadPatch(JSON.parse(e))}loadPatch(t){if(this.nodes.clear(),this.out=void 0,this.release=0,Array.isArray(t.nodes))for(let e of t.nodes){let t=this.createSynthNode(this.context,e);t instanceof D&&(this.out=t),this.nodes.set(t.id,t)}this._updateReleaseValue();for(let e of t.routing){let t=this.nodes.get(e.source),s=this.nodes.get(e.dest);if(t&&s){let n=new T(t,e);t.addConnector(n),s.connect(n,v(e.type,""))}}}createSynthNode(t,e){switch(e.type){case"compressor":return new S(t,e);case"const":return new _(t,e);case"distortion":return new N(t,e);case"gain":return new A(t,e);case"inverter":return new V(t,e);case"lfo":const s=new I(t,e);return s.gain.gain.value=1,s;case"fm":case"osc":return new I(t,e);case"noise":return new O(t,e);case"panner":return new $(t,e);case"pwm":return new F(t,e);case"delay":return new P(t,e);case"adsr":return new E(t,e);case"filter":return new R(t,e);case"out":return new D(t,e);case"rand":return new H(t,e);case"sample":case"drums":return new K(t,e);case"stereo":return new j(t,e);default:return console.log(`Node not found: ${e.type}`),new A(t,e)}}getNodeById(t){return this.nodes.get(t)}updateParameter(t,e,s){let n=this.nodes.get(t);n?.updateParameter(e,s),this._updateReleaseValue()}updateConnectorLevel(t,e,s){let n=this.nodes.get(t);n?.updateConnectorLevel(e,s)}attachAnalyzer(t,e,s,n){let i=this.nodes.get(t);i?.attachAnalyzer(e,s,n)}detachAnalyzer(t,e){let s=this.nodes.get(t);s?.detachAnalyzer(e)}getFloatTimeDomainData(t,e,s,n){let i=this.nodes.get(t);i?.getFloatTimeDomainData(e,s,n)}_updateReleaseValue(){this.release=0,this.nodes.forEach((t=>{t instanceof E&&(this.release=Math.max(Math.max(t.A+t.D,t.R),this.release))}))}}U._CHAIN_ID=0,U._sine_patch={nodes:[{type:"out",A:.1,D:.1,S:.8,R:.15,id:0},{type:"osc",waveform:"sine",relative:"true",frequency:1,id:1,level:.1}],routing:[{source:1,dest:0,type:"out"}]},U._custom_patch='{\n      "nodes": [\n        {\n          "type": "out",\n          "id": 0,\n          "A": 0.0,\n          "D": 0.1,\n          "S": 1,\n          "R": 0.3,\n          "level": 0\n        },\n        {\n          "type": "sample",\n          "sample-pack": "custom",\n          "samples": [\n            {\n              "sample": "<SOUNDURL>",\n              "step": 60\n            }\n          ],\n          "id": 1,\n          "level": 0\n        }\n      ],\n      "routing": [\n        { "id": 2, "source": 1, "dest": 0, "type": "audio", "level": 0 }\n      ]\n    }';class X{get end(){return this.time+this.duration}constructor(t,e,s){this.time=0,this.duration=1,this.line=-1,this.note=new r(60),this.trace_group=-1,this.voice=0,this.params=new Map,this.id=void 0===s?X._TRACE_ID++:s,this.command=t,this.time=e}clone(){let t=new X(this.command,this.time,this.id);t.line=this.line,t.duration=this.duration,t.note=this.note.clone(),t.trace_group=this.trace_group,t.voice=this.voice;for(let[e,s]of this.params)t.params.set(e,s);return t}static fromMap(t){let e=new X(String(t.get("command")),Math.max(0,Number(t.get("time"))));e.duration=Number(t.get("duration")),e.note.duration=e.duration;for(let[s,n]of t)if("note"===s&&"number"==typeof n)e.note.note=n;else if("pitch"===s&&"number"==typeof n)e.note.detune=100*n;else if("velocity"===s&&"number"==typeof n)e.note.velocity=n;else if("sustain"===s&&"number"==typeof n)e.note.duration=Math.max(e.note.duration,n);else if("line"===s&&"number"==typeof n)e.line=n;else if("trace"===s)e.trace_group=f(n,0);else if("voice"===s)e.voice=f(n,0);else{if(["command","time","duration"].includes(s))continue;e.params.set(s,n)}return e}isEquivalent(t){if(this.command===t.command&&this.time===t.time&&this.duration===t.duration&&this.note.isEqual(t.note)){for(let[e,s]of this.params)if("line"!==e&&t.params.get(e)!==s)return!1;return!0}return!1}}X.PLAY="play",X.SOUND="sound",X.REST="rest",X.PUSH_FX="push_fx",X.POP_FX="pop_fx",X.MESSAGE="message",X._TRACE_ID=0;class W{constructor(t,e){this.released=!1,this.canceled=!1,this.note=t,this.chain=e}}class Q{get isAssigned(){return this.nodeId>=0}get value(){return w(this._value,this.minValue,this.maxValue)}set value(t){this._value=w(t,this.minValue,this.maxValue)}get percentValue(){return(this.value-this.minValue)/this.range}set percentValue(t){this.value=t*this.range+this.minValue}get range(){return this.maxValue-this.minValue}constructor(){this._value=1,this.nodeId=-1,this.name="",this.label="",this.slot=0,this.minValue=0,this.maxValue=1}static fromJSON(t){const e=new Q;return e.nodeId=f(t.node,-1),e.name=v(t.name,""),e.label=v(t.label,""),e.slot=f(t.slot,0),e.minValue=g(t.min,0),e.maxValue=g(t.max,1),e._value=w(g(t.value,1),e.minValue,e.maxValue),e}toJSON(){return{node:this.nodeId,name:this.name,label:this.label,slot:this.slot,min:this.minValue,max:this.maxValue,value:this.value}}}const Y={nodes:[{type:"out",A:.05,D:.1,S:.8,R:.25,level:0,id:0},{type:"osc",waveform:"sine",relative:"true",frequency:1,id:1,level:.1}],routing:[{source:1,dest:0,type:"audio",level:0,id:1}],parameters:[],name:"Simple Sine",description:"",instrument:"piano",submenu:"",version:"2.0",format:"tunepad-patch",created:"2024-03-08 16:15:54.384",modified:"2024-03-08 16:15:54.385"},J={patch_id:280,nodes:[{type:"out",A:.05,D:.1,S:.8,R:.25,level:0,id:0},{type:"osc",waveform:"sawtooth",relative:"true",frequency:1,id:1,level:.1}],routing:[{source:1,dest:0,type:"audio",level:0,id:1}],parameters:[],name:"Simple Saw",description:"",instrument:"piano",submenu:"",version:"2.0",format:"tunepad-patch",created:"2024-03-08 16:15:54.384",modified:"2024-03-08 16:15:54.385"},Z={nodes:[{type:"out",A:.05,D:.1,S:.8,R:.25,level:0,id:0},{type:"osc",waveform:"square",relative:"true",frequency:1,id:1,level:.1}],routing:[{source:1,dest:0,type:"audio",level:0,id:1}],parameters:[],name:"Simple Square",description:"",instrument:"piano",submenu:"",version:"2.0",format:"tunepad-patch",created:"2024-03-08 16:15:54.384",modified:"2024-03-08 16:15:54.385"},tt={nodes:[{type:"out",A:.05,D:.1,S:.8,R:.25,level:0,id:0},{type:"osc",waveform:"triangle",relative:"true",frequency:1,id:1,level:.1}],routing:[{source:1,dest:0,type:"audio",level:0,id:1}],parameters:[],name:"Simple Tri",description:"",instrument:"piano",submenu:"",version:"2.0",format:"tunepad-patch",created:"2024-03-08 16:15:54.384",modified:"2024-03-08 16:15:54.385"},et={nodes:[{id:0,type:"out",A:0,D:.3,S:.5,R:.2,"a shape":3.4,"d shape":2,"r shape":2,level:0},{id:7,type:"osc",waveform:"sawtooth",relative:!0,frequency:440,multiplier:1,"frequency-mod":1e3,detune:0,"detune-mod":2,"amplitude-mod":.5,level:.1},{id:8,type:"filter","filter type":"lowpass",tracking:!0,frequency:980,"frequency-mod":100,Q:3,"Q-mod":10,gain:0,"gain-mod":250,"tracking ratio":1,level:0}],routing:[{id:26,source:7,dest:8,type:"audio",level:0},{id:25,source:8,dest:0,type:"audio",level:0}],parameters:[{node:8,name:"frequency",label:"FREQUENCY",slot:1,min:32,max:15e3,value:7e3},{node:8,name:"Q",label:"RESONANCE (Q)",slot:2,min:1e-4,max:50,value:50}],name:"Filtered Saw",instrument:"piano",version:"2.0",format:"tunepad-patch",created:"2024-05-30 17:44:15.448",modified:"2024-05-30 17:44:15.449"},st={nodes:[{id:0,type:"out",cx:116.38970947265625,cy:86.873046875,A:.011363636363636362,D:.1,S:1,R:.005681818181818182,"a shape":4.000000000000001,"d shape":2,"r shape":2,level:0},{id:2,type:"osc",cx:13.176898002624512,cy:87.11394500732422,waveform:"square",relative:!0,frequency:440.00000000000034,multiplier:1,"frequency-mod":1e3,detune:0,"detune-mod":10,"amplitude-mod":.5,level:-5},{id:3,type:"lfo",cx:-87.84600448608398,cy:87.11394500732422,waveform:"sine",relative:!1,frequency:6.900000000000002,"frequency-mod":30,detune:0,"detune-mod":20,"amplitude-mod":.5,level:4.950595879501315}],routing:[{id:2,source:2,dest:0,type:"audio",level:0},{id:5,source:3,dest:2,type:"detune",level:5}],parameters:[],name:"Wobbly Square",description:"Created in patchworks",instrument:"piano",version:"2.0",format:"tunepad-patch",created:"2022-03-01 16:37:48.199",modified:"2022-03-01 17:34:23.146"};function nt(t){return"string"==typeof t.name&&Array.isArray(t.nodes)&&Array.isArray(t.routing)&&"2.0"===t.version&&"tunepad-patch"===t.format}class it{get bpm(){return this._bpm}set bpm(t){isNaN(t)||(this._bpm=w(t,5,300))}get voice(){return this.patch.name}constructor(t){this._bpm=90,this.notes=new Array,this.patch=Y,this.bank=new Array,this.sound_gens=new Array,this.parameters=new Array,this._analyzers=new Map,this._effects=new Array,t&&this.loadPatch(t)}get isPlaying(){if(0===this.bank.length)return!1;{const t=this.bank[0].context.currentTime;for(const e of this.bank)if(e.free>t)return!0;return!1}}playNote(t,e){e||(e=x.init().context.destination);const s="number"==typeof t?new r(t):t;let n=this._allocateGenerator(e.context,e.context.currentTime);n&&(n.cancelNotes(),n.playNote(s,e),this.notes.push(new W(s,n)))}releaseNote(t){const e="number"==typeof t?t:t.note;this.notes.forEach((t=>{t.note.note===e&&this._release(t)}))}releaseAll(){this.notes.forEach((t=>{this._release(t)}))}_release(t){if(t.released)return;t.released=!0,t.chain.releaseNote();const e=Math.ceil(1e3*t.chain.release)+100;setTimeout((()=>{this.notes=this.notes.filter((e=>e!==t)),t.chain.disconnect(),this._releaseGenerator(t.chain)}),e)}playSound(t,e,s){s||(s=x.init().context.destination);const n=new U(s.context);n.loadSoundPatch(e),n.playNote(t,s),this.notes.push(new W(t,n))}scheduleNote(t,e,s=0,n){n||(n=x.init().context.destination);const i="number"==typeof t?new r(t):t,a=n.context.currentTime,o=i.duration*(60/this.bpm);e=(e+s)*(60/this.bpm);const h=this._allocateGenerator(n.context,a+e);return h?.scheduleNote(i,e,o,n),h}scheduleSound(t,e,s,n=0,i){i||(i=x.init().context.destination);const a="number"==typeof t?new r(t):t;i.context.currentTime;const o=a.duration*(60/this.bpm);s=(s+n)*(60/this.bpm);const h=new U(i.context);return h.loadSoundPatch(e),h.scheduleNote(a,s,o,i),h}scrubAudio(t,e,s,n){if(t){const i=x.init();n||(n=i.context.destination);const r=n.context.currentTime;e*=60/i.bpm,s*=60/i.bpm;const a=Math.max(.01,s-e),o=n.context.createGain();o.connect(n),o.gain.setValueAtTime(0,r),o.gain.linearRampToValueAtTime(.5,r+a/2),o.gain.linearRampToValueAtTime(0,r+a);const h=n.context.createBufferSource();h.connect(o),h.buffer=t,h.start(0,e,a),h.onended=t=>{h.disconnect(),o.disconnect()}}}cancelAllNotes(){for(const t of this.bank)this._releaseGenerator(t);for(const t of this.sound_gens)t.cancelNotes();this.sound_gens=[]}scheduleNotes(t,e,s){const n=e.context.currentTime,i=Math.max(0,-s);for(let t=0;t<this.sound_gens.length;t++)this.sound_gens[t].free<n&&delete this.sound_gens[t];this.sound_gens=this.sound_gens.filter((t=>void 0!==t));for(const n of t)if(n.command==X.PLAY&&n.end>=i){const t=this.scheduleNote(n.note,n.time,s,e);t&&this.sound_gens.push(t)}else if(n.command==X.SOUND&&n.end>=i&&n.params.has("sound-url")){const t=this.scheduleSound(n.note,n.params.get("sound-url"),n.time,s,e);t&&this.sound_gens.push(t)}}scheduleMidiNotes(t,e,s,n=1){const i=window.performance.now(),r=Math.max(0,-e);for(const a of t)if(a.command===X.PLAY&&a.end>=r){const t=a.note.clone();t.gain*=n;const r=a.note.duration*(60/this.bpm)*1e3,o=i+(a.time+e)*(60/this.bpm)*1e3,h=[144,Math.round(t.note),t.velocity],c=[128,Math.round(t.note),0];s.send(h,o),s.send(c,o+r)}}playMidiNote(t,e){const s="number"==typeof t?new r(t):t,n=[144,Math.round(s.note),s.velocity];e.send(n,window.performance.now())}releaseMidiNote(t,e){const s="number"==typeof t?new r(t):t,n=[128,Math.round(s.note),0];e.send(n,window.performance.now())}setMidiProgram(t,e){e>=0&&e<=127&&t.send([192,e])}cancelAllMidiNotes(t){const e=window.performance.now();for(let s=0;s<=127;s++)t.send([128,s,0],e);"clear"in t&&"function"==typeof t.clear&&t.clear()}pitchBend(t){this.notes.forEach((e=>e.chain.pitchBend(t)))}async loadPatch(t){if(nt(t))return await this._loadPatchData(t);if(t instanceof URL)return await this._loadPatchURL(t);switch(t){case"simple-saw":return await this._loadPatchData(J);case"simple-sine":default:return await this._loadPatchData(Y);case"simple-square":return await this._loadPatchData(Z);case"simple-tri":return await this._loadPatchData(tt);case"filtered-saw":return await this._loadPatchData(et);case"wobbly-square":return await this._loadPatchData(st)}}async _loadPatchURL(t){const e=await fetch(t),s=await e.json();return nt(s)?await this._loadPatchData(s,t.toString()):(this._loadPatchData(Y),!1)}async _loadPatchData(t,e="./"){const s=e.split("/").slice(0,-1).join("/")+"/";this.patch=t,this.parameters=[],this._destroyAllGenerators(),this.sound_gens=[];for(const t of this.patch.nodes)if(Array.isArray(t.samples)){const e=t.samples.filter((t=>z(t))).sort(((t,e)=>t.step-e.step));e.forEach((t=>{t.sample.startsWith("http")||t.sample.startsWith("//")||t.sample.startsWith("./")||(t.sample=s+t.sample),G.loadAudioBuffer(t.sample)})),t.samples=e}else"reverb"===t.type?await G.loadCustomSound(t.impulse):"buffer source"===t.type&&await G.loadCustomSound(t.buffer);if(Array.isArray(this.patch.parameters))for(const t of this.patch.parameters)this.parameters.push(Q.fromJSON(t));return!0}updateParameter(t,e){let s=-1;for(let e of this.parameters)if(e.name===t){s=e.nodeId;break}if(!(s<0)){this.bank.forEach((n=>{n.updateParameter(s,t,e)}));for(const n of this.patch.nodes)n.id==s&&(n[t]=e)}}set attack(t){this.bank.forEach((e=>{e.out&&(e.out.A=Math.max(0,t))})),this.patch.nodes.filter((t=>"out"===t.type)).forEach((e=>e.A=Math.max(0,t)))}set decay(t){this.bank.forEach((e=>{e.out&&(e.out.D=Math.max(0,t))})),this.patch.nodes.filter((t=>"out"===t.type)).forEach((e=>e.D=Math.max(0,t)))}set sustain(t){this.bank.forEach((e=>{e.out&&(e.out.S=w(t,0,1))})),this.patch.nodes.filter((t=>"out"===t.type)).forEach((e=>e.S=w(t,0,1)))}set release(t){this.bank.forEach((e=>{e.out&&(e.out.R=Math.max(0,t))})),this.patch.nodes.filter((t=>"out"===t.type)).forEach((e=>e.R=Math.max(0,t)))}set volume(t){this.bank.forEach((e=>{e.out?.updateParameter("level",w(t,-50,5))})),this.patch.nodes.filter((t=>"out"===t.type)).forEach((e=>e.level=w(t,-50,5)))}_allocateGenerator(t,e){this.bank.length>0&&this.bank[0].context!=t&&this._destroyAllGenerators();for(const s of this.bank)if(s.free<e&&s.context==t)return this._analyzers.forEach((t=>{0==s.free&&s.attachAnalyzer(t.nodeId,t.connectorId,t.fftSize,t.channels)})),s;if(this.bank.length<it.MAX_GENERATORS){const e=new U(t);return e.loadPatch(this.patch),this.bank.push(e),this._analyzers.forEach((t=>{e.attachAnalyzer(t.nodeId,t.connectorId,t.fftSize,t.channels)})),e}}_releaseGenerator(t){t.cancelNotes(),this._analyzers.forEach((e=>{t.detachAnalyzer(e.nodeId,e.connectorId)}))}_destroyAllGenerators(){this.bank.forEach((t=>{t.destroy()})),this.bank=[]}}it.MAX_GENERATORS=24;const rt=new CSSStyleSheet;rt.replaceSync("#ring {\n    fill: #3e3e3c;\n    stroke: none;\n}\n.track {\n    fill: #181818;\n    stroke: black;\n    stroke-width: 1.5;\n}\n#arc {\n    stroke: #7ff;\n    stroke-width: 7;\n    fill: none;\n}\n.active #arc {\n    stroke: white;\n}\n#pointer {\n    stroke: #ddd;\n    stroke-width: 6;\n    pointer-events: none;\n}\n#container {\n    max-width: 100px;\n    user-select: none;\n}\n.tick {\n    fill: #999;\n}\n.cover {\n    fill: #fff2;\n    stroke: #fff1;\n    stroke-width: 4;\n    pointer-events: none;\n}");class at extends HTMLElement{get value(){const t=this.maxValue-this.minValue;return this.minValue+this._value*t}set value(t){const e=this.maxValue-this.minValue;t=Math.min(this.maxValue,Math.max(this.minValue,t)),this._value=(t-this.minValue)/e,this._redraw()}get angle(){const t=this.maxAngle-this.minAngle;return this._value*t+this.minAngle}constructor(){super(),this.minAngle=0,this.maxAngle=1.5*Math.PI,this.minValue=0,this.maxValue=1,this._value=0,this._startVal=0,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(rt),this.root.innerHTML='<div id="container">\n    <svg version="1.1" viewBox="-50 -50 100 100">\n        <g transform="rotate(135, 0, 0)">\n            <circle class="track" cx="0" cy="0" r="49"/>\n            <path id="arc" d=""/>\n            <circle id="ring" cx="0" cy="0" r="36"/>\n            <line id="pointer" x1="0" y1="0" x2="0" y2="46"/>\n            <circle class="cover" cx="0" cy="0" r="27"/>\n            <circle class="tick" cx="55" cy="0" r="4"/>\n            <circle class="tick" cx="0" cy="-55" r="4"/>\n        </g>\n    </svg>\n</div>\n',this.container=this.root.querySelector("#container"),this.ring=this.root.querySelector("#ring"),this.line=this.root.querySelector("#pointer"),this.arc=this.root.querySelector("#arc"),this._value=1,console.log(this._describeArc(55))}connectedCallback(){this.value=this._startVal,this._redraw();let t=!1,e=-1;this.ring.addEventListener("pointerdown",(s=>{t=!0,e=s.clientY,this.container.classList.add("active")})),document.addEventListener("pointermove",(s=>{if(t){const t=e-s.clientY;e=s.clientY,this._value=Math.max(0,Math.min(1,this._value+t/100)),this._redraw(),this.emitEvent("adjusted")}})),document.addEventListener("pointerup",(e=>{t&&(t=!1,this.container.classList.remove("active"),this.emitEvent("changed"))}))}disconnectedCallback(){}attributeChangedCallback(t,e,s){"min"===t?this.minValue=parseFloat(s):"max"===t?this.maxValue=parseFloat(s):"value"===t&&(this.isConnected?this.value=parseFloat(s):this._startVal=parseFloat(s))}emitEvent(t){this.dispatchEvent(new CustomEvent(t,{bubbles:!0,composed:!0,detail:{origin:this,value:this.value}}))}_redraw(){const t=Math.cos(this.angle),e=Math.sin(this.angle);this.line.setAttribute("x1",""+15*t),this.line.setAttribute("y1",""+15*e),this.line.setAttribute("x2",""+33*t),this.line.setAttribute("y2",""+33*e),this.arc.setAttribute("d",this._describeArc(43))}_describeArc(t){const e=t*Math.cos(this.angle),s=t*Math.sin(this.angle);return["M",t*Math.cos(0),t*Math.sin(0),"A",t,t,0,this.angle>=Math.PI?1:0,1,e,s].join(" ")}}at.ELEMENT="range-dial",at.observedAttributes=["min","max","value"];(new CSSStyleSheet).replaceSync('\n.drop-menu {\n    position: absolute;\n    background-color: white;\n    border: 1px solid #0001;\n    border-radius: 8px;\n    padding: 8px 0;\n    z-index: 100;\n    display: flex;\n    flex-direction: column;\n    min-width: 200px;\n    box-shadow: 0px 3px 5px #0005;\n    -webkit-touch-callout: none;\n    user-select: none;\n    margin: 0;\n}\n.drop-menu.hidden { display: none; }\n.drop-menu:hover { cursor: pointer; }\n.drop-menu.terminal {\n    max-height: 70vh;\n    overflow-y: auto !important;\n}\n.menu-item {\n    line-height: 140%;\n    display: flex;\n    align-items: center;\n    font-size: 14px;\n    font-weight: normal;\n    color: #3C4E60;\n    outline: none;\n    border: none;\n    padding: 5px 20px 5px 10px;\n    white-space: nowrap;\n    position: relative;\n    text-align: left;\n}\n.menu-item:hover { background: rgba(0, 0, 0, 0.15); }\n.menu-item:not(:has(.drop-menu)):active { background: rgba(0, 0, 0, 0.2); }\n.menu-item.highlight { background: rgba(0, 0, 0, 0.085); }\n.menu-item.disabled { color: #aaa; }\n.menu-item.disabled:hover { background-color: transparent; }\n.menu-item.disabled:active { background-color: transparent; }\n.menu-item.disabled .icon { opacity: 0.3; }\n.menu-item.hidden { display: none; }\n\n.menu-item:hover > .drop-menu {\n  display: flex;\n  left: 88%;\n  top: -10px;\n}\n\n.menu-item .icon {\n    width: 1.1rem;\n    height: 1.1rem;\n    margin: 0 0.85rem 0 0.5rem;\n    text-align: center;\n    opacity: 0.6;\n    background-repeat: no-repeat;\n    background-size: contain;\n    background-position: center;\n}\n.menu-item .expand {\n  text-align: right;\n  position: relative;\n  left: 5px;\n  font-size: 90%;\n  width: 2em;\n  flex: 1;\n}\n.menu-item .name {\n  flex: 1;\n}\n.menu-item .expand::before {\n  content: "▸";\n  font-size: 17px;\n  color: rgba(0,0,0,0.6);\n  font-weight: 600;\n}\n.menu-separator {\n    border-top: 1px solid #0005;\n    margin: 10px;\n    height: 2px;\n}');class ot extends HTMLElement{constructor(){super(),this.classList.add("drop-menu","hidden")}emitEvent(t){this.dispatchEvent(new CustomEvent(t,{bubbles:!0,composed:!0,detail:{origin:this}}))}async connectedCallback(){this.parentElement.addEventListener("pointerdown",(t=>{this.classList.toggle("hidden"),t.stopPropagation(),this.emitEvent("context-menu-open")})),document.addEventListener("pointerdown",(t=>{this.classList.add("hidden")})),document.addEventListener("context-menu-open",(t=>{t.detail.origin!==this&&this.classList.add("hidden")})),this.addEventListener("context-menu-action",(t=>{this.classList.add("hidden")}))}}ot.ELEMENT="context-menu";class ht extends HTMLElement{constructor(){super(),this.disabled=!1,this.classList.add("menu-item"),this.name=document.createElement("div"),this.name.classList.add("name"),this.icon=document.createElement("div"),this.icon.classList.add("icon"),this.expand=document.createElement("div"),this.expand.classList.add("expand")}emitEvent(t){this.dispatchEvent(new CustomEvent(t,{bubbles:!0,composed:!0,detail:{origin:this,action:this.getAttribute("action"),checked:this.checked}}))}async connectedCallback(){this.appendChild(this.icon),this.appendChild(this.name);const t=this.querySelector("context-menu");t&&this.appendChild(this.expand),this.addEventListener("pointerdown",(t=>t.stopPropagation())),this.addEventListener("pointerup",(e=>{this.disabled||t||(this.toggleChecked(),setTimeout((()=>this.emitEvent("context-menu-action")),100))}))}attributeChangedCallback(t,e,s){"name"===t?this.name.innerHTML=s:"icon"===t?this.icon.style.backgroundImage=`url(${s})`:"disabled"===t?(this.disabled="true"===s,this.classList.toggle("disabled",this.disabled)):"checked"===t&&(this.hasAttribute("radio-group")&&"true"===s?this.toggleChecked():this.setChecked("true"===s))}toggleChecked(){if(this.hasAttribute("radio-group")){const t=this.getAttribute("radio-group");this.uncheckSiblings(t),this.setChecked(!0);let e=this.parentElement;for(;e instanceof ot||e instanceof ht;)e instanceof ht&&e.getAttribute("radio-group")===t&&e.setChecked(!0),e=e.parentElement}else void 0!==this.checked&&this.setChecked(!this.checked)}uncheckSiblings(t){let e=this.parentElement,s=e;for(;s instanceof ot||s instanceof ht;)s=s.parentElement,s instanceof ot&&(e=s);e?.querySelectorAll(`.menu-item[radio-group=${t}]`).forEach((t=>{t instanceof ht&&t.setChecked(!1)}))}setChecked(t){this.checked=t,this.icon.style.backgroundImage=this.checked?"url(/assets/images/check-icon.svg)":"none"}}ht.ELEMENT="context-menu-item",ht.observedAttributes=["name","icon","action","disabled","checked"];const ct=new CSSStyleSheet;ct.replaceSync('* {\n    box-sizing: border-box;\n}\n\n.instrument {\n    display: grid;\n    grid-template-columns: repeat(8, 1fr);\n}\n\n.instrument.armed {\n    /*outline: 1px solid gold;*/\n}\n\n.wrapper {\n    margin: 0 3px 3px 0;\n    color: white;\n    flex: 1;\n    border-radius: 4px;\n    border: 2px solid #fff1;\n    box-shadow: 3px 3px 3px #0002;\n}\n\n.drum-pad {\n    min-width: 58px;\n    height: 72px;\n    text-align: center;\n    border-radius: 1px;\n    background-color: #fff2;\n    display: flex;\n    flex-direction: column;\n    border: 1px solid #fff5;\n    position: relative;\n}\n.drum-pad:hover { \n    background-color: #fff5;\n    border: 1px solid #fff7;\n}\n.drum-pad.pressed {\n    background-color: #fff7;\n    border: 1px solid #fff7;\n}\n.drum-name {\n    color: #fffa;\n    font-weight: bold;\n    text-transform: uppercase;\n    font-size: 10px;\n    user-select: none;\n    flex: 1;\n    align-content: center;\n}\n.drum-pad:hover .drum-name { color: white; }\n\n.pad-name, .key-hint {\n    font-size: 10px;\n    pointer-events: none;\n    user-select: none;\n    position: absolute;\n    bottom: 3px;\n    color: #fff6;\n}\n.pad-name {\n    font-weight: bold;\n    color: #fffd;\n    left: 3px;\n}\n.key-hint { right: 3px; }\n\n.wrapper:has(.drum-pad.pressed[data-note="0"]) {\n    background-color: hsl(0 90 50);\n    box-shadow: 0px 0px 5px hsl(0 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="1"]) {\n    background-color: hsl(22 90 50);\n    box-shadow: 0px 0px 5px hsl(22 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="2"]) {\n    background-color: hsl(44 90 50);\n    box-shadow: 0px 0px 5px hsl(44 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="3"]) {\n    background-color: hsl(66 90 50);\n    box-shadow: 0px 0px 5px hsl(66 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="4"]) {\n    background-color: hsl(88 90 50);\n    box-shadow: 0px 0px 5px hsl(88 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="5"]) {\n    background-color: hsl(110 90 50);\n    box-shadow: 0px 0px 5px hsl(110 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="6"]) {\n    background-color: hsl(132 90 50);\n    box-shadow: 0px 0px 5px hsl(132 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="7"]) {\n    background-color: hsl(154 90 50);\n    box-shadow: 0px 0px 5px hsl(154 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="8"]) {\n    background-color: hsl(176 90 50);\n    box-shadow: 0px 0px 5px hsl(176 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="9"]) {\n    background-color: hsl(198 90 50);\n    box-shadow: 0px 0px 5px hsl(198 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="10"]) {\n    background-color: hsl(220 90 50);\n    box-shadow: 0px 0px 5px hsl(220 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="11"]) {\n    background-color: hsl(242 90 50);\n    box-shadow: 0px 0px 5px hsl(242 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="12"]) {\n    background-color: hsl(264 90 50);\n    box-shadow: 0px 0px 5px hsl(264 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="13"]) {\n    background-color: hsl(286 90 50);\n    box-shadow: 0px 0px 5px hsl(286 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="14"]) {\n    background-color: hsl(308 90 50);\n    box-shadow: 0px 0px 5px hsl(308 90 50);\n}\n.wrapper:has(.drum-pad.pressed[data-note="15"]) {\n    background-color: hsl(330 90 50);\n    box-shadow: 0px 0px 5px hsl(330 90 50);\n}\n\n@media screen and (max-width: 650px) {\n    .instrument {\n        grid-template-columns: repeat(4, 1fr);\n    }\n}');class lt extends HTMLElement{constructor(){super(),this.armed=!1,this.keys="qwertyuiasdfghjk",this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(ct),this.root.innerHTML='<div class="instrument"></div>\n'}connectedCallback(){document.addEventListener("keydown",(t=>this.onKeyDown(t))),document.addEventListener("keyup",(t=>this.onKeyUp(t)));for(let t=0;t<16;t++){const e=document.createElement("div");e.classList.add("wrapper"),e.innerHTML=`\n                <div class="drum-pad" data-hint="${this.keys[t]}" data-note="${t}">\n                    <div class="drum-name"></div>\n                    <div class="key-hint">${this.keys[t]}</div>\n                    <div class="pad-name">${t}</div>\n                </div>`,this.root.querySelector(".instrument")?.append(e)}this.root.querySelectorAll(".drum-pad").forEach((t=>{let e=!1;t.addEventListener("pointerdown",(s=>{t.classList.add("pressed"),this.emitNoteOn(this.getPadNote(t),"pointer"),e=!0})),t.addEventListener("pointerup",(s=>{e&&(t.classList.remove("pressed"),this.emitNoteOff(this.getPadNote(t),"pointer"),e=!1)})),t.addEventListener("pointerenter",(s=>{s.buttons>0&&(t.classList.add("pressed"),this.emitNoteOn(this.getPadNote(t),"pointer"),e=!0)})),t.addEventListener("pointerleave",(s=>{t.classList.remove("pressed"),this.emitNoteOff(this.getPadNote(t),"pointer"),e=!0}))}))}disconnectedCallback(){}attributeChangedCallback(t,e,s){"armed"===t&&s!==e&&("true"===s?this.armKeyboard():this.disarmKeyboard())}emitNoteOn(t,e,s=90){if(t<0)return;const n=new CustomEvent("note-on",{bubbles:!0,composed:!0,detail:{note:t,source:e,velocity:s}});this.dispatchEvent(n)}emitNoteOff(t,e){if(t<0)return;const s=new CustomEvent("note-off",{bubbles:!0,composed:!0,detail:{note:t,source:e,velocity:0}});this.dispatchEvent(s)}emitPitchBend(t,e){const s=new CustomEvent("pitch-bend",{bubbles:!0,composed:!0,detail:{source:e,value:t}});this.dispatchEvent(s)}noteOn(t,e=90){this.root.querySelector(`.drum-pad[data-note="${t}"]`)?.classList.add("pressed")}noteOff(t){this.root.querySelector(`.drum-pad[data-note="${t}"]`)?.classList.remove("pressed")}allNotesOff(){this.root.querySelectorAll(".drum-pad")?.forEach((t=>t.classList.remove("pressed")))}isNoteOn(t){const e=this.root.querySelector(`.drum-pad[data-note="${t}"]`);return null!==e&&e.classList.contains("pressed")}armKeyboard(){this.armed=!0,this.setAttribute("armed","true"),this.root.querySelector(".instrument")?.classList.add("armed")}disarmKeyboard(){this.armed=!1,this.setAttribute("armed","false"),this.root.querySelector(".instrument")?.classList.remove("armed")}get isKeyboardArmed(){return this.armed}setPatch(t){if(Array.isArray(t.nodes))for(let e of t.nodes)if("drums"===e.type&&Array.isArray(e.samples)){for(let t of e.samples)if("number"==typeof t.step&&"string"==typeof t.name){const e=this.root.querySelector(`.drum-pad[data-note="${t.step}"] .drum-name`);e&&(e.innerHTML=t.name)}return}}onKeyDown(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey||1==t.repeat)&&this.isKeyboardArmed){const e=t.key.toLowerCase();console.log(e),console.log(this.root.querySelector(`.drum-pad[data-hint="${e}"]`)),this.root.querySelector(`.drum-pad[data-hint="${e}"]`)?.classList.add("pressed");const s=this.keys.indexOf(e);s>=0?this.emitNoteOn(s,"keyboard"):"ArrowDown"==t.key?this.emitPitchBend(-200,"keyboard"):"ArrowUp"==t.key&&this.emitPitchBend(200,"keyboard")}}onKeyUp(t){if("ArrowUp"==t.key||"ArrowDown"==t.key)this.emitPitchBend(0,"keyboard");else{const e=t.key.toLowerCase();this.root.querySelector(`.drum-pad[data-hint="${e}"]`)?.classList.remove("pressed");const s=this.keys.indexOf(e);s>=0&&this.emitNoteOff(s,"keyboard")}}getPadNote(t){return parseInt(t?.getAttribute("data-note")??"-1")}}lt.observedAttributes=["armed"],lt.ELEMENT="drums-instrument";const dt=new CSSStyleSheet;dt.replaceSync("/*\n@keyframes fade-out {\n    0% {\n        opacity: 1.0;\n    }\n\n    100% {\n        opacity: 0.0;\n    }\n}\n*/\n.instrument {\n    position: relative;\n    box-sizing: border-box;\n    display: flex;\n    background-color: #222;\n    overflow: hidden;\n    flex-direction: column;\n}\n\n.instrument.armed {\n    outline: 1px solid gold;\n}\n\n.naturals, .accidentals {\n    width: 100%;\n    display: flex;\n}\n.accidentals {\n    height: 50px;\n    position: relative;\n    top: 10px;\n    left: -20px;\n}\n.marimba-key, .spacer {\n    border: 2px solid #fff2;\n    flex: 1;\n    margin: 3px;\n    box-sizing: border-box;\n    min-width: 34px;\n}\n\n.marimba-key {\n    background-color: burlywood;\n    background-image: url('/assets/images/marimba-key.png');\n    background-position: center;\n    background-size: cover;\n    border-radius: 0.25rem;\n    display: flex;\n    flex-direction: column;\n    text-align: center;\n    height: 160px;\n    font-size: 12px;\n    padding-top: 20px;\n    color: #fff9;\n    user-select: none;\n    box-shadow: 0 0 6px #000b;\n}\n\n.spacer {\n    pointer-events: none;\n    opacity: 0;\n}\n\n.marimba-key.accidental {\n    height: 70px;\n    padding-top: 10px;\n    position: relative;\n    top: -20px;\n}\n\n.accidental .note-name { display: none; }\n\n.marimba-key:hover {\n    border: 2px solid #fff7;\n    color: white;\n}\n\n.marimba-key.pressed {\n    border: 2px solid white;\n}\n/*\n.marimba-key.white.pressed.step-0 { fill: rgb(229, 76, 78); }\n.marimba-key.white.pressed.step-2 { fill: rgb(228, 171, 81); }\n.marimba-key.white.pressed.step-4 { fill: rgb(223, 228, 78); }\n.marimba-key.white.pressed.step-5 { fill: rgb(174, 215, 71); }\n.marimba-key.white.pressed.step-7 { fill: rgb(63, 169, 180); }\n.marimba-key.white.pressed.step-9 { fill: rgb(78, 69, 179); }\n.marimba-key.white.pressed.step-11 { fill: rgb(202, 69, 147); }\n*/\n\n.note-name { flex: 1; }\n.key-hint { margin-bottom: 1rem; display: none; }\n.armed .key-hint { display: block; }\n");class ut extends HTMLElement{get minKey(){return 48}get maxKey(){return 77}constructor(){super(),this.armed=!1,this.key_map="awsedftgyhujkolp;']",this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(dt),this.root.innerHTML='<div class="instrument"></div>',this.container=this.root.querySelector(".instrument")}connectedCallback(){const t=document.createElement("div"),e=document.createElement("div");t.classList.add("naturals"),e.classList.add("accidentals");for(let s=this.minKey;s<=this.maxKey;s++){const n=this._buildKey(s);if(this.isAccidental(s)?e.append(n):t.append(n),[5,11].includes(s%12)||s==this.maxKey||s==this.minKey){const t=document.createElement("div");t.classList.add("spacer"),e.append(t)}this.container.append(e),this.container.append(t)}document.addEventListener("keydown",(t=>this.onKeyDown(t))),document.addEventListener("keyup",(t=>this.onKeyUp(t)))}_buildKey(t){const e=t%12,s=Math.floor(t/12)-1,n=ut.NOTES[e],i=t-this.minKey,r=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),h=document.createElement("div");r.classList.add("marimba-key"),a.classList.add("key-hint"),o.classList.add("note-name"),h.classList.add("midi-value"),r.setAttribute("data-note",`${t}`),this.isAccidental(t)?r.classList.add("accidental"):r.style.height=145-2*i+"px",i>=0&&i<this.key_map.length&&(r.setAttribute("data-trigger",`${this.key_map[i]}`),a.innerHTML=`${this.key_map[i]}`),o.innerHTML=`${n}${s}`,h.innerHTML=`${t}`,r.append(h),r.append(o),r.append(a);let c=!1;return r.addEventListener("pointerdown",(e=>{this.emitNoteOn(t,"pointer"),c=!0,r.classList.add("pressed"),e.stopPropagation()})),r.addEventListener("pointerup",(e=>{c=!1,this.emitNoteOff(t,"pointer"),r.classList.remove("pressed")})),r.addEventListener("pointerleave",(e=>{c&&(this.emitNoteOff(t,"pointer"),r.classList.remove("pressed"),c=!1)})),r.addEventListener("pointerenter",(e=>{e.buttons>0&&(this.emitNoteOn(t,"pointer"),r.classList.add("pressed"),c=!0)})),r}disconnectedCallback(){}attributeChangedCallback(t,e,s){if("armed"===t)"false"==s?this.disarmKeyboard():this.armKeyboard()}emitNoteOn(t,e,s=90){const n=new CustomEvent("note-on",{bubbles:!0,composed:!0,detail:{note:t,source:e,velocity:s}});this.dispatchEvent(n)}emitNoteOff(t,e){const s=new CustomEvent("note-off",{bubbles:!0,composed:!0,detail:{note:t,source:e,velocity:0}});this.dispatchEvent(s)}emitPitchBend(t,e){const s=new CustomEvent("pitch-bend",{bubbles:!0,composed:!0,detail:{source:e,value:t}});this.dispatchEvent(s)}isAccidental(t){return[1,3,6,8,10].includes(t%12)}noteOn(t,e=90){const s=this.root.querySelector(`.marimba-key[data-note="${t}"]`);s?.classList.add("pressed")}noteOff(t){const e=this.root.querySelector(`.marimba-key[data-note="${t}"]`);e?.classList.remove("pressed")}allNotesOff(){this.root.querySelectorAll(".marimba-key").forEach((t=>t.classList.remove("pressed")))}isNoteOn(t){const e=this.root.querySelector(`.marimba-key[data-note="${t}"]`);return!!e&&e.classList.contains("pressed")}armKeyboard(){this.armed=!0,this.container.classList.add("armed")}disarmKeyboard(){this.armed=!1,this.container.classList.remove("armed")}get isKeyboardArmed(){return this.armed}getArmedKey(t){return this.root.querySelector(`.marimba-key[data-trigger="${t}"]`)}setPatch(t){}onKeyDown(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey||1==t.repeat))if("ArrowDown"==t.key)this.emitPitchBend(-200,"keyboard");else if("ArrowUp"==t.key)this.emitPitchBend(200,"keyboard");else if(this.isKeyboardArmed){const e=this.getArmedKey(t.key.toLowerCase());e?.classList.add("pressed");const s=pt(e?.getAttribute("data-note"),-1);s>0&&this.emitNoteOn(s,"keyboard")}}onKeyUp(t){if("ArrowUp"==t.key||"ArrowDown"==t.key)this.emitPitchBend(0,"keyboard");else{const e=this.getArmedKey(t.key.toLowerCase());e?.classList.remove("pressed");const s=pt(e?.getAttribute("data-note"),-1);s>0&&this.emitNoteOff(s,"keyboard")}}}function pt(t,e=0){const s=parseInt(t);return isNaN(s)?e:s}ut.NOTES=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],ut.observedAttributes=["armed"],ut.ELEMENT="marimba-instrument";const mt=new CSSStyleSheet;mt.replaceSync("/*\n@keyframes fade-out {\n    0% {\n        opacity: 1.0;\n    }\n\n    100% {\n        opacity: 0.0;\n    }\n}\n*/\n.wrapper {\n    display: flex;\n}\n\n.instrument {\n    flex: 1;\n    position: relative;\n    box-sizing: border-box;\n    display: flex;\n}\n\n.backdrop {\n    fill: #30303f;\n}\n\n.container {\n    width: 100%;\n}\n\n.piano-key.black {\n    fill: #1d1e1f;\n    stroke: #222;\n    stroke-width: 1.5;\n    rx: 1.5;\n}\n\n.piano-key.black .black-top {\n    fill: #444;\n}\n\n.piano-key.black:hover .black-top {\n    fill: #777;\n}\n\n.piano-key.black.pressed .black-top {\n    fill: #222;\n}\n\n.piano-key.white {\n    fill: #ecedee;\n    stroke: #f7f7f8;\n    stroke-width: 1.5;\n    rx: 1.4;\n}\n\n.piano-key.white:hover {\n    fill: #ccc;\n}\n\n.piano-key.white.pressed {\n    fill: #aaa;\n    stroke: #777;\n}\n/*\n.piano-key.white.pressed.step-0 { fill: rgb(229, 76, 78); }\n.piano-key.white.pressed.step-2 { fill: rgb(228, 171, 81); }\n.piano-key.white.pressed.step-4 { fill: rgb(223, 228, 78); }\n.piano-key.white.pressed.step-5 { fill: rgb(174, 215, 71); }\n.piano-key.white.pressed.step-7 { fill: rgb(63, 169, 180); }\n.piano-key.white.pressed.step-9 { fill: rgb(78, 69, 179); }\n.piano-key.white.pressed.step-11 { fill: rgb(202, 69, 147); }\n*/\n.note-hint,\n.midi-hint,\n.key-hint {\n    stroke: none;\n    font: 9pt sans-serif;\n    fill: #0006;\n    text-anchor: middle;\n    opacity: 0.0;\n    pointer-events: none;\n    user-select: none;\n}\n\n.midi-hint.black, .note-hint.black, .key-hint.black {\n    fill: #ccc;\n}\n.show {\n    opacity: 1.0;\n}\n\n.note-hint.always-show {\n    opacity: 1.0;\n}\n\n.felt {\n    fill: #a00;\n}\n\n.animated-slide {\n    transition: transform 0.5s ease-in-out;\n}\n\n.mini-piano {\n    opacity: 0.0;\n    transition: opacity 0.25s;\n}\n\n.mini-piano.show {\n    opacity: 1.0;\n}\n\n.octave-button {\n    background-color: transparent;\n    border: none;\n    outline: none;\n    color: #fffc;\n    font-size: 14px;\n    user-select: none;\n    width: 12px;\n    padding: 0;\n    height: 100%;\n    position: absolute;\n    top: 0;\n}\n.octave-button:hover { color: #fff; }\n.octave-button:active { color: rgb(121, 216, 245); }\n#down-octave { left: 0; }\n#up-octave { right: 0; }");class ft extends HTMLElement{get minKey(){return this.props.minNote}get maxKey(){return this.props.maxNote}get minOctave(){return Math.floor(this.minKey/12)-1}get maxOctave(){const t=Math.floor(this.maxKey/12)-1,e=12*t+12;return this.maxKey-e<this.key_map.length?t-1:t}constructor(){super(),this.props={noteHints:!0,midiHints:!0,armed:!1,minNote:12,maxNote:107,keyRange:17,focusOctave:2},this.container=null,this.parent=document.createElementNS("http://www.w3.org/2000/svg","g"),this.allKeys=document.createElementNS("http://www.w3.org/2000/svg","g"),this.keys=[],this.width=700,this.height=190,this.key_map="awsedftgyhujkolp;']",this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(mt)}connectedCallback(){const t=document.createElement("template");t.innerHTML='<div classs="wrapper">\n    <button id="down-octave" class="octave-button" title="Lower Octave">❮</button>\n    <div class="instrument"><svg class="container" version="1.1"></svg></div>\n    <button id="up-octave" class="octave-button" title="Higher Octave">❯</button>\n</div>',this.root.appendChild(t.content.cloneNode(!0)),this.container=this.root.querySelector("svg.container"),this.container?.append(this.parent),this.container?.setAttribute("viewBox",`0 0 ${this.props.keyRange*gt.width} 190`),this.render(),document.addEventListener("keydown",(t=>this.onKeyDown(t))),document.addEventListener("keyup",(t=>this.onKeyUp(t))),this.root.querySelector("#down-octave")?.addEventListener("click",(t=>{this.setFocusOctave(this.props.focusOctave-1)})),this.root.querySelector("#up-octave")?.addEventListener("click",(t=>{this.setFocusOctave(this.props.focusOctave+1)}))}disconnectedCallback(){}attributeChangedCallback(t,e,s){switch(t){case"note-hints":this.setNoteHints("true"==s);break;case"midi-hints":this.setMidiHints("true"==s);break;case"armed":"true"==s?this.armKeyboard():this.disarmKeyboard();break;case"key-range":this.setKeyRange(parseInt(s));break;case"min-octave":this.setMinOctave(parseInt(s));break;case"max-octave":this.setMaxOctave(parseInt(s));break;case"min-note":this.setMinNote(parseInt(s));break;case"max-note":this.setMaxNote(parseInt(s));break;case"focus-octave":this.setFocusOctave(parseInt(s))}}emitNoteOn(t,e,s=90){const n=new CustomEvent("note-on",{bubbles:!0,composed:!0,detail:{note:t,source:e,velocity:s}});this.dispatchEvent(n)}emitNoteOff(t,e){const s=new CustomEvent("note-off",{bubbles:!0,composed:!0,detail:{note:t,source:e,velocity:0}});this.dispatchEvent(s)}emitPitchBend(t,e){const s=new CustomEvent("pitch-bend",{bubbles:!0,composed:!0,detail:{source:e,value:t}});this.dispatchEvent(s)}noteOn(t,e=90){const s=this._noteToKey(t);s?.press()}noteOff(t){let e=this._noteToKey(t);e?.release()}allNotesOff(){this.keys.forEach((t=>t.release()))}isNoteOn(t){const e=this._noteToKey(t);return null!=e&&e.isPressed()}setKeyRange(t){isNaN(t)||(this.props.keyRange=Math.max(7,Math.min(t,56)),this.container?.setAttribute("viewBox",`0 0 ${this.props.keyRange*gt.width} 190`))}setMinOctave(t){isNaN(t)||this.setMinNote(12*t+12)}setMaxOctave(t){isNaN(t)||this.setMaxNote(12*t+23)}setMinNote(t){isNaN(t)||(t=Math.max(0,Math.min(96,t)))!=this.props.minNote&&(this.props.minNote=t,this.render())}setMaxNote(t){isNaN(t)||(t=Math.max(12,Math.min(108,t)))!=this.props.maxNote&&(this.props.maxNote=t,this.render())}armKeyboard(){this.props.armed=!0,this.root.querySelectorAll(".key-hint").forEach((t=>{t.classList.add("show")}))}disarmKeyboard(){this.props.armed=!1,this.root.querySelectorAll(".key-hint").forEach((t=>{t.classList.remove("show")}))}get isKeyboardArmed(){return this.props.armed}getArmedKey(t){let e=12*this.props.focusOctave+12;e<this.props.minNote&&(e+=12);const s=this.key_map.indexOf(t.toLowerCase());return s>=0?this._noteToKey(e+s):null}setPatch(t){"min-note"in t&&this.setMinNote(yt(t["min-note"],this.props.minNote)),"max-note"in t&&this.setMaxNote(yt(t["max-note"],this.props.maxNote)),"key-range"in t&&this.setKeyRange(yt(t["key-range"],this.props.keyRange)),"focus-octave"in t&&this.setFocusOctave(yt(t["focus-octave"],this.props.focusOctave))}onKeyDown(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey||1==t.repeat)&&this.isKeyboardArmed){const e=this.getArmedKey(t.key.toLowerCase());e?(this.emitNoteOn(e.note,"keyboard"),e.press()):"ArrowLeft"==t.key?this.setFocusOctave(this.props.focusOctave-1):"ArrowRight"==t.key?this.setFocusOctave(this.props.focusOctave+1):"ArrowDown"==t.key?this.emitPitchBend(-200,"keyboard"):"ArrowUp"==t.key&&this.emitPitchBend(200,"keyboard")}}onKeyUp(t){if("ArrowUp"==t.key||"ArrowDown"==t.key)this.emitPitchBend(0,"keyboard");else{const e=this.getArmedKey(t.key.toLowerCase());e&&(this.emitNoteOff(e.note,"keyboard"),e.release())}}_noteToKey(t){for(let e of this.keys)if(e.note===t)return e;return null}render(){if(null==this.container)return;this.parent.innerHTML="",this.keys=[];const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.classList.add("backdrop"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),this.parent.append(t),this.allKeys.classList.add("animated-slide");const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g");for(let t=this.minKey;t<=this.maxKey;t++){const n=new gt(t,this);this.keys.push(n),n.black?s.append(n.el):e.append(n.el)}this.allKeys.innerHTML="",this.allKeys.append(e),this.allKeys.append(s),this.parent.append(this.allKeys);const n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.classList.add("felt"),n.setAttribute("width","100%"),n.setAttribute("height","1.5"),n.setAttribute("x","0"),n.setAttribute("y","0"),this.parent.append(n),this.setFocusOctave(this.props.focusOctave)}setFocusOctave(t){if(isNaN(t)||null==this.container)return;this.props.focusOctave=Math.max(this.minOctave,Math.min(this.maxOctave,t));let e=12*this.props.focusOctave+12;e<this.props.minNote&&(e+=12);const s=this._noteToKey(e);if(this.keys.forEach((t=>t.autoRelease())),s){const t=s.x;this.allKeys.style.transform=`translateX(${-t}px)`,this.keys.forEach((t=>t.clearKeymap()));for(let t=0;t<this.key_map.length;t++){const s=this._noteToKey(e+t);s&&s.setKeymap(this.key_map[t])}}}setNoteHints(t){this.props.noteHints=t,this.root.querySelectorAll(".note-hint").forEach((e=>{e.classList.toggle("show",t)}))}get showNoteHints(){return this.props.noteHints}setMidiHints(t){this.props.midiHints=t,this.root.querySelectorAll(".midi-hint").forEach((e=>{e.classList.toggle("show",t)}))}get showMidiHints(){return this.props.midiHints}}ft.observedAttributes=["note-hints","midi-hints","armed","min-octave","max-octave","min-note","max-note","key-range","focus-octave"],ft.ELEMENT="piano-instrument";class gt{get step(){return this.note%12}get octave(){return Math.floor(this.note/12)-1}get name(){return`${gt.NOTES[this.step]}`}get offset(){return 7*(this.octave-this.piano.minOctave)+this._key_offsets[this.step]}get x(){return this.offset*gt.width}get black(){return[1,3,6,8,10].includes(this.step)}get white(){return!this.black}get height(){return this.black?130:195}constructor(t,e){this.keyHint=document.createElementNS("http://www.w3.org/2000/svg","text"),this._key_offsets=[0,.45,1,1.55,2,3,3.4,4,4.5,5,5.6,6],this._hint_offsets=[-8,0,0,0,8,-8,0,0,0,0,0,8],this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this._down=!1,this.note=t,this.piano=e,this.el.setAttribute("transform",`translate(${this.x}, 0)`),this.el.classList.add("piano-key",`step-${this.step}`),this.el.classList.add(this.black?"black":"white");const s=this.black?10:1.5;let n=s,i=gt.width-2*s;if(this.rect.setAttribute("x",`${n}`),this.rect.setAttribute("y","-8"),this.rect.setAttribute("width",`${i}`),this.rect.setAttribute("height",`${this.height}`),this.rect.setAttribute("rx","3"),this.el.append(this.rect),this.black){n+=3,i-=6;const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.classList.add("black-top"),t.setAttribute("x",`${n}`),t.setAttribute("y","-5"),t.setAttribute("width",`${i}`),t.setAttribute("height",""+(this.height-20)),t.setAttribute("pointer-events","none"),this.el.append(t)}else{const t=document.createElementNS("http://www.w3.org/2000/svg","text");t.classList.add("note-hint"),t.setAttribute("x",`${n+i/2}`),t.setAttribute("y",""+(this.height-17)),t.innerHTML=`${this.name}${this.octave}`,this.piano.showNoteHints&&t.classList.add("show"),0==this.step&&t.classList.add("always-show"),this.el.append(t)}const r=document.createElementNS("http://www.w3.org/2000/svg","text");r.classList.add("midi-hint"),this.black&&r.classList.add("black"),r.setAttribute("x",`${n+i/2}`),r.setAttribute("y",""+(this.height-35)),r.innerHTML=`${this.note}`,this.piano.showMidiHints&&r.classList.add("show"),this.el.append(r);let a=n+i/2+this._hint_offsets[this.step];this.keyHint.classList.add("key-hint"),this.black&&this.keyHint.classList.add("black"),this.keyHint.setAttribute("x",`${a}`),this.keyHint.setAttribute("y",this.black?"45":"60"),this.piano.isKeyboardArmed&&this.keyHint.classList.add("show"),this.el.append(this.keyHint),this.el.addEventListener("pointerdown",(t=>{this.piano.emitNoteOn(this.note,"pointer"),this.press(),t.stopPropagation()})),this.el.addEventListener("pointerup",(t=>{this.piano.emitNoteOff(this.note,"pointer"),this.release()})),this.el.addEventListener("pointerleave",(t=>{this._down&&(this.piano.emitNoteOff(this.note,"pointer"),this.release())})),this.el.addEventListener("pointerenter",(t=>{t.buttons>0&&(this.piano.emitNoteOn(this.note,"pointer"),this.press())}))}press(){this._down=!0,this.el.classList.add("pressed")}release(){this._down&&(this._down=!1,this.el.classList.remove("pressed"))}isPressed(){return this.el.classList.contains("pressed")}autoRelease(){this._down&&(this.piano.emitNoteOff(this.note,"system"),this._down=!1,this.el.classList.remove("pressed"))}setKeymap(t){this.keyHint.innerHTML=t}clearKeymap(){this.keyHint.innerHTML=""}}function yt(t,e=0){const s=parseInt(t);return isNaN(s)?e:s}gt.NOTES=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],gt.width=45;class vt extends HTMLElement{constructor(){super(),this.notes=new Set,this.chord=new Array,this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(e),this.root.innerHTML='<div class="explore-wrapper">\n    <div class="keyboard-wrapper">\n        <piano-instrument></piano-instrument> \n    </div>\n    <div class="shelf">\n        <pre id="code-hint"></pre>\n        <button id="copy-button" title="Copy Code">Copy to Clipboard</button>\n    </div>\n</div>'}connectedCallback(){const t=this.root.querySelector("piano-instrument");t?.addEventListener("note-on",(t=>{const e=new r(t.detail.note);this.addCodeHint(e)})),t?.addEventListener("note-off",(t=>{const e=new r(t.detail.note);this.removeCodeHint(e)})),t?.addEventListener("click",(t=>{const e=document.querySelector("#code-hint");e&&navigator.clipboard.writeText(e.innerHTML)}))}disconnectedCallback(){}attributeChangedCallback(t,e,s){s!==e&&this.root.querySelector("piano-instrument")?.setAttribute(t,s)}getCodeHint(){if(1===this.chord.length){const t=new r(this.chord[0]);return`playNote(${t.note})    # ${t.nameWithOctave}`}return this.chord.length>0?`playNote([ ${this.chord.join(", ")} ])`:""}addCodeHint(t){this.notes.add(t.note),this.chord=[...this.notes].sort();const e=this.root.getElementById("code-hint");e&&(e.innerHTML=this.getCodeHint())}removeCodeHint(t){this.notes.delete(t.note),0==this.notes.size&&(this.chord=[])}}vt.ELEMENT="note-explorer",vt.observedAttributes=ft.observedAttributes;const bt=new CSSStyleSheet;bt.replaceSync(".ring {\n    fill: #AC6BF4;\n    \n}\n.ring:hover {\n    fill: #C9A0F7;\n}\n.outer-ring {\n    fill: #DAC5F1;\n}\n.center-circle {\n    fill: #331C4D;\n}\n\n.note {\n    fill: rgb(255, 142, 161);\n    transition: color 0.08s ease;\n}\n\n#pointer {\n    stroke: #331C4D;\n    stroke-width: 4;\n    stroke-linecap: round;\n}\n\n\n#tick-mark {\n    stroke: #FFFFFF;\n    stroke-width: 2;\n    stroke-linecap: round;\n}\n\n#music-line {\n    stroke: #000000;\n    stroke-width: 1.5;\n    stroke-linecap: round;\n}\n\n.ledger-line{\n    stroke:rgb(255, 142, 161);\n    stroke-width: 1.5;\n    stroke-linecap: round;\n}\n\n#sharp {\n    fill: rgb(255, 142, 161);\n}\n\n#stem {\n    stroke: rgb(255, 142, 161);\n    stroke-width: 1.5;\n    stroke-linecap: round;\n    transition: color 0.08s ease;\n}\n\n\n.scaled-up{\n    transform: scale(5);\n}\n\n#dynamicText {\n    user-select: none;\n    font-family: 'Tahoma', sans-serif;\n    font-size: 6px;\n    padding-left: 42px;\n    color: rgb(255, 142, 161);\n\n}\n\n.interactive-text{\n    font-size: 16px;\n    margin-left: 150px;\n    margin-top: 5px;\n    margin-bottom: 5px;\n    padding-top: 0px;\n    transition: color 0.08s ease;\n}\n\n.interactive-button{\n    font-size: 12px;\n    margin: 1px;\n    margin-left: 150px;\n    margin-top: 0px;\n    padding: 7px;\n    border-width: 0px;\n    border-style: solid;\n    background-color: #331C4D;\n    color: white;\n    border-radius: 5px;\n}\n\n.interactive-button:hover {\n    opacity: 80%;\n}\n/*\n#music-note:hover ellipse { fill: pink; }\n#music-note:hover line { stroke: pink; }\n\n#music-note:active ellipse { fill: blue; }\n#music-note:active line { stroke: blue; }\n*/\n\n.context-menu {\n    background: white;\n    border: 1px solid #888888;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n}\n\n.context-menu div {\n    padding: 8px 12px;\n    cursor: pointer;\n}\n\n.context-menu div:hover {\n    background-color: #f1f1f1;\n}\n\n.menuBox {\n    box-shadow: #888888;\n}");const wt=[60,62,64,65,67,69,71],xt=["C","D","E","F","G","A","B"],kt=["rgb(255, 142, 161)","tomato","orange","gold","rgb(157, 242, 135)","lightskyblue","plum"],At={"rgb(255, 142, 161)":"rgb(250, 85, 113)",tomato:"rgb(220, 34, 1)",orange:"rgb(226, 117, 0)",gold:"rgb(224, 190, 7)","rgb(157, 242, 135)":"rgb(82, 195, 54)",lightskyblue:"rgb(90, 169, 219)",plum:"rgb(196, 114, 196)"};class Et extends HTMLElement{constructor(){super(),this.container=null,this.wholeInteractive=null,this.notes=[],this.svgY=30,this.leftXBound=155,this.rightXBound=255,this.noteXPos=10,this.numNotes=0,this.pointerOnMenu=!1,this.allNotes=document.createElementNS("http://www.w3.org/2000/svg","g"),this.textBox=document.createElement("div"),this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(bt),this.root.innerHTML='<div id="interactive-container">\n    <svg id="interactive-svg" class="container" version="1.1" viewBox="-50 -50 500 200">\n      <g id="staff">\n        <g id="treble-clef" transform="translate(85 -34) scale(0.25)">\n          <path d="M156.716,61.478c-4.111,6.276-8.881,11.511-14.212,15.609l-8.728,6.962c-13.339,11.855-22.937,21.433-28.542,28.464\n            c-10.209,12.788-15.806,25.779-16.65,38.611c-0.942,14.473,3.187,28.21,12.275,40.84c9.636,13.458,21.8,20.754,36.164,21.69\n            c3.291,0.218,6.897,0.182,9.896-0.015l-1.121-10.104c-2.09,0.192-4.306,0.223-6.628,0.068c-9.437-0.617-17.864-4.511-25.064-11.573\n            c-7.524-7.333-10.895-15.415-10.287-24.7c1.149-17.59,12.562-35.004,33.925-51.792l9.543-7.599\n            c8.394-7.174,15.192-16.191,20.216-26.825c4.971-10.556,7.886-21.983,8.673-33.96c0.466-7.037-0.513-15.775-2.874-25.965\n            c-3.241-13.839-7.854-20.765-14.136-21.179c-2.232-0.138-4.676,0.986-7.658,3.617c-7.252,6.548-12.523,14.481-15.683,23.542\n            c-2.438,6.926-4.057,16.189-4.805,27.529c-0.313,4.72,0.313,13.438,1.805,23.962l8.844-8.192c-0.028-1.183,0.005-2.413,0.096-3.703\n            c0.466-7.221,2.289-15.062,5.394-23.293c3.956-10.296,7.689-13.409,10.133-14.204c0.668-0.218,1.32-0.298,2.015-0.254\n            c3.185,0.212,6.358,1.559,5.815,9.979C164.664,46.132,161.831,53.693,156.716,61.478z"/>\n          <path d="M164.55,209.161c5.728-2.568,10.621-6.478,14.576-11.651c5.055-6.561,7.897-14.316,8.467-23.047\n            c0.72-10.719-1.854-20.438-7.617-28.895c-6.322-9.264-14.98-14.317-25.745-15.026c-1.232-0.081-2.543-0.075-3.895,0.025\n            l-2.304-17.191l-9.668,7.112l1.483,12.194c-5.789,2.393-10.827,6.17-15.017,11.255c-4.823,5.924-7.508,12.443-7.964,19.382\n            c-0.466,7.208,1.142,13.81,4.782,19.583c1.895,3.081,4.507,5.82,7.498,8.058c4.906,3.65,10.563,3.376,11.459,1.393\n            c0.906-1.983-2.455-5.095-5.09-9.248c-1.502-2.351-2.242-5.173-2.242-8.497c0-7.053,4.256-13.116,10.317-15.799l5.673,44.211\n            l1.325,10.258c0.864,4.873,1.719,9.725,2.537,14.52c1,6.488,1.352,12.112,1.041,16.715c-0.419,6.375-2.408,11.584-5.919,15.493\n            c-2.234,2.485-4.844,4.055-7.795,4.925c3.961-3.962,6.414-9.43,6.414-15.478c0-12.075-9.792-21.872-21.87-21.872\n            c-3.353,0-6.491,0.812-9.329,2.159c-0.36,0.155-0.699,0.388-1.054,0.574c-0.779,0.425-1.559,0.85-2.286,1.362\n            c-0.249,0.187-0.487,0.403-0.732,0.605c-4.888,3.816-8.091,9.616-8.375,16.229c0,0.01-0.011,0.021-0.011,0.031\n            c0,0.005,0,0.01,0,0.016c-0.013,0.311-0.09,0.59-0.09,0.896c0,0.259,0.067,0.492,0.078,0.74\n            c-0.011,7.084,2.933,13.179,8.839,18.118c5.584,4.666,12.277,7.28,19.892,7.777c4.327,0.28,8.505-0.217,12.407-1.485\n            c3.189-1.041,6.275-2.62,9.149-4.687c6.96-5.022,10.75-11.584,11.272-19.532c0.399-6.063,0.094-13.235-0.937-21.411l-2.838-18.429\n            l-7.156-52.899c7.984,1.532,14.027,8.543,14.027,16.968c0,5.986-1.937,15.431-5.551,20.376L164.55,209.161z"/>\n        </g>\n        <g id="bass-clef" transform="translate(105 60) scale(0.37)">\n          <path d="M46.593,1.814c16.429,6.061,22.84,20.793,18.019,36.615c-4.08,13.392-12.446,23.87-23.83,31.962    C30.29,77.849,18.962,83.849,7.427,89.48c-0.507,0.247-1.605,0.185-1.874-0.162c-0.637-0.824-0.321-1.557,0.657-2.236    c6.66-4.617,13.521-8.995,19.826-14.061c13.186-10.593,21.679-24.134,23.958-41.147c0.693-5.175,0.587-10.387-0.781-15.466    c-1.404-5.217-4.386-8.989-8.422-10.997c-2.274-1.131-4.882-1.687-7.731-1.656C28.22,3.807,24.553,5.23,24.553,5.23    c-4.075,1.094-7.962,4.981-9.387,8.493c-0.759,1.872,0.258,3.629,2.275,3.713c0.851,0.035,1.756-0.127,2.566-0.405    c5.805-1.997,11.434,1.629,12.717,6.635c1.288,5.026-2.253,10.349-7.873,11.829c-7.101,1.871-14.661-2.16-16.414-9.089    c-1.289-5.096,0.289-9.794,3.124-14.09c4.377-6.632,10.97-9.698,18.415-11.333C36.121-0.366,44.489,1.037,46.593,1.814z     M70.673,39.731c0.015,3.575,2.657,6.239,6.177,6.23c3.44-0.009,6.187-2.816,6.165-6.3c-0.022-3.39-2.741-6.095-6.146-6.114    C73.325,33.527,70.658,36.189,70.673,39.731z M70.674,15.053c0.011,3.585,2.621,6.221,6.16,6.221c3.455,0,6.185-2.765,6.179-6.257    c-0.006-3.385-2.707-6.075-6.127-6.102C73.313,8.887,70.663,11.505,70.674,15.053z"/>\n        </g>\n        <line id="music-line" x1="100" x2="500" y1="0" y2="0"/>\n        <line id="music-line" x1="100" x2="500" y1="10" y2="10"/>\n        <line id="music-line" x1="100" x2="500" y1="20" y2="20"/>\n        <line id="music-line" x1="100" x2="500" y1="-10" y2="-10"/>\n        <line id="music-line" x1="100" x2="500" y1="-20" y2="-20"/>\n        <line id="music-line" x1="100" x2="100" y1="-20" y2="100"/>\n\n        <line id="music-line" x1="100" x2="500" y1="60" y2="60"/>\n        <line id="music-line" x1="100" x2="500" y1="70" y2="70"/>\n        <line id="music-line" x1="100" x2="500" y1="80" y2="80"/>\n        <line id="music-line" x1="100" x2="500" y1="90" y2="90"/>\n        <line id="music-line" x1="100" x2="500" y1="100" y2="100"/>\n\n        <rect id="play-button" x="150" y="200" width="50" height="50" fill="blue"/>\n      </g>\n\n      \n\n    </svg>\n</div>\n\n',this.svg=this.root.querySelector("svg");const e=new URL("/assets/sounds/voices/grand-piano/patch.json",t&&"SCRIPT"===t.tagName.toUpperCase()&&t.src||new URL("tunepad-interactives.min.js",document.baseURI).href);this.synth=new it(e)}playNote(t,e,s){s&&this.synth.releaseAll(),this.synth.playNote(t),setTimeout((()=>this.synth.releaseNote(t)),e)}sleep(t){return new Promise((e=>setTimeout(e,t)))}async playAll(){for(const t of this.notes)this.playNote(t.value,t.length,!1),t.textFlash(),t.noteFlash(),await this.sleep(t.length),console.log("playing one note"),t.textBlack(),t.noteReturn();console.log("playing all")}svgCoords(t,e){const s=this.svg.getScreenCTM(),n=this.svg.createSVGPoint();return n.x=t,n.y=e,n.matrixTransform(s.inverse())}render(){this.notes=[];const t=document.createElementNS("http://www.w3.org/2000/svg","g"),e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M56.15,142.08c0,0,0.38-3.35,1.97-3.93c1.52-0.56,2.24-0.46,2.24-0.46l25.71-0.44c0,0-8.78,17.73-49.27,61.81h34.94l0.54-8.42c0,0,0-2.51-3.58-5.02l25.26-29.56l0.72,43h11.47v4.84H94.5v12.9c0,0,0.72,9.5,11.65,8.6v6.79l-44.84,0.2v-5.38c0,0,12.03-1.97,11.22-9.85v-5.02c0,0,0.73-7.7-8.45-7.88l-33.75,0.54c0,0-1.44-1.89,0.02-4.12C37.54,189.74,54.9,170.3,56.15,142.08z"),t.append(e);const s=e.cloneNode(!0);s.setAttribute("transform","translate(0 -102)"),t.append(s),t.setAttribute("transform","translate(117 52) scale(0.21)");const n=t.cloneNode(!0);n.setAttribute("transform","translate(117 -28) scale(0.21)"),this.allNotes.append(t),this.allNotes.append(n),this.allNotes.setAttribute("transform","translate(20 0)")}connectedCallback(){this.container=this.root.querySelector("svg.container"),this.container?.append(this.allNotes),this.container.setAttribute("transform","scale (1)"),this.wholeInteractive=this.root.querySelector("#interactive-container"),this.render();const t=document.createElement("button");t.textContent="Play",t.classList.add("interactive-button"),this.wholeInteractive.append(t),this.wholeInteractive.append(this.textBox);let e=!1;document.addEventListener("pointerdown",(t=>{e=!0,console.log("down");const s=t.clientX,n=t.clientY,i=this.svgCoords(s,n).x,r=this.svgCoords(s,n).y;if(console.log(i,r),i>this.leftXBound&&i<this.rightXBound&&this.noteXPos<450&&r<115&&r>-40&&0==this.pointerOnMenu){const t=new St(this,this.noteXPos);this.allNotes.append(t.el),this.textBox.append(t.noteText),this.notes.push(t),console.log(this.notes),this.leftXBound+=50,this.rightXBound+=50,this.noteXPos+=50,this.numNotes+=1}})),document.addEventListener("pointermove",(t=>{if(e){const e=t.clientX,s=t.clientY;this.svgY=this.svgCoords(e,s).y}})),document.addEventListener("pointerup",(t=>{e&&console.log("up"),e=!1})),t.addEventListener("pointerdown",(t=>{this.playAll()}))}disconnectedCallback(){}attributeChangedCallback(t,e,s){}}Et.ELEMENT="note-doodle";class St{constructor(t,e){this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.note=document.createElementNS("http://www.w3.org/2000/svg","g"),this.ledgerLines=document.createElementNS("http://www.w3.org/2000/svg","g"),this.noteText=document.createElement("p"),this.contextMenu=document.createElementNS("http://www.w3.org/2000/svg","g"),this.noteGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.roundedPos=0,this.noteValue=60,this.noteColor="rgb(255, 142, 161)",this.noteLength=1e3,this.menuOpen=!1,this.selectedIcon=null,this.interactive=t,this.oldNote=0,this.inBassClef=!1,this.noteText.classList.add("interactive-text"),this.noteText.textContent="playNote(60) #C4";const s=document.createElementNS("http://www.w3.org/2000/svg","ellipse");s.setAttribute("cx","160"),s.setAttribute("cy","30"),s.setAttribute("rx","6"),s.setAttribute("ry","4.5"),s.setAttribute("class","note");const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","165.5"),n.setAttribute("x2","165.5"),n.setAttribute("y1","30"),n.setAttribute("y2","-5"),n.setAttribute("id","stem");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M780.124,451.278C791.607,571.761 822.743,570.836 890.699,654.592C978.478,762.782 922.593,888.363 880.724,953.947C897.077,887.487 1003.32,711.966 780.915,630.724C781.328,570.03 775.998,529.329 780.124,451.278Z"),i.setAttribute("fill",this.noteColor),i.setAttribute("transform","scale(0.05) translate(2540 -550)"),i.setAttribute("class","tail"),i.style.display="none",this.note.append(s),this.note.append(n),this.note.append(i);const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","152.5"),r.setAttribute("x2","167.5"),r.setAttribute("y1","30"),r.setAttribute("y2","30"),r.setAttribute("class","ledger-line");const a=r.cloneNode(!0);a.setAttribute("y1","40"),a.setAttribute("y2","40");const o=r.cloneNode(!0);o.setAttribute("y1","50"),o.setAttribute("y2","50");const h=r.cloneNode(!0);h.setAttribute("y1","-30"),h.setAttribute("y2","-30");const c=r.cloneNode(!0);c.setAttribute("y1","-40"),c.setAttribute("y2","-40");const l=r.cloneNode(!0);l.setAttribute("y1","110"),l.setAttribute("y2","110");const d=r.cloneNode(!0);d.setAttribute("y1","120"),d.setAttribute("y2","120"),[a,h,c,o,l,d].forEach((t=>t.style.display="none")),this.ledgerLines.append(r),this.ledgerLines.append(a),this.ledgerLines.append(o),this.ledgerLines.append(h),this.ledgerLines.append(c),this.ledgerLines.append(l),this.ledgerLines.append(d);const u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("x","67.5"),u.setAttribute("width","185"),u.setAttribute("y","45"),u.setAttribute("height","50"),u.setAttribute("fill","#F8F8F8"),u.classList.add(".menuBox"),u.setAttribute("stroke","#CCCCCC"),u.setAttribute("stroke-width","2"),u.setAttribute("rx","5"),u.setAttribute("ry","5");const p=document.createElementNS("http://www.w3.org/2000/svg","g"),m=document.createElementNS("http://www.w3.org/2000/svg","g"),f=document.createElementNS("http://www.w3.org/2000/svg","g"),g=document.createElementNS("http://www.w3.org/2000/svg","g"),y=document.createElementNS("http://www.w3.org/2000/svg","rect");y.setAttribute("x","72.5"),y.setAttribute("width","40"),y.setAttribute("y","50"),y.setAttribute("height","40"),y.setAttribute("fill","#E8E8E8");const v=y.cloneNode(!0);v.setAttribute("x","117.5");const b=y.cloneNode(!0);b.setAttribute("x","162.5");const w=y.cloneNode(!0);w.setAttribute("x","207.5");const x=document.createElementNS("http://www.w3.org/2000/svg","ellipse");x.setAttribute("cx","92.5"),x.setAttribute("cy","79.5"),x.setAttribute("rx","4"),x.setAttribute("ry","3"),x.style.fill="none",x.style.stroke="black";const k=document.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1","96.4"),k.setAttribute("x2","96.4"),k.setAttribute("y1","79.5"),k.setAttribute("y2","57.5"),k.style.stroke="black";const A=document.createElementNS("http://www.w3.org/2000/svg","g");A.append(x);const E=A.cloneNode(!0);E.setAttribute("transform","translate(135 -5)"),A.append(k);const S=A.cloneNode(!0);S.setAttribute("transform","translate(90 0)"),x.style.fill="black";const T=A.cloneNode(!0),_=document.createElementNS("http://www.w3.org/2000/svg","line");_.setAttribute("x1","100"),_.setAttribute("x2","96.4"),_.setAttribute("y1","63"),_.setAttribute("y2","57.5"),_.style.stroke="black",T.appendChild(_),A.setAttribute("transform","translate(45 0)"),x.style.fill="black",p.appendChild(y),p.appendChild(T),m.appendChild(v),m.appendChild(A),f.appendChild(b),f.appendChild(S),g.appendChild(w),g.appendChild(E),this.contextMenu.append(u),this.contextMenu.append(p),this.contextMenu.append(m),this.contextMenu.append(f),this.contextMenu.append(g),this.contextMenu.style.display="none",this.noteGroup.append(this.note),this.noteGroup.append(this.contextMenu),this.el.setAttribute("transform",`translate (${e} 0)`),this.el.append(this.ledgerLines),this.el.append(this.noteGroup);let P=!0;this.note.addEventListener("pointerdown",(t=>{P=!0,console.log("down on note"),this.interactive.playNote(this.noteValue,this.noteLength,!0),this.noteText.style.color=this.noteColor,this.oldNote=this.noteValue})),document.addEventListener("pointermove",(t=>{if(P){this.roundedPos=5*Math.round(this.interactive.svgY/5)-30,this.roundedPos<-75&&(this.roundedPos=-75),this.roundedPos>95&&(this.roundedPos=95);let t=-1*this.roundedPos/5;this.roundedPos>=0&&1==this.inBassClef&&(t+=4),this.noteColor=kt[(t+21)%7];let e=xt[(t+21)%7],u=Math.floor(t/7+4);this.noteValue=wt[(t+21)%7]+12*(u-4),this.noteGroup.setAttribute("transform",`translate(0 ${this.roundedPos})`),this.roundedPos<=0&&(this.inBassClef=!1),this.roundedPos>=20&&(this.inBassClef=!0),this.noteValue!=this.oldNote&&this.interactive.playNote(this.noteValue,this.noteLength,!0),this.noteText.textContent="playNote("+this.noteValue+")",this.noteText.textContent+=" #"+e+u,s.style.fill=this.noteColor,n.style.stroke=this.noteColor,i.style.fill=this.noteColor,this.noteText.style.color=this.noteColor,[r,a,h,c,o,l,d].forEach((t=>t.style.stroke=this.noteColor)),this.roundedPos<=-30||this.roundedPos>0&&this.roundedPos<=50&&this.inBassClef?(n.setAttribute("x1","154.5"),n.setAttribute("x2","154.5"),n.setAttribute("transform","translate(0 35)"),i.setAttribute("transform","scale(0.05 -0.05) translate(2322 -1750)")):(n.setAttribute("transform","translate(0 0)"),n.setAttribute("x1","165.5"),n.setAttribute("x2","165.5"),i.setAttribute("transform","scale(0.05 0.05) translate(2540 -550)")),this.roundedPos<0||this.roundedPos>15||this.inBassClef?r.style.display="none":r.style.display="block",this.roundedPos<10&&!this.inBassClef||this.roundedPos>10&&this.inBassClef?a.style.display="none":a.style.display="block",this.roundedPos>-60?h.style.display="none":h.style.display="block",this.roundedPos>-70?c.style.display="none":c.style.display="block",this.roundedPos<20&&!this.inBassClef||this.roundedPos>20?o.style.display="none":o.style.display="block",this.roundedPos<80?l.style.display="none":l.style.display="block",this.roundedPos<90?d.style.display="none":d.style.display="block",this.oldNote=this.noteValue}})),this.note.addEventListener("mouseover",(()=>{this.noteText.style.color=this.noteColor,this.noteFlash()})),this.note.addEventListener("mouseleave",(()=>{this.noteText.style.color="black",this.noteReturn()})),this.noteText.addEventListener("mouseenter",(()=>{this.noteText.style.color=this.noteColor,this.noteFlash()})),this.noteText.addEventListener("mouseleave",(()=>{this.noteText.style.color="black",this.noteReturn()})),document.addEventListener("pointerup",(t=>{P&&(console.log("released note"),P=!1,this.noteText.style.color="black")})),this.note.addEventListener("contextmenu",(t=>{t.preventDefault(),this.interactive.allNotes.appendChild(this.el),this.menuOpen=!0,this.contextMenu.style.display="block"})),document.addEventListener("pointerdown",(t=>{this.menuOpen&&(this.interactive.pointerOnMenu||(this.contextMenu.style.display="none",this.menuOpen=!1))})),this.contextMenu.addEventListener("mouseenter",(()=>this.interactive.pointerOnMenu=!0)),this.contextMenu.addEventListener("mouseleave",(()=>this.interactive.pointerOnMenu=!1)),p.addEventListener("mouseenter",(()=>this.handleMouseEnter(y,T))),p.addEventListener("mouseleave",(()=>this.handleMouseLeave(y,T))),p.addEventListener("mousedown",(()=>this.handleClick(y,T,500))),m.addEventListener("mouseenter",(()=>this.handleMouseEnter(v,A))),m.addEventListener("mouseleave",(()=>this.handleMouseLeave(v,A))),m.addEventListener("mousedown",(()=>this.handleClick(v,A,1e3))),f.addEventListener("mouseenter",(()=>this.handleMouseEnter(b,S))),f.addEventListener("mouseleave",(()=>this.handleMouseLeave(b,S))),f.addEventListener("mousedown",(()=>this.handleClick(b,S,2e3))),g.addEventListener("mouseenter",(()=>this.handleMouseEnter(w,E))),g.addEventListener("mouseleave",(()=>this.handleMouseLeave(w,E))),g.addEventListener("mousedown",(()=>this.handleClick(w,E,4e3)))}get value(){return this.noteValue}get length(){return this.noteLength}textFlash(){this.noteText.style.color=this.noteColor}textBlack(){this.noteText.style.color="black"}noteFlash(){const t=this.note.querySelector("ellipse"),e=this.note.querySelector("line"),s=this.note.querySelector("path");t&&e&&s&&(t.style.fill=At[this.noteColor],e.style.stroke=At[this.noteColor],s.style.fill=At[this.noteColor],console.log(At[this.noteColor]));const n=this.ledgerLines.querySelectorAll(".ledger-line");console.log(n),n.forEach((t=>{t.style.stroke=At[this.noteColor]})),console.log("attempting to change color")}noteReturn(){const t=this.note.querySelector("ellipse"),e=this.note.querySelector("line"),s=this.note.querySelector("path");t&&e&&s&&(t.style.fill=this.noteColor,e.style.stroke=this.noteColor,s.style.fill=this.noteColor);const n=this.ledgerLines.querySelectorAll(".ledger-line");console.log(n),n.forEach((t=>{t.style.stroke=this.noteColor}))}handleMouseEnter(t,e){t!=this.selectedIcon&&(t.style.fill="#F1F1F1",e.setAttribute("opacity","0.7"))}handleMouseLeave(t,e){t!=this.selectedIcon&&(t.style.fill="#E8E8E8",e.setAttribute("opacity","1"),console.log(t==this.selectedIcon))}handleClick(t,e,s){t.style.fill="#C1C1C1",e.setAttribute("opacity","1"),this.selectedIcon=t,this.noteLength=s}}const Tt=new CSSStyleSheet;Tt.replaceSync(".lines {\n    stroke: black;\n    stroke-width: 0.3;\n    stroke-linecap: round;\n}\n.note {\n    stroke-width: 0.3;\n    stroke-linecap: round;\n}\n.button:active {\n    fill-opacity: 0.5;\n}\n.wheel {\n    fill-opacity: 0.8;\n    stroke-width: 0;\n    box-sizing: border-box;\n}\n\n/* Steps */\n.whole {\n    fill:none; \n    stroke:grey;\n    stroke-width: 0.4;\n    stroke-linejoin: round;\n}\n.half {\n    fill:none; \n    stroke:grey;\n    stroke-width: 0.4;\n    stroke-linejoin: round;\n    stroke-dasharray: 1;\n}\n\n/* Text */\n.wheel-text {\n    font: 8px monospace;\n    fill:darkslategray;\n    text-anchor: middle;\n    text-transform: uppercase;\n    user-select: none;\n    pointer-events: none;\n}\n.major-text {\n    text-transform: uppercase;\n}\n.minor-text {\n    text-transform: lowercase;\n}\n.button-text {\n    font: 3.2px monospace;\n    text-anchor: middle;\n    user-select: none;\n    pointer-events: none;\n}\n.code {\n    font: 4px monospace;\n    stroke-width: 0;\n    text-anchor: middle;\n}\n\n/* Notes */\n.C {\n    fill:rgb(255, 142, 161);\n    stroke: rgb(255, 142, 161);\n} \n.C.hover {\n    fill:rgb(237, 63, 118);\n    stroke: rgb(237, 63, 118);\n}\n.D {\n    fill:tomato;\n    stroke:tomato;\n}\n.D.hover {\n    fill:rgb(220, 34, 1);\n    stroke:rgb(220, 34, 1);\n}\n.E {\n    fill:orange;\n    stroke:orange;\n}\n.E.hover {\n    fill:rgb(226, 117, 0);\n    stroke:rgb(226, 117, 0);\n}\n.F {\n    fill:gold;\n    stroke:gold;\n}\n.F.hover {\n    fill:rgb(207, 193, 0);\n    stroke:rgb(207, 193, 0);\n}\n.G {\n    fill:rgb(157, 242, 135);\n    stroke:rgb(157, 242, 135);\n}\n.G.hover {\n    fill:rgb(82, 195, 54);\n    stroke:rgb(82, 195, 54);\n}\n.A {\n    fill:lightskyblue;\n    stroke:lightskyblue;\n}\n.A.hover {\n    fill:rgb(29, 156, 235);\n    stroke:rgb(29, 156, 235);\n}\n.B {\n    fill:plum;\n    stroke:plum;\n}\n.B.hover {\n    fill:rgb(165, 89, 165);\n    stroke:rgb(165, 89, 165);\n}\n#scale-container {\n    max-width: 550px;\n}");class _t extends HTMLElement{constructor(){super(),this.container=null,this.parent=document.createElementNS("http://www.w3.org/2000/svg","g"),this.synth=new it,this.wheel=null,this.button=null,this.playSound=t=>{const e=t.currentTarget;let s,n=_t.NOTES.findIndex((t=>t===e.classList[1]))-_t.startNote;n<0&&(n+=7),s=_t.isMajor?e.classList.contains("last")?_t.MIDI[_t.startNote]+_t.MAJOR[n]+12:_t.MIDI[_t.startNote]+_t.MAJOR[n]:e.classList.contains("last")?_t.MIDI[_t.startNote]+_t.MINOR[n]+12:_t.MIDI[_t.startNote]+_t.MINOR[n],this.synth.scheduleNote(s,0)},this.addHover=t=>{const e=t.currentTarget;let s;s=e.classList.contains("first")?this.root.querySelectorAll(`.${e.classList[1]}.first, .wheel.${e.classList[1]}`):e.classList.contains("last")?this.root.querySelectorAll(`.${e.classList[1]}.last, .wheel.${e.classList[1]}`):this.root.querySelectorAll(`.${e.classList[1]}`),s?.forEach((t=>{t.classList.add("hover")}))},this.removeHover=t=>{const e=t.currentTarget;let s=this.root.querySelectorAll(`.${e.classList[1]}`);s?.forEach((t=>{t.classList.remove("hover")}))},this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(Tt),this.root.innerHTML='<div id="scale-container">\n  <svg id="scale-svg" class="container" version="1.1" viewBox="0 0 100 200">\n  </svg>\n</div>'}async connectedCallback(){this.container=this.root.querySelector("svg.container"),this.container?.append(this.parent),this.container?.setAttribute("viewBox","0 0 100 1000"),this.render(!0,!0),this.synth=new it;try{await this.synth.loadPatch(new URL("/sounds/voices/grand-piano/patch.json",t&&"SCRIPT"===t.tagName.toUpperCase()&&t.src||new URL("tunepad-interactives.min.js",document.baseURI).href))}catch(e){this.synth.loadPatch(new URL("/assets/sounds/voices/grand-piano/patch.json",t&&"SCRIPT"===t.tagName.toUpperCase()&&t.src||new URL("tunepad-interactives.min.js",document.baseURI).href))}}disconnectedCallback(){}attributeChangedCallback(t,e,s){}update(t,e){t&&this.render(!1,!0),e&&this.render(!1,!1)}render(t,e){if(null==this.container)return;this.parent.removeEventListener("click",this.playSound),this.parent.removeEventListener("pointerleave",this.addHover),this.parent.removeEventListener("pointerenter",this.removeHover),this.parent.innerHTML="",e||t?(this.wheel=new Nt(this),this.parent.append(this.wheel.el),this.button=new Pt(this),this.parent.append(this.button.el)):(this.wheel&&this.parent.append(this.wheel.el),this.button&&this.parent.append(this.button.el));const s=new Mt(this);this.parent.append(s.el);const n=new Ct(this);this.parent.append(n.el);const i=this.root.querySelectorAll(".note");i?.forEach((t=>{t.addEventListener("click",this.playSound),t.addEventListener("pointerenter",this.addHover),t.addEventListener("pointerleave",this.removeHover)}))}}_t.ELEMENT="music-scale",_t.observedAttributes=["min-value","max-value","value"],_t.isMajor=!0,_t.startNote=0,_t.NOTES=["C","D","E","F","G","A","B"],_t.MIDI=[60,62,64,65,67,69,71,72],_t.MAJOR=[0,2,4,5,7,9,11,12],_t.MINOR=[0,2,3,5,7,8,10,12];class Pt{get x(){return 2}get y(){return 2}get height(){return 10}get width(){return 26}constructor(t){this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.scale=t;const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",`${this.x}`),e.setAttribute("y",`${this.y}`),e.setAttribute("width",`${this.width}`),e.setAttribute("height",`${this.height}`),e.setAttribute("rx","2"),e.setAttribute("ry","2"),e.setAttribute("fill","black"),e.setAttribute("fill-opacity","0.3"),e.classList.add("button"),this.el.append(e);const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.classList.add("button-text"),s.setAttribute("x",""+(this.x+this.width-this.width/2)),s.setAttribute("y",""+(this.y+this.height-this.height/2)),s.setAttribute("dominant-baseline","central"),s.innerHTML=_t.isMajor?"Major Scales":"minor scales",this.el.append(s),this.el.addEventListener("click",(e=>{_t.isMajor=!_t.isMajor,s.innerHTML=_t.isMajor?"Major Scales":"minor scales",t.update(!0,!1)}))}}class Nt{get cx(){return 50}get cy(){return 39}get r(){return 25}get numSectors(){return 7}get angle(){return 360/this.numSectors*(Math.PI/180)}get offset(){return Math.PI/180*12.83}get pickerCoords(){return[[50,18],[47,11],[53,11]]}constructor(t){this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.wheel=document.createElementNS("http://www.w3.org/2000/svg","g"),this.text=document.createElementNS("http://www.w3.org/2000/svg","g"),this.down=!1,this.scale=t;let e=_t.startNote+1;for(let t=0;t<this.numSectors;t++){let s=_t.NOTES[(e+7)%7];const n=this.r*Math.cos(this.angle*(t+1)+this.offset)+this.cx,i=Math.abs(this.r*Math.sin(this.angle*(t+1)+this.offset)-this.cy),r=this.r*Math.cos(this.angle*t+this.offset)+this.cx,a=Math.abs(this.r*Math.sin(this.angle*t+this.offset)-this.cy),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",`M ${this.cx} ${this.cy} \n                L ${n} ${i}\n                A ${this.r} ${this.r} 0 0 1 ${r} ${a}\n                L ${this.cx} ${this.cy}`),o.classList.add("wheel",s,"note"),this.wheel.append(o);const h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",""+(n+r+this.cx)/3),h.setAttribute("y",""+(i+a+this.cy)/3),h.setAttribute("dominant-baseline","central"),h.innerHTML=`${s}`,_t.isMajor?h.classList.add("major-text"):h.classList.add("minor-text"),h.classList.add("wheel-text"),this.text.append(h),e--}this.wheel.append(this.text),this.el.append(this.wheel);const s=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.setAttribute("points",`${this.pickerCoords}`),s.setAttribute("fill","grey"),s.setAttribute("fill-opacity","0.8"),this.el.append(s);let n=0,i=0;this.el.addEventListener("pointerdown",(t=>{this.down=!0})),document.addEventListener("pointermove",(e=>{if(this.down){const t=this.svgToScreen(this.cx,this.cy),s=t.x-e.clientX,r=t.y-e.clientY;n=180*Math.atan2(r,s)/Math.PI-i,this.wheel.setAttribute("transform",`rotate(${n} ${this.cx} ${this.cy})`);const a=this.wheel.querySelectorAll(".wheel-text");a?.forEach((t=>{t.setAttribute("transform",`rotate(${-n} \n                        ${t.getAttribute("x")} \n                        ${t.getAttribute("y")})`)}))}const s=this.svgToScreen(50,18);let r=this.scale.root.elementsFromPoint(s.x,s.y);r=r.filter((t=>t.classList.contains("wheel"))),r.length>0&&(_t.startNote=_t.NOTES.indexOf(r[0].classList.item(1)),t.update(!1,!0))})),document.addEventListener("pointerup",(t=>{this.down&&(this.down=!1);const e=this.svgToScreen(this.cx,this.cy),s=e.x-t.clientX,n=e.y-t.clientY;i=180*Math.atan2(n,s)/Math.PI}))}svgToScreen(t,e){const s=this.scale.container,n=s.createSVGPoint();return n.x=t,n.y=e,n.matrixTransform(s.getScreenCTM()??void 0)}}class Mt{get max(){return 70}get min(){return this.max+13}get x0(){return 18}get y0(){return 86}constructor(t){this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.staff=document.createElementNS("http://www.w3.org/2000/svg","g"),this.scale=t;for(let t=0;t<5;t++){const e=document.createElementNS("http://www.w3.org/2000/svg","line");let s=this.max+3.25*t;e.setAttribute("x1","0"),e.setAttribute("y1",`${s}`),e.setAttribute("x2","100"),e.setAttribute("y2",`${s}`),e.classList.add("lines"),this.staff.append(e)}const e=document.createElementNS("http://www.w3.org/2000/svg","image");e.setAttribute("href",Mt.clef_url),e.setAttribute("x","0"),e.setAttribute("y","64"),e.setAttribute("width","15"),e.setAttribute("height","25"),e.onerror=t=>{Mt.clef_url="/images/treble_clef.png",e.setAttribute("href",Mt.clef_url)},this.staff.append(e),this.el.append(this.staff);let s,n=this.min+2,i=this.max-2,r=(n+i)/2,a=_t.startNote;for(let t=0;t<8;t++){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","ellipse");s=_t.NOTES[(a+7)%7];let h=this.x0+11*(a-_t.startNote),c=this.y0-1.6*a;o.setAttribute("cx",`${h}`),o.setAttribute("cy",`${c}`),o.setAttribute("rx","2"),o.setAttribute("ry","1.2"),o.setAttribute("transform",`rotate(-18, ${h}, ${c})`),e.append(o);const l=document.createElementNS("http://www.w3.org/2000/svg","line");c>r?(l.setAttribute("x1",`${h+1.9}`),l.setAttribute("y1",""+(c-.8)),l.setAttribute("x2",`${h+1.9}`),l.setAttribute("y2",""+(c-9.5))):(l.setAttribute("x1",""+(h-1.9)),l.setAttribute("y1",`${c+.8}`),l.setAttribute("x2",""+(h-1.9)),l.setAttribute("y2",`${c+9.5}`)),e.append(l),(c>n||c<i)&&e.append(this.drawLedger(h,c,i,a)),this.addAccidental(s,e,h,c),7!=t&&this.el.append(this.drawSteps(t,h,c)),e.classList.add("staff",s,"note"),0==t?e.classList.add("first"):7==t&&e.classList.add("last"),this.el.append(e),a++}}drawLedger(t,e,s,n){const i=document.createElementNS("http://www.w3.org/2000/svg","line");return i.setAttribute("x1",""+(t-3)),i.setAttribute("x2",`${t+2.7}`),n%2==0?(i.setAttribute("y1",`${e+.25}`),i.setAttribute("y2",`${e+.25}`)):e<s?(i.setAttribute("y1",`${e+1.25}`),i.setAttribute("y2",`${e+1.25}`)):(i.setAttribute("y1",""+(e-1.25)),i.setAttribute("y2",""+(e-1.25))),i}addAccidental(t,e,s,n){switch(t){case"C":switch(_t.startNote){case 1:case 2:case 5:_t.isMajor&&e.append(this.drawSharp(s,n));break;case 6:e.append(this.drawSharp(s,n))}break;case"D":switch(_t.startNote){case 2:case 6:_t.isMajor&&e.append(this.drawSharp(s,n));break;case 3:_t.isMajor||e.append(this.drawFlat(s,n))}break;case"E":switch(_t.startNote){case 0:case 3:case 4:_t.isMajor||e.append(this.drawFlat(s,n))}break;case"F":switch(_t.startNote){case 1:case 4:case 5:_t.isMajor&&e.append(this.drawSharp(s,n));break;case 2:case 6:e.append(this.drawSharp(s,n))}break;case"G":switch(_t.startNote){case 2:case 5:case 6:_t.isMajor&&e.append(this.drawSharp(s,n))}break;case"A":switch(_t.startNote){case 6:_t.isMajor&&e.append(this.drawSharp(s,n));break;case 0:case 3:_t.isMajor||e.append(this.drawFlat(s,n))}break;case"B":switch(_t.startNote){case 0:case 1:case 4:_t.isMajor||e.append(this.drawFlat(s,n));break;case 3:e.append(this.drawFlat(s,n))}}}drawSharp(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","line"),i=document.createElementNS("http://www.w3.org/2000/svg","line"),r=document.createElementNS("http://www.w3.org/2000/svg","line"),a=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttribute("x1",""+(t-5)),n.setAttribute("y1",`${e+1}`),n.setAttribute("x2",""+(t-3)),n.setAttribute("y2",""+(e-1)),s.append(n),i.setAttribute("x1",""+(t-5)),i.setAttribute("y1",`${e+3}`),i.setAttribute("x2",""+(t-3)),i.setAttribute("y2",`${e+1}`),s.append(i),r.setAttribute("x1",""+(t-4.35)),r.setAttribute("y1",`${e+4.5}`),r.setAttribute("x2",""+(t-4.35)),r.setAttribute("y2",""+(e-1.5)),s.append(r),a.setAttribute("x1",""+(t-3.55)),a.setAttribute("y1",`${e+3.5}`),a.setAttribute("x2",""+(t-3.55)),a.setAttribute("y2",""+(e-2.5)),s.append(a),s}drawFlat(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","line"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("x1",""+(t-4.35)),n.setAttribute("y1",`${e+1.5}`),n.setAttribute("x2",""+(t-4.35)),n.setAttribute("y2",""+(e-4.5)),s.append(n),i.setAttribute("d",`M ${t-4.35} ${e} A 2.5 0.5 -45 0 1 ${t-4.35} ${e+1.5}`),i.setAttribute("fill","none"),s.append(i),s}drawSteps(t,e,s){const n=document.createElementNS("http://www.w3.org/2000/svg","polyline");return _t.isMajor?2==t||6==t?n.classList.add("half"):n.classList.add("whole"):1==t||4==t?n.classList.add("half"):n.classList.add("whole"),n.setAttribute("points",`${e+.6} ${s+2.2}, \n            ${e+5.5} ${s+6}, \n            ${e+5.5} ${s+6}, \n            ${e+10.4} ${s+.6}`),n}}Mt.clef_url="/assets/images/treble_clef.png";class Ct{get x(){return 31}get y(){return 96}get height(){return 44.5}get width(){return 38}constructor(t){this.el=document.createElementNS("http://www.w3.org/2000/svg","g"),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.scale=t,this.rect.setAttribute("x",`${this.x}`),this.rect.setAttribute("y",`${this.y}`),this.rect.setAttribute("width",`${this.width}`),this.rect.setAttribute("height",`${this.height}`),this.rect.setAttribute("rx","2"),this.rect.setAttribute("ry","2"),this.rect.setAttribute("fill","black"),this.rect.setAttribute("fill-opacity","0.7"),this.el.append(this.rect);let e=_t.MIDI[_t.startNote];for(let t=0;t<8;t++){const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",""+(this.x+this.width-this.width/2+.7)),s.setAttribute("y",`${this.y+5+5*t}`),s.setAttribute("dominant-baseline","central"),_t.isMajor?s.innerHTML=`playNote(${e+_t.MAJOR[t]})`:s.innerHTML=`playNote(${e+_t.MINOR[t]})`,s.classList.add("code",_t.NOTES[(_t.startNote+t+7)%7],"note"),0==t?s.classList.add("first"):7==t&&s.classList.add("last"),this.el.append(s)}}}const Lt="rgb(220, 100, 70)",Bt="rgb(150, 190, 215)",qt="rgb(250, 210, 110)",Rt="rgb(255, 220, 220)";function Vt(t,e){return[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[0]*Math.sin(e)-t[1]*Math.cos(e)]}function Ot(t,e,s){return function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}([e[0]-t[0],e[1]-t[1],e[2]-t[2]],[s[0]-t[0],s[1]-t[1],s[2]-t[2]])}function It(t){const e=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}(t);return[t[0]/e,t[1]/e,t[2]/e]}const Dt=It([-100,-80,-1]);class $t{constructor(t,e,s,n,i){this.note=0,this.petals=new Array,this.currentC=0,this.last_beat=-1,this.cx=this.currentX=this.targetX=e,this.h=this.currentH=this.targetH=s,this.r=this.currentR=this.targetR=n,this.note=t,this.color=i;for(let t=0;t<16;t++)this.petals.push(0)}get isAnimating(){return Math.abs(this.targetX-this.currentX)>.1||Math.abs(this.targetH-this.currentH)>.1||Math.abs(this.targetR-this.currentR)>.1}animateTo(t,e,s){this.targetX=t,this.targetH=e,this.targetR=s}moveTo(t,e,s){this.cx=this.currentX=this.targetX=t,this.h=this.currentH=this.targetH=e,this.r=this.currentR=this.targetR=s}bounce(t=1.05){this.currentR*=t}restore(){this.targetX=this.cx,this.targetH=this.h,this.targetR=this.r}animate(t){return this.currentX+=.25*(this.targetX-this.currentX),this.currentH+=.25*(this.targetH-this.currentH),this.currentR+=.25*(this.targetR-this.currentR),this.currentC+=.1*(0-this.currentC),this.isAnimating}_surfaceNormal(t,e){const s=-2*Math.PI/16,n=4*s,i=Vt([1,0],t*s-n),r=Vt([1,0],e?(t+1)*s-n:(t-1)*s-n),a=this.isPetalHighlighted(t)?-.05:.05;return It(e?Ot([i[0],i[1],a],[0,0,0],[r[0],r[1],0]):Ot([0,0,0],[i[0],i[1],a],[r[0],r[1],0]))}_shadowColor(t,e,s=1){const n=this._surfaceNormal(t,e),i=Math.max(-1,Math.min(1,function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(Dt,n)*s));return i>0?`rgba(255, 255, 255, ${i})`:`rgba(0, 0, 0, ${-i})`}_halfPetalShape(t,e,s,n){const i=this.currentX,r=e-this.currentH,a=this.currentR,o=a/5.7,h=-2*Math.PI/16,c=4*h;t.resetTransform(),t.translate(i,r),t.scale(1,-1),t.rotate(s*h-c),t.moveTo(0,0),n?t.bezierCurveTo(.8*a,o,.8*a,o,a,0):t.bezierCurveTo(.8*a,-o,.8*a,-o,a,0),t.lineTo(0,0)}_petalShape(t,e,s){t.beginPath(),this._halfPetalShape(t,e,s,!0),this._halfPetalShape(t,e,s,!1),t.closePath()}drawShadow(t,e){t.save(),t.beginPath();for(let s=0;s<16;s++)this._halfPetalShape(t,e,s,!0),this._halfPetalShape(t,e,s,!1);t.closePath(),t.shadowBlur=8,t.shadowOffsetX=-10,t.shadowOffsetY=10,t.shadowColor="#0005",t.fillStyle=this.color,t.fill(),t.restore()}_drawLeaf(t,e,s){const n=this.cx;e+=5;const i=120;t.save(),t.resetTransform(),t.translate(n,e),t.scale(1,-1),t.rotate(s),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(84,36,i,0),t.quadraticCurveTo(84,-36,0,0),t.fillStyle="#006600",t.fill(),t.lineWidth=1.5,t.strokeStyle="#fff3",t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(30,-2.4,114,0),t.stroke(),t.restore()}drawStem(t,e,s){const n=this.cx,i=this.currentX,r=e-this.currentH,a=e-80,o=(a+r)/2,h=Math.floor(s/4)%2==0;t.save(),t.beginPath(),t.moveTo(i,r),t.lineWidth=9,t.strokeStyle="#006600",t.shadowBlur=8,t.shadowOffsetX=-6,t.shadowOffsetY=8,t.shadowColor="#0003",t.bezierCurveTo(h?i+50:i-50,o,h?n-50:n+50,o,n,a),t.stroke(),t.restore();const c=h?.07*Math.PI:-.07*Math.PI;this._drawLeaf(t,a,.25*Math.PI+c),this._drawLeaf(t,a,.75*Math.PI+c)}drawNumbers(t,e){t.save(),t.font="30px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#fffa";const s=2*Math.PI/16,n=4*s;for(let i=0;i<16;i++){const r=this.currentR-35,a=s*i-n,o=this.currentX+r*Math.cos(a),h=e-this.currentH+r*Math.sin(a);i%4==0?t.fillText(""+(i/4+1),o,h):t.fillText("•",o,h)}t.restore()}_drawHalfPetal(t,e,s,n,i=!1){const r=this.currentR;t.resetTransform(),t.save(),t.beginPath(),this._halfPetalShape(t,e,s,n),t.closePath(),t.fillStyle=this.color,t.fill(),t.lineWidth=1,t.strokeStyle="#0001",i?(t.fillStyle="#fff8",t.strokeStyle="white"):this.isPetalHighlighted(s)?t.fillStyle="#fff8":t.fillStyle=this._shadowColor(s,n),t.fill(),t.stroke(),t.beginPath(),t.moveTo(0,n?1:-1),t.lineTo(r,n?1:-1),t.lineWidth=1,t.strokeStyle=this._shadowColor(s,n,.9),t.stroke(),t.restore()}drawCenter(t,e){const s=this.currentX,n=e-this.currentH,i=this.currentR/5.5;t.resetTransform(),t.save(),t.beginPath(),t.arc(s,n,i,0,2*Math.PI),t.fillStyle=this.color,t.shadowBlur=4,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor="#0007",t.fill(),t.restore();for(let e=0;e<16;e++)t.resetTransform(),t.save(),t.beginPath(),t.translate(s,n),t.scale(1,-1),t.rotate(e*Math.PI*2/16),t.moveTo(0,0),t.lineTo(i,.187*i),t.quadraticCurveTo(1.25*i,0,i,-.187*i),t.closePath(),t.fillStyle=this.color,t.strokeStyle="#0001",t.lineWidth=.5,t.fill(),t.stroke(),this.currentC>0&&(t.fillStyle=`rgba(255, 255, 255, ${this.currentC})`,t.fill()),t.restore()}_drawPetal(t,e,s,n=!1){this._drawHalfPetal(t,e,s,!0,n),this._drawHalfPetal(t,e,s,!1,n)}draw(t,e,s=-1){s!=this.last_beat&&this.isPetalHighlighted(s)&&this.bounce(1.02);for(let n=0;n<16;n++)this._drawPetal(t,e,n,s==n);this.drawCenter(t,e),this.last_beat=s}hitTest(t,e,s,n){const i=this.currentX,r=n-this.currentH,a=this.currentR,o=e-i,h=s-r,c=Math.sqrt(o*o+h*h);if(c>1.25*a)return-1;if(c<a/5.5)return 16;for(let i=this.petals.length-1;i>=0;i--){if(this._petalShape(t,n,i),t.isPointInPath(e,s))return i;t.restore()}return-1}isPetalHighlighted(t){return t>=0&&t<this.petals.length&&this.petals[t]>0}highlightPetal(t,e=100){t>=0&&t<this.petals.length&&(this.petals[t]=e)}unhighlightPetal(t){t>=0&&t<this.petals.length&&(this.petals[t]=0)}togglePetal(t,e=100){t>=0&&t<this.petals.length&&(this.petals[t]=this.petals[t]>0?0:e)}load(t){for(let e=0;e<this.petals.length;e++)1&~t?this.unhighlightPetal(e):this.highlightPetal(e),t>>=1}save(){let t=0;for(let e=this.petals.length-1;e>=0;e--)this.isPetalHighlighted(e)?t=t<<1|1:t<<=1;return t}}class Ft{get x(){return this.px.pixel}get y(){return this.py.pixel}constructor(t,e,s,n="bee"){this.r=40,this.h=Math.PI/2,this.down=!1,this.dockX=-1,this.dockY=-1,this.docked=!1,this.trail=[],this.garden=t,this.px=e,this.py=s,this.targetX=this.x,this.targetY=this.y,this.targetH=this.h,t.canvas.addEventListener("pointermove",(t=>{if(this.down){this.targetX=t.offsetX,this.targetY=t.offsetY;const e=this.targetX-this.x,s=this.targetY-this.y,i=-1*Math.atan2(s,e);this.targetH=i<0?2*Math.PI+i:i,this.garden.shimmer(n)}})),t.canvas.addEventListener("pointerup",(e=>{this.down&&(this.down=!1,t.releasePointerCapture(e.pointerId),(this.px.outOfBounds()||this.py.outOfBounds())&&this.dock(this.dockX,this.dockY),this.trail=[],t.render())})),this.img=new Image,this.img.src=`/images/insects/${n}-small.png`,this.img.onload=()=>{this.garden.render()},this.img.onerror=()=>{this.img.src=`/assets/images/insects/${n}-small.png`}}dock(t,e){this.dockX=t,this.dockY=e,this.docked=!0,this.animateTo(t,e),this.px.active=!1,this.py.active=!1,this.h=this.targetH=Math.PI/2}undock(){this.animateTo(this.px.defaultPixel,this.py.defaultPixel),this.docked=!1,this.px.active=!0,this.py.active=!0}get dragging(){return this.down}get isAnimating(){return this.down||Math.abs(this.targetX-this.x)>.1||Math.abs(this.targetY-this.y)>.1}hitTest(t,e){const s=this.x,n=this.y,i=this.r,r=t-s,a=e-n;return Math.sqrt(r*r+a*a)<=i}pointerDown(t){return!!this.hitTest(t.offsetX,t.offsetY)&&(this.docked?(this.undock(),!0):(this.down=!0,this.trail=[],this.garden.canvas.setPointerCapture(t.pointerId),!0))}animateTo(t,e){this.targetX=t,this.targetY=e}animate(t){const e=.05*(this.targetX-this.x),s=.05*(this.targetY-this.y);if(this.px.pixel+=e,this.py.pixel+=s,this.docked||(this.py.clamp(),this.px.perc<0&&(this.px.perc=0)),this.h=this.targetH,!this.docked&&this.down)if(this.trail.length>150&&this.trail.shift(),this.trail.length>0){const t=this.trail[this.trail.length-1][0],e=this.trail[this.trail.length-1][1];(Math.abs(this.x-t)>1||Math.abs(this.y-e)>1)&&this.trail.push([this.x,this.y])}else this.trail.push([this.x,this.y]);return this.isAnimating}drawTrail(t){if(!(this.trail.length<3)){t.save(),t.lineWidth=5,t.lineJoin="round",t.lineCap="round",t.strokeStyle="#fffa",t.setLineDash([10,10]),t.beginPath(),t.moveTo(this.trail[0][0],this.trail[0][1]);for(let e=1;e<this.trail.length;e++)t.lineTo(this.trail[e][0],this.trail[e][1]);t.stroke(),t.restore()}}drawShadow(t){const e=this.dockX,s=this.dockY,n=this.r/2;t.save(),t.fillStyle="#0003",t.beginPath(),t.arc(e,s,n,0,2*Math.PI),t.fill(),t.restore()}draw(t){const e=this.x,s=this.y,n=this.r,i=this.h;t.save(),t.resetTransform(),t.translate(e,s),t.scale(1,-1),t.rotate(i),t.beginPath(),this.img.complete&&this.img.width>0&&(t.shadowBlur=5,t.shadowColor="#0003",t.shadowOffsetX=-5,t.shadowOffsetY=5,t.drawImage(this.img,-n,-n,2*n,2*n)),t.restore()}}class Ht{constructor(t,e,s,n){this.notes=new Map([[0,1],[2,1],[4,1],[6,1]]),this.x=t,this.y=e,this.w=s,this.h=n}hit(t){this.notes.set(t,1.5)}animate(t){let e=!1;return this.notes.forEach(((t,s)=>{t>1.01&&(t*=.97,e=!0,this.notes.set(s,t))})),e}_drawKick(t){t.save();{const e=this.w/2,s=.63*this.h,n=8*(this.notes.get(0)??1);t.lineWidth=2,t.strokeStyle="black",t.fillStyle=Lt,t.beginPath(),t.arc(e,s,n,0,2*Math.PI),t.fill(),t.stroke()}t.restore()}_drawHat(t){const e=.27*this.w,s=.32*this.h,n=.5*this.h,i=.37*this.h,r=5*((this.notes.get(4)??1)-1);t.save(),t.beginPath(),t.moveTo(e,s),t.lineTo(e,n),t.stroke(),t.beginPath(),t.moveTo(e-8,i-r),t.lineTo(e+8,i+r),t.stroke(),t.restore()}_drawTom(t){const e=.68*this.w,s=.52*this.h,n=.75*this.h,i=13.5*(this.notes.get(6)??1),r=13.5*(this.notes.get(6)??1);t.save(),t.beginPath(),t.moveTo(e,s),t.lineTo(e,n),t.stroke(),t.fillStyle=qt,t.fillRect(e-i/2,s-r/2,i,r),t.strokeRect(e-i/2,s-r/2,i,r),t.restore()}_drawSnare(t){const e=.33*this.w,s=.52*this.h,n=.75*this.h,i=13.5*(this.notes.get(2)??1),r=7*(this.notes.get(2)??1);t.save(),t.beginPath(),t.moveTo(e,s),t.lineTo(e,n),t.stroke(),t.fillStyle=Bt,t.fillRect(e-i/2,s-r/2,i,r),t.strokeRect(e-i/2,s-r/2,i,r),t.restore()}draw(t){const e=this.x,s=this.y,n=this.w,i=this.h,r=n/2-6;t.resetTransform(),t.save(),t.lineJoin="round",t.translate(e,s),t.beginPath(),t.arc(n/2,i/2,r,0,2*Math.PI),t.fillStyle="#ddd",t.fill(),t.lineWidth=2,t.strokeStyle="black",t.moveTo(3*3.7,.75*i),t.lineTo(n-3*3.7,.75*i),t.stroke(),this._drawHat(t),this._drawSnare(t),this._drawTom(t),this._drawKick(t),t.restore()}}class Gt{constructor(t,e,s,n){this.name="",this.unit="",this._default=.5,this.inverted=!1,this.changed=!1,this.active=!0,this.minValue=t,this.maxValue=e,this.minPixel=s,this.maxPixel=n,this.p=.5}clamp(){this.p=Math.max(0,Math.min(1,this.p))}get valueRange(){return this.maxValue-this.minValue}get pixelRange(){return this.maxPixel-this.minPixel}get value(){return this.minValue+this.p*this.valueRange}set value(t){this.p=(t-this.minValue)/this.valueRange,this.changed=!0}set defaultValue(t){this._default=t}get defaultValue(){return this._default}get defaultPerc(){return(this._default-this.minValue)/this.valueRange}get defaultPixel(){return this.percToPixel(this.defaultPerc)}get pixel(){return this.percToPixel(this.p)}set pixel(t){this.inverted?this.p=1-(t-this.minPixel)/this.pixelRange:this.p=(t-this.minPixel)/this.pixelRange,this.changed=!0}get perc(){return this.p}set perc(t){this.p=t,this.changed=!0}percToPixel(t){return this.inverted?this.minPixel+(1-t)*this.pixelRange:this.minPixel+t*this.pixelRange}outOfBounds(){return this.p>1||this.p<0}}const zt=new CSSStyleSheet;zt.replaceSync("* {\n    box-sizing: border-box;\n}\n\n#garden-container {\n   text-align: left;\n   margin: 0;\n   padding: 0;\n   position: relative;\n   max-width: fit-content;\n}\n\n#garden-canvas {\n    margin: 0;\n    padding: 0;\n    background-image: url('/images/textures/bluesky.jpg'), url('/assets/images/textures/bluesky.jpg');\n    background-size: cover; \n    touch-action: none;\n}\n\n\n#home-button {\n    outline: none;\n    border: none;\n    color: white;\n    background-color: transparent;\n    width: 50px;\n    height: 50px;\n    left: 20px;\n    top: 15px;\n    font-size: 50px;\n    position: absolute;\n    font-family: \"Barriecito\", system-ui;\n    font-weight: bold;\n}\n\n.bpm-indicator {\n    font-family: \"Barriecito\", system-ui;\n    font-weight: 400;\n    font-style: normal;\n    font-size: 30px;\n    position: absolute;\n    top: 20px;\n    right: 50px;\n    width: 200px;\n    height: 50px;\n    pointer-events: none;\n    color: white;\n    text-align: right;\n}\n\n@keyframes play-slide {\n    0%   {background-color: green; right: 0px; border-color: #3d4a3dcc; }\n    100% {background-color: #ba5c38; right: calc(100% - 60px); border-color: #a10606; }\n}\n  \n.play-groove {\n    width: 280px;\n    height: 60px;\n    background-color: transparent;\n    position: absolute;\n    border-radius: 30px;\n    right: 20px;\n    bottom: 10px;\n}\n\n.play-groove.pause {\n    background-color: #fff9;\n}\n\n#play-pause-button {\n    width: 60px;\n    height: 60px;\n    font-size: 25px;\n    text-align: center;\n    color: #fffc;\n    border-width: 3px;\n    border-radius: 50%;\n    border-style: solid;\n    border-color: #3d4a3dcc;\n    background-color: #518a78;\n    outline: none;\n    position: absolute;\n    right: 0px;\n    top: 0px;\n    fill: #fffc;\n    padding: 10px;\n}\n#play-pause-button svg.play {\n    position: relative;\n    left: 2px;\n}\n#play-pause-button:active {\n    fill: white;\n}\n.pause #play-pause-button {\n    animation-name: play-slide;\n    animation-duration: 0.25s;\n    font-size: 35px;\n    right: calc(100% - 60px);\n    background-color: #ba5c38;\n    border-color: #a10606;\n}\n#play-pause-button svg.stop { display: none; }\n#play-pause-button svg.play { display: block; }\n.pause #play-pause-button svg.stop { display: block; }\n.pause #play-pause-button svg.play { display: none; }\n\n.genre-wrapper {\n    position: absolute;\n    color: white;\n    border: 1px solid white;\n    border-radius: 0.5em;\n    left: 100px;\n    bottom: 12px;\n    height: 55px;\n    width: 300px;\n    background-color: #0004;\n    box-sizing: border-box;\n}\n\n.genre-select {\n    outline: none;\n    border: none;\n    font-family: \"Barriecito\", system-ui;\n    font-weight: 400;\n    font-style: normal;\n    font-size: 30px;\n    appearance: none;\n    padding-left: 20px;\n    background-color: transparent;\n    height: 55px;\n    color: white;\n    width: 250px;\n}\n\n.genre-wrapper::after {\n    content: '▼';\n    font-size: 150%;\n    position: relative;\n    top: -3px;\n}\n\n\n#qrcode {\n    width: 60px;\n    position: absolute;\n    right: 20px;\n    bottom: 92px;\n    display: none;\n}\n\n#qrcode.big {\n    background-color: white;\n    border-left: 40px solid white;\n    border-top: 40px solid white;\n    border-radius: 20px;\n    width: 500px;\n    height: 500px;\n    right: calc(50% - 250px);\n    bottom: calc(50% - 250px);\n    animation-name: qr-slide;\n    animation-duration: 0.25s;\n}\n\n@keyframes qr-slide {\n    0% {\n        background-color: transparent;\n        width: 60px;\n        height: 60px;\n        right: 20px;\n        bottom: 92px;\n    }\n    100% {\n        background-color: white; \n        width: 500px;\n        height: 500px;\n        right: calc(50% - 250px);\n        bottom: calc(50% - 250px);\n    }\n}");function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function jt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==s)return;var n,i,r=[],a=!0,o=!1;try{for(s=s.call(t);!(a=(n=s.next()).done)&&(r.push(n.value),!e||r.length!==e);a=!0);}catch(t){o=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||Jt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ut(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xt(t,e)}function Xt(t,e){return Xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xt(t,e)}function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var s,n=Qt(t);if(e){var i=Qt(this).constructor;s=Reflect.construct(n,arguments,i)}else s=n.apply(this,arguments);return function(t,e){if(e&&("object"===Kt(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,s)}}function Qt(t){return Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qt(t)}function Yt(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=Jt(t))||e){s&&(t=s);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return a=t.done,t},e:function(t){o=!0,r=t},f:function(){try{a||null==s.return||s.return()}finally{if(o)throw r}}}}function Jt(t,e){if(t){if("string"==typeof t)return Zt(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Zt(t,e):void 0}}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function se(t,e,s){return e&&ee(t.prototype,e),s&&ee(t,s),t}
/*!
     * easy-qrcode v0.1.0
     * https://github.com/ArcherGu/easy-qrcode.git
     * @license MIT
     */for(var ne=[],ie=[],re=1,ae=0;ae<255;ae++)ne[ae]=re,ie[re]=ae,256&(re<<=1)&&(re^=285);for(var oe=255;oe<512;oe++)ne[oe]=ne[oe-255];function he(t){if(t<1)throw new Error("log(".concat(t,")"));return ie[t]}function ce(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return ne[t]}function le(t,e){return 0===t||0===e?0:ne[ie[t]+ie[e]]}var de,ue=function(){function t(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;te(this,t),this.num=[];for(var n=0,i=e.length;n<i&&0===e[n];)n++;i-=n;for(var r=0;r<i;r++)this.num.push(e[n+r]);for(var a=0;a<s;a++)this.num.push(0)}return se(t,[{key:"at",value:function(t){return this.num[t]}},{key:"length",value:function(){return this.num.length}}],[{key:"mul",value:function(e,s){for(var n=[],i=e.length(),r=s.length(),a=0;a<i+r-1;a++)n.push(0);for(var o=0;o<i;o++)for(var h=0;h<r;h++)n[o+h]^=le(e.at(o),s.at(h));return new t(n)}},{key:"mod",value:function(e,s){var n=e.length(),i=s.length();if(n-i<0)return e;for(var r=he(e.at(0))-he(s.at(0)),a=[],o=0;o<n;o++)a.push(e.at(o));for(var h=0;h<i;h++)a[h]^=ce(he(s.at(h))+r);return t.mod(new t(a),s)}}]),t}();function pe(t){for(var e=new ue([1]),s=0;s<t;s++)e=ue.mul(e,new ue([1,ce(s)]));return e}!function(t){t[t.L=1]="L",t[t.M=0]="M",t[t.Q=3]="Q",t[t.H=2]="H"}(de||(de={}));var me,fe;function ge(t){switch(t){case me.PATTERN000:return function(t,e){return!(t+e&1)};case me.PATTERN001:return function(t,e){return!(1&e)};case me.PATTERN010:return function(t,e){return t%3==0};case me.PATTERN011:return function(t,e){return(t+e)%3==0};case me.PATTERN100:return function(t,e){return!((t/3|0)+(e/2|0)&1)};case me.PATTERN101:return function(t,e){return(t*e&1)+t*e%3==0};case me.PATTERN110:return function(t,e){return!((t*e&1)+t*e%3&1)};case me.PATTERN111:return function(t,e){return!(t*e%3+(t+e&1)&1)};default:throw new Error("invalid mask: ".concat(t))}}function ye(t,e,s){return null!==t[e][s]&&!!t[e][s]}function ve(t,e,s){for(var n=0,i=0;i<e;i++)for(var r=null,a=0,o=0;o<e;o++){var h=s?ye(t,i,o):ye(t,o,i);h===r?5===++a?n+=3:a>5&&n++:(r=h,a=1)}return n}function be(t,e,s,n,i,r){n=Math.max(n,0),i=Math.min(i,e);for(var a=n;a<i;a++){if(r?ye(t,s,a):ye(t,a,s))return!1}return!0}function we(t,e){return function(t,e){return ve(t,e,!0)+ve(t,e,!1)}(t,e)+function(t,e){for(var s=0,n=0;n<e-1;n++)for(var i=0;i<e-1;i++){var r=ye(t,n,i);r===ye(t,n,i+1)&&r===ye(t,n+1,i)&&r===ye(t,n+1,i+1)&&(s+=3)}return s}(t,e)+function(t,e){for(var s=0,n=0;n<e;n++)for(var i=0;i<e;i++)i+6<e&&ye(t,n,i)&&!ye(t,n,i+1)&&ye(t,n,i+2)&&ye(t,n,i+3)&&ye(t,n,i+4)&&!ye(t,n,i+5)&&ye(t,n,i+6)&&(be(t,e,n,i-4,i,!0)||be(t,e,n,i+7,i+11,!0))&&(s+=40),n+6<e&&ye(t,n,i)&&!ye(t,n+1,i)&&ye(t,n+2,i)&&ye(t,n+3,i)&&ye(t,n+4,i)&&!ye(t,n+5,i)&&ye(t,n+6,i)&&(be(t,e,i,n-4,n,!1)||be(t,e,i,n+7,n+11,!1))&&(s+=40);return s}(t,e)+function(t,e){for(var s=0,n=0;n<e;n++)for(var i=0;i<e;i++)ye(t,n,i)&&s++;var r=e*e;return 10*Math.floor(Math.abs(20*s-10*r)/r)}(t,e)}!function(t){t[t.PATTERN000=0]="PATTERN000",t[t.PATTERN001=1]="PATTERN001",t[t.PATTERN010=2]="PATTERN010",t[t.PATTERN011=3]="PATTERN011",t[t.PATTERN100=4]="PATTERN100",t[t.PATTERN101=5]="PATTERN101",t[t.PATTERN110=6]="PATTERN110",t[t.PATTERN111=7]="PATTERN111"}(me||(me={})),function(t){t[t.Numeric=1]="Numeric",t[t.Alphanumeric=2]="Alphanumeric",t[t.Byte=4]="Byte",t[t.Kanji=8]="Kanji",t[t.ECI=7]="ECI"}(fe||(fe={}));var xe,ke=function(){function t(e,s){te(this,t),this.mode=e,this.data=s}return se(t,[{key:"getMode",value:function(){return this.mode}},{key:"getLength",value:function(){return this.bytes.length}},{key:"getCharCountIndexBitLength",value:function(t){var e=this.mode,s=new Error("invalid QR mode: ".concat(e));if(1<=t&&t<10)switch(e){case fe.Numeric:return 10;case fe.Alphanumeric:return 9;case fe.Byte:case fe.Kanji:return 8;default:throw s}else if(t<27)switch(e){case fe.Numeric:return 12;case fe.Alphanumeric:return 11;case fe.Byte:return 16;case fe.Kanji:return 10;default:throw s}else{if(!(t<41))throw new Error("invalid version: ".concat(t));switch(e){case fe.Numeric:return 14;case fe.Alphanumeric:return 13;case fe.Byte:return 16;case fe.Kanji:return 12;default:throw s}}}}]),t}(),Ae=[[33088,"　、。，．・：；？！゛゜´｀¨＾￣＿ヽヾゝゞ〃仝々〆〇ー―‐／＼～∥｜…‥‘’“”（）〔〕［］｛｝〈〉《》「」『』【】＋－±×"],[33152,"÷＝≠＜＞"],[33167,"￥＄￠￡％＃＆＊＠§☆★"],[33190,"※〒→←↑↓〓"],[33226,"￢"],[33359,"０１２３４５６７８９"],[33376,"ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ"],[33409,"ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ"],[33439,"ぁあぃいぅうぇえぉおかがきぎくぐけげこごさざしじすずせぜそぞただちぢっつづてでとどなにぬねのはばぱひびぴふぶぷへべぺほぼぽまみむめもゃやゅゆょよらりるれろゎわゐゑをん"],[33600,"ァアィイゥウェエォオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミ"],[33664,"ムメモャヤュユョヨラリルレロヮワヰヱヲンヴヵヶ"],[33695,"ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩ"],[33727,"αβγδεζηθικλμνξοπρστυφχψω"],[33856,"АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ"],[33904,"абвгдеёжзийклмн"],[33920,"опрстуфхцчшщъыьэюя"],[34688,"〝〟"],[35136,"院陰隠韻吋右宇烏羽迂雨卯鵜窺丑碓臼渦嘘唄欝蔚鰻姥厩浦瓜閏噂云運雲荏餌叡営嬰影映曳栄永泳洩瑛盈穎頴英衛詠鋭液疫益駅悦謁越閲榎厭円"],[35200,"園堰奄宴延怨掩援沿演炎焔煙燕猿縁艶苑薗遠鉛鴛塩於汚甥凹央奥往応押旺横欧殴王翁襖鴬鴎黄岡沖荻億屋憶臆桶牡乙俺卸恩温穏音下化仮何伽価佳加可嘉夏嫁家寡科暇果架歌河火珂禍禾稼箇花苛茄荷華菓蝦課嘩貨迦過霞蚊俄峨我牙画臥芽蛾賀雅餓駕介会解回塊壊廻快怪悔恢懐戒拐改"],[35392,"魁晦械海灰界皆絵芥蟹開階貝凱劾外咳害崖慨概涯碍蓋街該鎧骸浬馨蛙垣柿蛎鈎劃嚇各廓拡撹格核殻獲確穫覚角赫較郭閣隔革学岳楽額顎掛笠樫"],[35456,"橿梶鰍潟割喝恰括活渇滑葛褐轄且鰹叶椛樺鞄株兜竃蒲釜鎌噛鴨栢茅萱粥刈苅瓦乾侃冠寒刊勘勧巻喚堪姦完官寛干幹患感慣憾換敢柑桓棺款歓汗漢澗潅環甘監看竿管簡緩缶翰肝艦莞観諌貫還鑑間閑関陥韓館舘丸含岸巌玩癌眼岩翫贋雁頑顔願企伎危喜器基奇嬉寄岐希幾忌揮机旗既期棋棄"],[35648,"機帰毅気汽畿祈季稀紀徽規記貴起軌輝飢騎鬼亀偽儀妓宜戯技擬欺犠疑祇義蟻誼議掬菊鞠吉吃喫桔橘詰砧杵黍却客脚虐逆丘久仇休及吸宮弓急救"],[35712,"朽求汲泣灸球究窮笈級糾給旧牛去居巨拒拠挙渠虚許距鋸漁禦魚亨享京供侠僑兇競共凶協匡卿叫喬境峡強彊怯恐恭挟教橋況狂狭矯胸脅興蕎郷鏡響饗驚仰凝尭暁業局曲極玉桐粁僅勤均巾錦斤欣欽琴禁禽筋緊芹菌衿襟謹近金吟銀九倶句区狗玖矩苦躯駆駈駒具愚虞喰空偶寓遇隅串櫛釧屑屈"],[35904,"掘窟沓靴轡窪熊隈粂栗繰桑鍬勲君薫訓群軍郡卦袈祁係傾刑兄啓圭珪型契形径恵慶慧憩掲携敬景桂渓畦稽系経継繋罫茎荊蛍計詣警軽頚鶏芸迎鯨"],[35968,"劇戟撃激隙桁傑欠決潔穴結血訣月件倹倦健兼券剣喧圏堅嫌建憲懸拳捲検権牽犬献研硯絹県肩見謙賢軒遣鍵険顕験鹸元原厳幻弦減源玄現絃舷言諺限乎個古呼固姑孤己庫弧戸故枯湖狐糊袴股胡菰虎誇跨鈷雇顧鼓五互伍午呉吾娯後御悟梧檎瑚碁語誤護醐乞鯉交佼侯候倖光公功効勾厚口向"],[36160,"后喉坑垢好孔孝宏工巧巷幸広庚康弘恒慌抗拘控攻昂晃更杭校梗構江洪浩港溝甲皇硬稿糠紅紘絞綱耕考肯肱腔膏航荒行衡講貢購郊酵鉱砿鋼閤降"],[36224,"項香高鴻剛劫号合壕拷濠豪轟麹克刻告国穀酷鵠黒獄漉腰甑忽惚骨狛込此頃今困坤墾婚恨懇昏昆根梱混痕紺艮魂些佐叉唆嵯左差査沙瑳砂詐鎖裟坐座挫債催再最哉塞妻宰彩才採栽歳済災采犀砕砦祭斎細菜裁載際剤在材罪財冴坂阪堺榊肴咲崎埼碕鷺作削咋搾昨朔柵窄策索錯桜鮭笹匙冊刷"],[36416,"察拶撮擦札殺薩雑皐鯖捌錆鮫皿晒三傘参山惨撒散桟燦珊産算纂蚕讃賛酸餐斬暫残仕仔伺使刺司史嗣四士始姉姿子屍市師志思指支孜斯施旨枝止"],[36480,"死氏獅祉私糸紙紫肢脂至視詞詩試誌諮資賜雌飼歯事似侍児字寺慈持時次滋治爾璽痔磁示而耳自蒔辞汐鹿式識鴫竺軸宍雫七叱執失嫉室悉湿漆疾質実蔀篠偲柴芝屡蕊縞舎写射捨赦斜煮社紗者謝車遮蛇邪借勺尺杓灼爵酌釈錫若寂弱惹主取守手朱殊狩珠種腫趣酒首儒受呪寿授樹綬需囚収周"],[36672,"宗就州修愁拾洲秀秋終繍習臭舟蒐衆襲讐蹴輯週酋酬集醜什住充十従戎柔汁渋獣縦重銃叔夙宿淑祝縮粛塾熟出術述俊峻春瞬竣舜駿准循旬楯殉淳"],[36736,"準潤盾純巡遵醇順処初所暑曙渚庶緒署書薯藷諸助叙女序徐恕鋤除傷償勝匠升召哨商唱嘗奨妾娼宵将小少尚庄床廠彰承抄招掌捷昇昌昭晶松梢樟樵沼消渉湘焼焦照症省硝礁祥称章笑粧紹肖菖蒋蕉衝裳訟証詔詳象賞醤鉦鍾鐘障鞘上丈丞乗冗剰城場壌嬢常情擾条杖浄状畳穣蒸譲醸錠嘱埴飾"],[36928,"拭植殖燭織職色触食蝕辱尻伸信侵唇娠寝審心慎振新晋森榛浸深申疹真神秦紳臣芯薪親診身辛進針震人仁刃塵壬尋甚尽腎訊迅陣靭笥諏須酢図厨"],[36992,"逗吹垂帥推水炊睡粋翠衰遂酔錐錘随瑞髄崇嵩数枢趨雛据杉椙菅頗雀裾澄摺寸世瀬畝是凄制勢姓征性成政整星晴棲栖正清牲生盛精聖声製西誠誓請逝醒青静斉税脆隻席惜戚斥昔析石積籍績脊責赤跡蹟碩切拙接摂折設窃節説雪絶舌蝉仙先千占宣専尖川戦扇撰栓栴泉浅洗染潜煎煽旋穿箭線"],[37184,"繊羨腺舛船薦詮賎践選遷銭銑閃鮮前善漸然全禅繕膳糎噌塑岨措曾曽楚狙疏疎礎祖租粗素組蘇訴阻遡鼠僧創双叢倉喪壮奏爽宋層匝惣想捜掃挿掻"],[37248,"操早曹巣槍槽漕燥争痩相窓糟総綜聡草荘葬蒼藻装走送遭鎗霜騒像増憎臓蔵贈造促側則即息捉束測足速俗属賊族続卒袖其揃存孫尊損村遜他多太汰詑唾堕妥惰打柁舵楕陀駄騨体堆対耐岱帯待怠態戴替泰滞胎腿苔袋貸退逮隊黛鯛代台大第醍題鷹滝瀧卓啄宅托択拓沢濯琢託鐸濁諾茸凧蛸只"],[37440,"叩但達辰奪脱巽竪辿棚谷狸鱈樽誰丹単嘆坦担探旦歎淡湛炭短端箪綻耽胆蛋誕鍛団壇弾断暖檀段男談値知地弛恥智池痴稚置致蜘遅馳築畜竹筑蓄"],[37504,"逐秩窒茶嫡着中仲宙忠抽昼柱注虫衷註酎鋳駐樗瀦猪苧著貯丁兆凋喋寵帖帳庁弔張彫徴懲挑暢朝潮牒町眺聴脹腸蝶調諜超跳銚長頂鳥勅捗直朕沈珍賃鎮陳津墜椎槌追鎚痛通塚栂掴槻佃漬柘辻蔦綴鍔椿潰坪壷嬬紬爪吊釣鶴亭低停偵剃貞呈堤定帝底庭廷弟悌抵挺提梯汀碇禎程締艇訂諦蹄逓"],[37696,"邸鄭釘鼎泥摘擢敵滴的笛適鏑溺哲徹撤轍迭鉄典填天展店添纏甜貼転顛点伝殿澱田電兎吐堵塗妬屠徒斗杜渡登菟賭途都鍍砥砺努度土奴怒倒党冬"],[37760,"凍刀唐塔塘套宕島嶋悼投搭東桃梼棟盗淘湯涛灯燈当痘祷等答筒糖統到董蕩藤討謄豆踏逃透鐙陶頭騰闘働動同堂導憧撞洞瞳童胴萄道銅峠鴇匿得徳涜特督禿篤毒独読栃橡凸突椴届鳶苫寅酉瀞噸屯惇敦沌豚遁頓呑曇鈍奈那内乍凪薙謎灘捺鍋楢馴縄畷南楠軟難汝二尼弐迩匂賑肉虹廿日乳入"],[37952,"如尿韮任妊忍認濡禰祢寧葱猫熱年念捻撚燃粘乃廼之埜嚢悩濃納能脳膿農覗蚤巴把播覇杷波派琶破婆罵芭馬俳廃拝排敗杯盃牌背肺輩配倍培媒梅"],[38016,"楳煤狽買売賠陪這蝿秤矧萩伯剥博拍柏泊白箔粕舶薄迫曝漠爆縛莫駁麦函箱硲箸肇筈櫨幡肌畑畠八鉢溌発醗髪伐罰抜筏閥鳩噺塙蛤隼伴判半反叛帆搬斑板氾汎版犯班畔繁般藩販範釆煩頒飯挽晩番盤磐蕃蛮匪卑否妃庇彼悲扉批披斐比泌疲皮碑秘緋罷肥被誹費避非飛樋簸備尾微枇毘琵眉美"],[38208,"鼻柊稗匹疋髭彦膝菱肘弼必畢筆逼桧姫媛紐百謬俵彪標氷漂瓢票表評豹廟描病秒苗錨鋲蒜蛭鰭品彬斌浜瀕貧賓頻敏瓶不付埠夫婦富冨布府怖扶敷"],[38272,"斧普浮父符腐膚芙譜負賦赴阜附侮撫武舞葡蕪部封楓風葺蕗伏副復幅服福腹複覆淵弗払沸仏物鮒分吻噴墳憤扮焚奮粉糞紛雰文聞丙併兵塀幣平弊柄並蔽閉陛米頁僻壁癖碧別瞥蔑箆偏変片篇編辺返遍便勉娩弁鞭保舗鋪圃捕歩甫補輔穂募墓慕戊暮母簿菩倣俸包呆報奉宝峰峯崩庖抱捧放方朋"],[38464,"法泡烹砲縫胞芳萌蓬蜂褒訪豊邦鋒飽鳳鵬乏亡傍剖坊妨帽忘忙房暴望某棒冒紡肪膨謀貌貿鉾防吠頬北僕卜墨撲朴牧睦穆釦勃没殆堀幌奔本翻凡盆"],[38528,"摩磨魔麻埋妹昧枚毎哩槙幕膜枕鮪柾鱒桝亦俣又抹末沫迄侭繭麿万慢満漫蔓味未魅巳箕岬密蜜湊蓑稔脈妙粍民眠務夢無牟矛霧鵡椋婿娘冥名命明盟迷銘鳴姪牝滅免棉綿緬面麺摸模茂妄孟毛猛盲網耗蒙儲木黙目杢勿餅尤戻籾貰問悶紋門匁也冶夜爺耶野弥矢厄役約薬訳躍靖柳薮鑓愉愈油癒"],[38720,"諭輸唯佑優勇友宥幽悠憂揖有柚湧涌猶猷由祐裕誘遊邑郵雄融夕予余与誉輿預傭幼妖容庸揚揺擁曜楊様洋溶熔用窯羊耀葉蓉要謡踊遥陽養慾抑欲"],[38784,"沃浴翌翼淀羅螺裸来莱頼雷洛絡落酪乱卵嵐欄濫藍蘭覧利吏履李梨理璃痢裏裡里離陸律率立葎掠略劉流溜琉留硫粒隆竜龍侶慮旅虜了亮僚両凌寮料梁涼猟療瞭稜糧良諒遼量陵領力緑倫厘林淋燐琳臨輪隣鱗麟瑠塁涙累類令伶例冷励嶺怜玲礼苓鈴隷零霊麗齢暦歴列劣烈裂廉恋憐漣煉簾練聯"],[38976,"蓮連錬呂魯櫓炉賂路露労婁廊弄朗楼榔浪漏牢狼篭老聾蝋郎六麓禄肋録論倭和話歪賄脇惑枠鷲亙亘鰐詫藁蕨椀湾碗腕"],[39071,"弌丐丕个丱丶丼丿乂乖乘亂亅豫亊舒弍于亞亟亠亢亰亳亶从仍仄仆仂仗仞仭仟价伉佚估佛佝佗佇佶侈侏侘佻佩佰侑佯來侖儘俔俟俎俘俛俑俚俐俤俥倚倨倔倪倥倅伜俶倡倩倬俾俯們倆偃假會偕偐偈做偖偬偸傀傚傅傴傲"],[39232,"僉僊傳僂僖僞僥僭僣僮價僵儉儁儂儖儕儔儚儡儺儷儼儻儿兀兒兌兔兢竸兩兪兮冀冂囘册冉冏冑冓冕冖冤冦冢冩冪冫决冱冲冰况冽凅凉凛几處凩凭"],[39296,"凰凵凾刄刋刔刎刧刪刮刳刹剏剄剋剌剞剔剪剴剩剳剿剽劍劔劒剱劈劑辨辧劬劭劼劵勁勍勗勞勣勦飭勠勳勵勸勹匆匈甸匍匐匏匕匚匣匯匱匳匸區卆卅丗卉卍凖卞卩卮夘卻卷厂厖厠厦厥厮厰厶參簒雙叟曼燮叮叨叭叺吁吽呀听吭吼吮吶吩吝呎咏呵咎呟呱呷呰咒呻咀呶咄咐咆哇咢咸咥咬哄哈咨"],[39488,"咫哂咤咾咼哘哥哦唏唔哽哮哭哺哢唹啀啣啌售啜啅啖啗唸唳啝喙喀咯喊喟啻啾喘喞單啼喃喩喇喨嗚嗅嗟嗄嗜嗤嗔嘔嗷嘖嗾嗽嘛嗹噎噐營嘴嘶嘲嘸"],[39552,"噫噤嘯噬噪嚆嚀嚊嚠嚔嚏嚥嚮嚶嚴囂嚼囁囃囀囈囎囑囓囗囮囹圀囿圄圉圈國圍圓團圖嗇圜圦圷圸坎圻址坏坩埀垈坡坿垉垓垠垳垤垪垰埃埆埔埒埓堊埖埣堋堙堝塲堡塢塋塰毀塒堽塹墅墹墟墫墺壞墻墸墮壅壓壑壗壙壘壥壜壤壟壯壺壹壻壼壽夂夊夐夛梦夥夬夭夲夸夾竒奕奐奎奚奘奢奠奧奬奩"],[39744,"奸妁妝佞侫妣妲姆姨姜妍姙姚娥娟娑娜娉娚婀婬婉娵娶婢婪媚媼媾嫋嫂媽嫣嫗嫦嫩嫖嫺嫻嬌嬋嬖嬲嫐嬪嬶嬾孃孅孀孑孕孚孛孥孩孰孳孵學斈孺宀"],[39808,"它宦宸寃寇寉寔寐寤實寢寞寥寫寰寶寳尅將專對尓尠尢尨尸尹屁屆屎屓屐屏孱屬屮乢屶屹岌岑岔妛岫岻岶岼岷峅岾峇峙峩峽峺峭嶌峪崋崕崗嵜崟崛崑崔崢崚崙崘嵌嵒嵎嵋嵬嵳嵶嶇嶄嶂嶢嶝嶬嶮嶽嶐嶷嶼巉巍巓巒巖巛巫已巵帋帚帙帑帛帶帷幄幃幀幎幗幔幟幢幤幇幵并幺麼广庠廁廂廈廐廏"],[4e4,"廖廣廝廚廛廢廡廨廩廬廱廳廰廴廸廾弃弉彝彜弋弑弖弩弭弸彁彈彌彎弯彑彖彗彙彡彭彳彷徃徂彿徊很徑徇從徙徘徠徨徭徼忖忻忤忸忱忝悳忿怡恠"],[40064,"怙怐怩怎怱怛怕怫怦怏怺恚恁恪恷恟恊恆恍恣恃恤恂恬恫恙悁悍惧悃悚悄悛悖悗悒悧悋惡悸惠惓悴忰悽惆悵惘慍愕愆惶惷愀惴惺愃愡惻惱愍愎慇愾愨愧慊愿愼愬愴愽慂慄慳慷慘慙慚慫慴慯慥慱慟慝慓慵憙憖憇憬憔憚憊憑憫憮懌懊應懷懈懃懆憺懋罹懍懦懣懶懺懴懿懽懼懾戀戈戉戍戌戔戛"],[40256,"戞戡截戮戰戲戳扁扎扞扣扛扠扨扼抂抉找抒抓抖拔抃抔拗拑抻拏拿拆擔拈拜拌拊拂拇抛拉挌拮拱挧挂挈拯拵捐挾捍搜捏掖掎掀掫捶掣掏掉掟掵捫"],[40320,"捩掾揩揀揆揣揉插揶揄搖搴搆搓搦搶攝搗搨搏摧摯摶摎攪撕撓撥撩撈撼據擒擅擇撻擘擂擱擧舉擠擡抬擣擯攬擶擴擲擺攀擽攘攜攅攤攣攫攴攵攷收攸畋效敖敕敍敘敞敝敲數斂斃變斛斟斫斷旃旆旁旄旌旒旛旙无旡旱杲昊昃旻杳昵昶昴昜晏晄晉晁晞晝晤晧晨晟晢晰暃暈暎暉暄暘暝曁暹曉暾暼"],[40512,"曄暸曖曚曠昿曦曩曰曵曷朏朖朞朦朧霸朮朿朶杁朸朷杆杞杠杙杣杤枉杰枩杼杪枌枋枦枡枅枷柯枴柬枳柩枸柤柞柝柢柮枹柎柆柧檜栞框栩桀桍栲桎"],[40576,"梳栫桙档桷桿梟梏梭梔條梛梃檮梹桴梵梠梺椏梍桾椁棊椈棘椢椦棡椌棍棔棧棕椶椒椄棗棣椥棹棠棯椨椪椚椣椡棆楹楷楜楸楫楔楾楮椹楴椽楙椰楡楞楝榁楪榲榮槐榿槁槓榾槎寨槊槝榻槃榧樮榑榠榜榕榴槞槨樂樛槿權槹槲槧樅榱樞槭樔槫樊樒櫁樣樓橄樌橲樶橸橇橢橙橦橈樸樢檐檍檠檄檢檣"],[40768,"檗蘗檻櫃櫂檸檳檬櫞櫑櫟檪櫚櫪櫻欅蘖櫺欒欖鬱欟欸欷盜欹飮歇歃歉歐歙歔歛歟歡歸歹歿殀殄殃殍殘殕殞殤殪殫殯殲殱殳殷殼毆毋毓毟毬毫毳毯"],[40832,"麾氈氓气氛氤氣汞汕汢汪沂沍沚沁沛汾汨汳沒沐泄泱泓沽泗泅泝沮沱沾沺泛泯泙泪洟衍洶洫洽洸洙洵洳洒洌浣涓浤浚浹浙涎涕濤涅淹渕渊涵淇淦涸淆淬淞淌淨淒淅淺淙淤淕淪淮渭湮渮渙湲湟渾渣湫渫湶湍渟湃渺湎渤滿渝游溂溪溘滉溷滓溽溯滄溲滔滕溏溥滂溟潁漑灌滬滸滾漿滲漱滯漲滌"],[57408,"漾漓滷澆潺潸澁澀潯潛濳潭澂潼潘澎澑濂潦澳澣澡澤澹濆澪濟濕濬濔濘濱濮濛瀉瀋濺瀑瀁瀏濾瀛瀚潴瀝瀘瀟瀰瀾瀲灑灣炙炒炯烱炬炸炳炮烟烋烝"],[57472,"烙焉烽焜焙煥煕熈煦煢煌煖煬熏燻熄熕熨熬燗熹熾燒燉燔燎燠燬燧燵燼燹燿爍爐爛爨爭爬爰爲爻爼爿牀牆牋牘牴牾犂犁犇犒犖犢犧犹犲狃狆狄狎狒狢狠狡狹狷倏猗猊猜猖猝猴猯猩猥猾獎獏默獗獪獨獰獸獵獻獺珈玳珎玻珀珥珮珞璢琅瑯琥珸琲琺瑕琿瑟瑙瑁瑜瑩瑰瑣瑪瑶瑾璋璞璧瓊瓏瓔珱"],[57664,"瓠瓣瓧瓩瓮瓲瓰瓱瓸瓷甄甃甅甌甎甍甕甓甞甦甬甼畄畍畊畉畛畆畚畩畤畧畫畭畸當疆疇畴疊疉疂疔疚疝疥疣痂疳痃疵疽疸疼疱痍痊痒痙痣痞痾痿"],[57728,"痼瘁痰痺痲痳瘋瘍瘉瘟瘧瘠瘡瘢瘤瘴瘰瘻癇癈癆癜癘癡癢癨癩癪癧癬癰癲癶癸發皀皃皈皋皎皖皓皙皚皰皴皸皹皺盂盍盖盒盞盡盥盧盪蘯盻眈眇眄眩眤眞眥眦眛眷眸睇睚睨睫睛睥睿睾睹瞎瞋瞑瞠瞞瞰瞶瞹瞿瞼瞽瞻矇矍矗矚矜矣矮矼砌砒礦砠礪硅碎硴碆硼碚碌碣碵碪碯磑磆磋磔碾碼磅磊磬"],[57920,"磧磚磽磴礇礒礑礙礬礫祀祠祗祟祚祕祓祺祿禊禝禧齋禪禮禳禹禺秉秕秧秬秡秣稈稍稘稙稠稟禀稱稻稾稷穃穗穉穡穢穩龝穰穹穽窈窗窕窘窖窩竈窰"],[57984,"窶竅竄窿邃竇竊竍竏竕竓站竚竝竡竢竦竭竰笂笏笊笆笳笘笙笞笵笨笶筐筺笄筍笋筌筅筵筥筴筧筰筱筬筮箝箘箟箍箜箚箋箒箏筝箙篋篁篌篏箴篆篝篩簑簔篦篥籠簀簇簓篳篷簗簍篶簣簧簪簟簷簫簽籌籃籔籏籀籐籘籟籤籖籥籬籵粃粐粤粭粢粫粡粨粳粲粱粮粹粽糀糅糂糘糒糜糢鬻糯糲糴糶糺紆"],[58176,"紂紜紕紊絅絋紮紲紿紵絆絳絖絎絲絨絮絏絣經綉絛綏絽綛綺綮綣綵緇綽綫總綢綯緜綸綟綰緘緝緤緞緻緲緡縅縊縣縡縒縱縟縉縋縢繆繦縻縵縹繃縷"],[58240,"縲縺繧繝繖繞繙繚繹繪繩繼繻纃緕繽辮繿纈纉續纒纐纓纔纖纎纛纜缸缺罅罌罍罎罐网罕罔罘罟罠罨罩罧罸羂羆羃羈羇羌羔羞羝羚羣羯羲羹羮羶羸譱翅翆翊翕翔翡翦翩翳翹飜耆耄耋耒耘耙耜耡耨耿耻聊聆聒聘聚聟聢聨聳聲聰聶聹聽聿肄肆肅肛肓肚肭冐肬胛胥胙胝胄胚胖脉胯胱脛脩脣脯腋"],[58432,"隋腆脾腓腑胼腱腮腥腦腴膃膈膊膀膂膠膕膤膣腟膓膩膰膵膾膸膽臀臂膺臉臍臑臙臘臈臚臟臠臧臺臻臾舁舂舅與舊舍舐舖舩舫舸舳艀艙艘艝艚艟艤"],[58496,"艢艨艪艫舮艱艷艸艾芍芒芫芟芻芬苡苣苟苒苴苳苺莓范苻苹苞茆苜茉苙茵茴茖茲茱荀茹荐荅茯茫茗茘莅莚莪莟莢莖茣莎莇莊荼莵荳荵莠莉莨菴萓菫菎菽萃菘萋菁菷萇菠菲萍萢萠莽萸蔆菻葭萪萼蕚蒄葷葫蒭葮蒂葩葆萬葯葹萵蓊葢蒹蒿蒟蓙蓍蒻蓚蓐蓁蓆蓖蒡蔡蓿蓴蔗蔘蔬蔟蔕蔔蓼蕀蕣蕘蕈"],[58688,"蕁蘂蕋蕕薀薤薈薑薊薨蕭薔薛藪薇薜蕷蕾薐藉薺藏薹藐藕藝藥藜藹蘊蘓蘋藾藺蘆蘢蘚蘰蘿虍乕虔號虧虱蚓蚣蚩蚪蚋蚌蚶蚯蛄蛆蚰蛉蠣蚫蛔蛞蛩蛬"],[58752,"蛟蛛蛯蜒蜆蜈蜀蜃蛻蜑蜉蜍蛹蜊蜴蜿蜷蜻蜥蜩蜚蝠蝟蝸蝌蝎蝴蝗蝨蝮蝙蝓蝣蝪蠅螢螟螂螯蟋螽蟀蟐雖螫蟄螳蟇蟆螻蟯蟲蟠蠏蠍蟾蟶蟷蠎蟒蠑蠖蠕蠢蠡蠱蠶蠹蠧蠻衄衂衒衙衞衢衫袁衾袞衵衽袵衲袂袗袒袮袙袢袍袤袰袿袱裃裄裔裘裙裝裹褂裼裴裨裲褄褌褊褓襃褞褥褪褫襁襄褻褶褸襌褝襠襞"],[58944,"襦襤襭襪襯襴襷襾覃覈覊覓覘覡覩覦覬覯覲覺覽覿觀觚觜觝觧觴觸訃訖訐訌訛訝訥訶詁詛詒詆詈詼詭詬詢誅誂誄誨誡誑誥誦誚誣諄諍諂諚諫諳諧"],[59008,"諤諱謔諠諢諷諞諛謌謇謚諡謖謐謗謠謳鞫謦謫謾謨譁譌譏譎證譖譛譚譫譟譬譯譴譽讀讌讎讒讓讖讙讚谺豁谿豈豌豎豐豕豢豬豸豺貂貉貅貊貍貎貔豼貘戝貭貪貽貲貳貮貶賈賁賤賣賚賽賺賻贄贅贊贇贏贍贐齎贓賍贔贖赧赭赱赳趁趙跂趾趺跏跚跖跌跛跋跪跫跟跣跼踈踉跿踝踞踐踟蹂踵踰踴蹊"],[59200,"蹇蹉蹌蹐蹈蹙蹤蹠踪蹣蹕蹶蹲蹼躁躇躅躄躋躊躓躑躔躙躪躡躬躰軆躱躾軅軈軋軛軣軼軻軫軾輊輅輕輒輙輓輜輟輛輌輦輳輻輹轅轂輾轌轉轆轎轗轜"],[59264,"轢轣轤辜辟辣辭辯辷迚迥迢迪迯邇迴逅迹迺逑逕逡逍逞逖逋逧逶逵逹迸遏遐遑遒逎遉逾遖遘遞遨遯遶隨遲邂遽邁邀邊邉邏邨邯邱邵郢郤扈郛鄂鄒鄙鄲鄰酊酖酘酣酥酩酳酲醋醉醂醢醫醯醪醵醴醺釀釁釉釋釐釖釟釡釛釼釵釶鈞釿鈔鈬鈕鈑鉞鉗鉅鉉鉤鉈銕鈿鉋鉐銜銖銓銛鉚鋏銹銷鋩錏鋺鍄錮"],[59456,"錙錢錚錣錺錵錻鍜鍠鍼鍮鍖鎰鎬鎭鎔鎹鏖鏗鏨鏥鏘鏃鏝鏐鏈鏤鐚鐔鐓鐃鐇鐐鐶鐫鐵鐡鐺鑁鑒鑄鑛鑠鑢鑞鑪鈩鑰鑵鑷鑽鑚鑼鑾钁鑿閂閇閊閔閖閘閙"],[59520,"閠閨閧閭閼閻閹閾闊濶闃闍闌闕闔闖關闡闥闢阡阨阮阯陂陌陏陋陷陜陞陝陟陦陲陬隍隘隕隗險隧隱隲隰隴隶隸隹雎雋雉雍襍雜霍雕雹霄霆霈霓霎霑霏霖霙霤霪霰霹霽霾靄靆靈靂靉靜靠靤靦靨勒靫靱靹鞅靼鞁靺鞆鞋鞏鞐鞜鞨鞦鞣鞳鞴韃韆韈韋韜韭齏韲竟韶韵頏頌頸頤頡頷頽顆顏顋顫顯顰"],[59712,"顱顴顳颪颯颱颶飄飃飆飩飫餃餉餒餔餘餡餝餞餤餠餬餮餽餾饂饉饅饐饋饑饒饌饕馗馘馥馭馮馼駟駛駝駘駑駭駮駱駲駻駸騁騏騅駢騙騫騷驅驂驀驃"],[59776,"騾驕驍驛驗驟驢驥驤驩驫驪骭骰骼髀髏髑髓體髞髟髢髣髦髯髫髮髴髱髷髻鬆鬘鬚鬟鬢鬣鬥鬧鬨鬩鬪鬮鬯鬲魄魃魏魍魎魑魘魴鮓鮃鮑鮖鮗鮟鮠鮨鮴鯀鯊鮹鯆鯏鯑鯒鯣鯢鯤鯔鯡鰺鯲鯱鯰鰕鰔鰉鰓鰌鰆鰈鰒鰊鰄鰮鰛鰥鰤鰡鰰鱇鰲鱆鰾鱚鱠鱧鱶鱸鳧鳬鳰鴉鴈鳫鴃鴆鴪鴦鶯鴣鴟鵄鴕鴒鵁鴿鴾鵆鵈"],[59968,"鵝鵞鵤鵑鵐鵙鵲鶉鶇鶫鵯鵺鶚鶤鶩鶲鷄鷁鶻鶸鶺鷆鷏鷂鷙鷓鷸鷦鷭鷯鷽鸚鸛鸞鹵鹹鹽麁麈麋麌麒麕麑麝麥麩麸麪麭靡黌黎黏黐黔黜點黝黠黥黨黯"],[60032,"黴黶黷黹黻黼黽鼇鼈皷鼕鼡鼬鼾齊齒齔齣齟齠齡齦齧齬齪齷齲齶龕龜龠堯槇遙瑤凜熙"]];function Ee(t){for(var e=[],s=t.length,n=function(){if(!xe){var t,e={},s={},n=Yt(Ae);try{for(n.s();!(t=n.n()).done;)for(var i=t.value,r=i[1],a=0;a<r.length;a++){var o=i[0]+a,h=r.charAt(a).charCodeAt(0);e[h]=o,s[o]=h}}catch(t){n.e(t)}finally{n.f()}xe={UTF8_TO_SJIS:e,SJIS_TO_UTF8:s}}return xe}(),i=n.UTF8_TO_SJIS,r=0;r<s;r++){var a=t.charCodeAt(r),o=i[a];if(null==o)throw new Error("illegal char: ".concat(String.fromCharCode(a)));e.push(o>>8),e.push(255&o)}return e}function Se(t){for(var e=[],s=t.length,n=0;n<s;n++)e.push(t.charCodeAt(n));return e}var Te=function(t){Ut(s,t);var e=Wt(s);function s(t){var n;return te(this,s),(n=e.call(this,fe.Alphanumeric,t)).bytes=Se(t),n}return se(s,[{key:"write",value:function(t){for(var e=0,s=this.bytes,n=s.length;e+1<n;)t.add(45*this.getByte(s[e])+this.getByte(s[e+1]),11),e+=2;e<n&&t.add(this.getByte(s[e]),6)}},{key:"getByte",value:function(t){if(48<=t&&t<=57)return t-48;if(65<=t&&t<=90)return t-65+10;switch(t){case 32:return 36;case 36:return 37;case 37:return 38;case 42:return 39;case 43:return 40;case 45:return 41;case 46:return 42;case 47:return 43;case 58:return 44;default:throw new Error("invalid char: ".concat(String.fromCharCode(t)))}}}]),s}(ke),_e=function(t){Ut(s,t);var e=Wt(s);function s(t,n){var i;if(te(this,s),(i=e.call(this,fe.Byte,t)).indicator=26,n&&"function"==typeof n){var r=n(t),a=r.bytes,o=r.indicator;i.bytes=a,i.indicator=o}else i.bytes=function(t){for(var e=[],s=t.length,n=0,i=0;i<s;i++){var r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<s&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e}(t);return i}return se(s,[{key:"getECIIndicator",value:function(){return this.indicator}},{key:"write",value:function(t){var e,s=Yt(this.bytes);try{for(s.s();!(e=s.n()).done;){var n=e.value;t.add(n,8)}}catch(t){s.e(t)}finally{s.f()}}}]),s}(ke),Pe=function(t){Ut(s,t);var e=Wt(s);function s(t){var n;return te(this,s),(n=e.call(this,fe.Numeric,t)).bytes=Se(t),n}return se(s,[{key:"write",value:function(t){for(var e=0,s=this.bytes,n=s.length;e+2<n;)t.add(this.getBytes([s[e],s[e+1],s[e+2]]),10),e+=3;e<n&&(n-e==1?t.add(this.getBytes([s[e]]),4):n-e==2&&t.add(this.getBytes([s[e],s[e+1]]),7))}},{key:"getByte",value:function(t){if(48<=t&&t<=57)return t-48;throw new Error("invalid char: ".concat(String.fromCharCode(t)))}},{key:"getBytes",value:function(t){for(var e=0,s=t.length,n=0;n<s;n++)e=10*e+this.getByte(t[n]);return e}}]),s}(ke),Ne=function(t){Ut(s,t);var e=Wt(s);function s(t){var n;return te(this,s),(n=e.call(this,fe.Numeric,t)).bytes=Ee(t),n}return se(s,[{key:"getLength",value:function(){return Math.floor(this.bytes.length/2)}},{key:"write",value:function(t){for(var e=0,s=this.bytes,n=s.length;e+1<n;){var i=(255&s[e])<<8|255&s[e+1];33088<=i&&i<=40956?i-=33088:57408<=i&&i<=60351&&(i-=49472),i=192*(i>>8&255)+(255&i),t.add(i,13),e+=2}}}]),s}(ke),Me=function(){function t(){te(this,t),this.length=0,this.buffer=[]}return se(t,[{key:"getBuffer",value:function(){return this.buffer}},{key:"getLengthOfBits",value:function(){return this.length}},{key:"getBit",value:function(t){return 1==(this.buffer[t/8|0]>>>7-t%8&1)}},{key:"add",value:function(t,e){for(var s=0;s<e;s++)this.addBit(1==(t>>>e-s-1&1));return this}},{key:"addBit",value:function(t){this.length===8*this.buffer.length&&this.buffer.push(0),t&&(this.buffer[this.length/8|0]|=128>>>this.length%8),this.length++}}]),t}(),Ce=function(){function t(e,s){te(this,t),this.dataCount=s,this.totalCount=e}return se(t,[{key:"getDataCount",value:function(){return this.dataCount}},{key:"getTotalCount",value:function(){return this.totalCount}},{key:"getErrorCorrectionCount",value:function(){return this.totalCount-this.dataCount}}],[{key:"getRSBlocks",value:function(e,s){for(var n=[],i=t.getRSBlockTable(e,s),r=i.length/3,a=0;a<r;a++)for(var o=i[3*a+0],h=i[3*a+1],c=i[3*a+2],l=0;l<o;l++)n.push(new t(h,c));return n}},{key:"getRSBlockTable",value:function(e,s){switch(s){case de.L:return t.RS_BLOCK_TABLE[4*(e-1)+0];case de.M:return t.RS_BLOCK_TABLE[4*(e-1)+1];case de.Q:return t.RS_BLOCK_TABLE[4*(e-1)+2];case de.H:return t.RS_BLOCK_TABLE[4*(e-1)+3];default:throw new Error("invalid error correction level: ".concat(s))}}}]),t}();Ce.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];var Le=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]];function Be(t){for(var e=0;0!==t;)e++,t>>>=1;return e}var qe=Be(7973);var Re=Be(1335);var Ve=function(){function t(){te(this,t)}return se(t,null,[{key:"preprocessing",value:function(e,s,n,i){var r,a=new Me,o=Ce.getRSBlocks(e,s),h=Yt(i);try{for(h.s();!(r=h.n()).done;){var c=r.value,l=c.getMode();n&&l===fe.Byte&&t.handleECI(c.getECIIndicator(),a),a.add(l,4).add(c.getLength(),c.getCharCountIndexBitLength(e)),c.write(a)}}catch(t){h.e(t)}finally{h.f()}var d,u=0,p=Yt(o);try{for(p.s();!(d=p.n()).done;){u+=d.value.getDataCount()}}catch(t){p.e(t)}finally{p.f()}return[a,o,u*=8]}},{key:"handleECI",value:function(t,e){if(t<0||t>=1e6)throw new Error("ECI indicator out of range");e.add(fe.ECI,4),t<128?e.add(t,8):t<16384?(e.add(2,2),e.add(t,14)):(e.add(6,3),e.add(t,21))}},{key:"processing",value:function(e,s,n){for(e.getLengthOfBits()+4<=n&&e.add(0,4);e.getLengthOfBits()%8!=0;)e.addBit(!1);for(;!(e.getLengthOfBits()>=n||(e.add(t.PAD0,8),e.getLengthOfBits()>=n));)e.add(t.PAD1,8);return t.addErrorCorrection(e,s)}},{key:"addErrorCorrection",value:function(t,e){for(var s=0,n=0,i=0,r=[],a=[],o=t.getBuffer(),h=0;h<e.length;h++){var c=e[h],l=c.getDataCount(),d=c.getErrorCorrectionCount();n=Math.max(n,l),i=Math.max(i,d),r[h]=[];for(var u=0;u<l;u++)r[h][u]=255&o[u+s];s+=l;var p=pe(d),m=p.length()-1,f=new ue(r[h],m),g=ue.mod(f,p),y=g.length();a[h]=[];for(var v=0;v<m;v++){var b=v+y-m;a[h][v]=b>=0?g.at(b):0}}t=new Me;for(var w=0;w<n;w++)for(var x=0;x<e.length;x++)w<r[x].length&&t.add(r[x][w],8);for(var k=0;k<i;k++)for(var A=0;A<e.length;A++)k<a[A].length&&t.add(a[A][k],8);return t}},{key:"addFinderPattern",value:function(t,e){var s=function(s,n){for(var i=-1;i<=7;i++)for(var r=-1;r<=7;r++)s+i<=-1||e<=s+i||n+r<=-1||e<=n+r||(t[s+i][n+r]=0<=i&&i<=6&&(0===r||6===r)||0<=r&&r<=6&&(0===i||6===i)||2<=i&&i<=4&&2<=r&&r<=4)};s(0,0),s(e-7,0),s(0,e-7)}},{key:"addAlignmentPattern",value:function(t,e){for(var s=function(t){return Le[t-1]}(e),n=s.length,i=0;i<n;i++)for(var r=0;r<n;r++){var a=s[i],o=s[r];if(null===t[a][o])for(var h=-2;h<=2;h++)for(var c=-2;c<=2;c++)t[a+h][o+c]=-2===h||2===h||-2===c||2===c||0===h&&0===c}}},{key:"addTimingPattern",value:function(t,e){for(var s=8;s<e-8;s++){var n=s%2==0;null===t[s][6]&&(t[s][6]=n),null===t[6][s]&&(t[6][s]=n)}}},{key:"addFormatInfo",value:function(t,e,s,n){for(var i=function(t){for(var e=t<<10;Be(e)-Re>=0;)e^=1335<<Be(e)-Re;return 21522^(t<<10|e)}(n<<3|s),r=0;r<15;r++){var a=1==(i>>r&1);r<6?t[r][8]=a:r<8?t[r+1][8]=a:t[e-15+r][8]=a,r<8?t[8][e-r-1]=a:r<9?t[8][15-r-1+1]=a:t[8][15-r-1]=a}t[e-8][8]=!0}},{key:"addVersionInfo",value:function(t,e,s){if(s>=7)for(var n=function(t){for(var e=t<<12;Be(e)-qe>=0;)e^=7973<<Be(e)-qe;return t<<12|e}(s),i=0;i<18;i++){var r=1==(n>>i&1);t[i/3|0][i%3+e-8-3]=r,t[i%3+e-8-3][i/3|0]=r}}},{key:"addCodewords",value:function(t,e,s,n){for(var i=s.getLengthOfBits(),r=0,a=e-1;a>=1;a-=2){6===a&&(a=5);for(var o=0;o<e;o++)for(var h=0;h<2;h++){var c=a-h,l=!(a+1&2)?e-1-o:o;if(null===t[l][c]){var d=!1;r<i&&(d=s.getBit(r++)),ge(n)(c,l)&&(d=!d),t[l][c]=d}}}}}]),t}();Ve.PAD0=236,Ve.PAD1=17;var Oe=function(){function t(e,s){te(this,t),this.content=e,this.mode=s;try{switch(this.mode){case fe.Numeric:this.data=new Pe(this.content);case fe.Alphanumeric:this.data=new Te(this.content);case fe.Byte:this.data=new _e(this.content);case fe.Kanji:this.data=new Ne(this.content);default:throw new Error("invalid mode: ".concat(this.mode))}}catch(t){throw new Error("mode(".concat(this.mode,") and content(").concat(this.content,") not match"))}}return se(t,[{key:"getQRData",value:function(){return this.data}}]),t}(),Ie=function(){function t(e){te(this,t),this.version=0,this.enableECI=!1,this.errorCorrectionLevel=de.M,this.maskPattern=null,this.segments=[],this.matrixSize=0,this.matrix=[],void 0!==e&&(e.hasOwnProperty("version")&&this.setVersion(e.version),e.hasOwnProperty("enableECI")&&this.setECIStatus(e.enableECI),e.hasOwnProperty("errorCorrectionLevel")&&this.setErrorCorrectionLevel(e.errorCorrectionLevel),e.hasOwnProperty("maskPattern")&&this.setMaskPattern(e.maskPattern))}return se(t,[{key:"autoVersion",get:function(){return 0===this.version}},{key:"autoMask",get:function(){return null===this.maskPattern}},{key:"getMatrix",value:function(){return this.matrix}},{key:"getMatrixSize",value:function(){return this.matrixSize}},{key:"getVersion",value:function(){return this.version}},{key:"setVersion",value:function(t){return this.version=Math.min(40,Math.max(0,t|0)),this}},{key:"getErrorCorrectionLevel",value:function(){return this.errorCorrectionLevel}},{key:"setErrorCorrectionLevel",value:function(t){switch(t){case de.L:case de.M:case de.Q:case de.H:return this.errorCorrectionLevel=t,this;default:throw new Error("invalid error correction level: ".concat(t))}}},{key:"getMaskPattern",value:function(){return this.maskPattern}},{key:"setMaskPattern",value:function(t){switch(t){case me.PATTERN000:case me.PATTERN001:case me.PATTERN010:case me.PATTERN011:case me.PATTERN100:case me.PATTERN101:case me.PATTERN110:case me.PATTERN111:return this.maskPattern=t,this;default:throw new Error("invalid mask pattern: ".concat(t))}}},{key:"clearMaskPattern",value:function(){return this.maskPattern=null,this}},{key:"getECIStatus",value:function(){return this.enableECI}},{key:"setECIStatus",value:function(t){return this.enableECI=t,this}},{key:"createMatrix",value:function(t,e){for(var s=[],n=0;n<this.matrixSize;n++){s[n]=[];for(var i=0;i<this.matrixSize;i++)s[n][i]=null}return Ve.addFinderPattern(s,this.matrixSize),Ve.addAlignmentPattern(s,this.version),Ve.addTimingPattern(s,this.matrixSize),Ve.addFormatInfo(s,this.matrixSize,e,this.errorCorrectionLevel),Ve.addVersionInfo(s,this.matrixSize,this.version),Ve.addCodewords(s,this.matrixSize,t,e),s}},{key:"clear",value:function(){return this.segments.length=0,this}},{key:"add",value:function(t){var e;if(t instanceof Oe)e=t.getQRData();else if("[object String]"===toString.call(t)){if(/^\d+$/.test(t))e=new Pe(t);else if(/^[0-9A-Z$%*+-./: ]+$/.test(t))e=new Te(t);else try{e=new Ne(t)}catch(s){e=new _e(t)}}else{if(!t.hasOwnProperty("data")||!t.hasOwnProperty("mode"))throw new Error("invalid content: ".concat(t));e=new Oe(t.content,t.mode).getQRData()}return this.segments.push(e),this}},{key:"create",value:function(){var t,e,s;if(this.autoVersion)for(this.version=1;this.version<=40;this.version++){var n=jt(Ve.preprocessing(this.version,this.errorCorrectionLevel,this.enableECI,this.segments),3);if(t=n[0],e=n[1],s=n[2],t.getLengthOfBits()<=s)break}else{var i=jt(Ve.preprocessing(this.version,this.errorCorrectionLevel,this.enableECI,this.segments),3);t=i[0],e=i[1],s=i[2]}if(t.getLengthOfBits()>s)throw new Error("Too big content that current version(".concat(this.version,") cannot fit"));this.matrixSize=4*this.version+17;var r=Ve.processing(t,e,s);if(this.autoMask){for(var a,o=Number.MAX_VALUE,h=0;h<8;h++){var c=this.createMatrix(r,h),l=we(c,this.matrixSize);l<o&&(o=l,a=c)}this.matrix=a}else this.matrix=this.createMatrix(r,this.maskPattern);return this}}]),t}();function De(t,e,s,n,i,r){r?t.arcTo(e,s,n,i,r):(t.lineTo(e,s),t.lineTo(n,i))}function $e(t,e,s,n,i,r,a,o){t.beginPath(),t.moveTo(e,s),De(t,n,i,r,a,o),t.lineTo(n,i),t.lineTo(e,s),t.fill()}function Fe(t,e,s){var n=!!t[e][s],i=t.length-1,r=[0,0,0,0];return e>0&&t[e-1][s]&&(r[0]+=1,r[1]+=1),e<i&&t[e+1][s]&&(r[2]+=1,r[3]+=1),s>0&&t[e][s-1]&&(r[0]+=1,r[3]+=1),s<i&&t[e][s+1]&&(r[1]+=1,r[2]+=1),n&&(e>0&&s>0&&t[e-1][s-1]&&(r[0]+=1),e>0&&s<i&&t[e-1][s+1]&&(r[1]+=1),e<i&&s<i&&t[e+1][s+1]&&(r[2]+=1),e<i&&s>0&&t[e+1][s-1]&&(r[3]+=1)),r}function He(t,e,s){return t?function(t,e){return t.width=e,t.height=e,t}(t,e):function(t){var e=document.createElement("canvas");return e.width=t,e.height=t,e}(e)}var Ge=function(){function t(e){te(this,t),this.opts={},this.updateOptions(e)}return se(t,[{key:"updateOptions",value:function(t){return t?(this.opts=Object.assign({},this.opts,t),this):this}},{key:"drawCanvas",value:function(t,e){var s,n=t.length,i=this.opts,r=i.gridSize,a=i.size,o=i.resize;e||r||a||(r=5),r&&(a=n*r),a?s=o||!e?He(e,a):e:(a=e.width,s=e);var h=s.getContext("2d");h.clearRect(0,0,s.width,s.height),r=Math.floor(a/n);for(var c=0;c<t.length;c++)for(var l=0;l<t[c].length;l++){var d=l*r,u=c*r;if("radius"===this.opts.style)t[c][l]&&this.drawRadiusGrid(h,d,u,r);else if("smooth"===this.opts.style){var p=Fe(t,c,l);this.drawSmoothGrid(h,d,u,r,p,!!t[c][l])}else t[c][l]&&h.fillRect(d,u,r,r)}return s}},{key:"drawRadiusGrid",value:function(t,e,s,n){var i=(this.opts.styleValue&&this.opts.styleValue>0?this.opts.styleValue:0)*n/2;i=i>n/2?n/2:i,t.beginPath(),t.moveTo(e+.5*n,s),De(t,e+n,s,e+n,s+.5*n,i),De(t,e+n,s+n,e+.5*n,s+n,i),De(t,e,s+n,e,s+.5*n,i),De(t,e,s,e+.5*n,s,i),t.fill()}},{key:"drawSmoothGrid",value:function(t,e,s,n,i,r){var a=(this.opts.styleValue&&this.opts.styleValue>0?this.opts.styleValue:0)*n/2;a=a>n/2?n/2:a,r?(t.beginPath(),t.moveTo(e+.5*n,s),De(t,e+n,s,e+n,s+.5*n,i[1]?0:a),De(t,e+n,s+n,e+.5*n,s+n,i[2]?0:a),De(t,e,s+n,e,s+.5*n,i[3]?0:a),De(t,e,s,e+.5*n,s,i[0]?0:a),t.fill()):(2===i[0]&&$e(t,e,s+.5*n,e,s,e+.5*n,s,a),2===i[1]&&$e(t,e+.5*n,s,e+n,s,e+n,s+.5*n,a),2===i[2]&&$e(t,e+n,s+.5*n,e+n,s+n,e+.5*n,s+n,a),2===i[3]&&$e(t,e+.5*n,s+n,e,s+n,e,s+.5*n,a))}}]),t}();class ze extends HTMLElement{constructor(){super(),this.synth=new it,this.isPlaying=!1,this._start_time=0,this._start_beat=0,this._timer=-1,this.flowers=[],this.insects=[],this.focusFlower=void 0,this.bypassed=!0,this.audioTimer=()=>{const t=this.currentBeat,e=Math.floor(4*t)+1;if(e>this._last_petal){const s=e/4-t;s*this.secsPerBeat<.5&&(this._last_petal=e,this.flowers.forEach((t=>{if(t.isPetalHighlighted(e%16)){const e=new r(t.note);this.detuneParam.active&&(e.detune=this.detuneParam.value),this.synth.scheduleNote(e,s,0,this.chain),this.dicon.hit(t.note)}})))}},this._last_petal=-1,this.audio=x.init();const t=new URLSearchParams(window.location.search),e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Barriecito&display=swap",e.rel="stylesheet",document.head.appendChild(e),this.root=this.attachShadow({mode:"open"}),this.root.adoptedStyleSheets.push(zt),this.root.innerHTML='<div id="garden-container">\n  <button id="home-button">⌂</button>\n  <div class="bpm-indicator">90 bpm</div>\n  <div class="play-groove">\n    <button id="play-pause-button">\n      <svg class="play" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512">\n        <path d="M142,39c-14.8-9.1-33.4-9.4-48.5-.9-15.1,8.5-24.5,24.5-24.5,41.9v352c0,17.4,9.4,33.4,24.5,41.9,15.1,8.5,33.7,8.1,48.5-.9l288-176c14.3-8.7,23-24.2,23-41s-8.7-32.2-23-41L142,39Z"/>\n      </svg>\n      <svg class="stop" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512">\n        <rect x="47.89" y="47.87" width="416.23" height="416.23" rx="29.9" ry="29.9"/>\n      </svg>\n    </button>\n  </div>\n  <div class="genre-wrapper">\n    <select class="genre-select">\n      <option value="808-drums">Hip Hop</option>\n      <option value="rock-drums">Rock</option>\n      <option value="linndrum">1980s</option>\n    </select>\n  </div>\n  <canvas id="garden-canvas" width="950" height="675"></canvas>\n  <canvas id="qrcode" width="500" height="500"></canvas>\n</div>',this.canvas=this.root.querySelector("#garden-canvas"),this.ctx=this.canvas.getContext("2d"),this.playButton=this.root.querySelector("#play-pause-button"),this.flowers.push(new $t(4,100,500,80,Rt)),this.flowers.push(new $t(2,240,340,110,Bt)),this.flowers.push(new $t(0,490,300,140,Lt)),this.flowers.push(new $t(6,730,400,110,qt)),this.flowers.forEach((e=>{const s=`n${e.note}`,n=t.get(s);n&&e.load(parseInt(n))}));this.freqParam=new Gt(50,8e3,200,800),this.freqParam.value=6e3,this.freqParam.defaultValue=6e3,this.freqParam.name="Frequency",this.panParam=new Gt(-.9,.1,200,800),this.panParam.value=0,this.panParam.defaultValue=0,this.panParam.name="",this.detuneParam=new Gt(-250,250,150,550),this.detuneParam.value=0,this.detuneParam.defaultValue=0,this.detuneParam.name="Pitch",this.detuneParam.inverted=!0,this.tempoParam=new Gt(40,180,200,800),this.tempoParam.value=90,this.tempoParam.defaultValue=90,this.tempoParam.name="Tempo",this.gainParam=new Gt(.8,1,150,550),this.gainParam.value=.9,this.gainParam.defaultValue=.9,this.gainParam.inverted=!0,this.gainParam.name="",this.qParam=new Gt(.1,4,150,550),this.qParam.value=1,this.qParam.defaultValue=1,this.qParam.inverted=!0,this.qParam.name="Resonance",this.insects.push(new Ft(this,this.tempoParam,this.detuneParam,"bee")),this.insects.push(new Ft(this,this.panParam,this.gainParam,"butterfly")),this.chain=new GainNode(this.audio.context),this.bypass=new GainNode(this.audio.context),this.lowpass=new BiquadFilterNode(this.audio.context),this.pan=new StereoPannerNode(this.audio.context),this.volume=new GainNode(this.audio.context),this.analyzer=new AnalyserNode(this.audio.context),this.chain.connect(this.pan),this.lowpass.connect(this.bypass),this.bypass.connect(this.pan),this.pan.connect(this.volume),this.volume.connect(this.analyzer),this.analyzer.connect(this.audio.context.destination),this.analyzer.fftSize=64,this.abuffer=new Uint8Array(this.analyzer.frequencyBinCount),this.dicon=new Ht(15,600,70,70),this.qrcode=new Ie}async connectedCallback(){this.render(),this.synth=new it,this.loadPatch("808-drums"),window.addEventListener("resize",(t=>{this.resize(window.innerWidth,window.innerHeight)})),this.resize(window.innerWidth,window.innerHeight),this.canvas.addEventListener("pointerdown",(t=>{const e=this.canvas.height;let s,n=-1;this.flowers.forEach((t=>t.restore()));for(let e=this.insects.length-1;e>=0;e--){const s=this.insects[e];if(s.pointerDown(t))return this.insects.splice(e,1),this.insects.push(s),void(this.focusFlower&&(this.focusFlower=void 0))}for(let i of this.flowers)n=i.hitTest(this.ctx,t.offsetX,t.offsetY,e),n>=0&&(s=i);if(null!=this.focusFlower&&s!=this.focusFlower?this.focusFlower=void 0:this.focusFlower=s,null!=this.focusFlower){const t=this.canvas.width/2,e=this.canvas.height/2;if(this.moveToTop(this.focusFlower),this.focusFlower.animateTo(t,e+50,.75*e),this.focusFlower.togglePetal(n),this.save(),n>=16||this.focusFlower.isPetalHighlighted(n)){const t=new r(this.focusFlower.note);this.detuneParam.active&&(t.detune=this.detuneParam.value),this.synth.scheduleNote(t,0,0,this.chain)}16==n&&this.focusFlower.bounce(),this.render()}}));const t=this.root.querySelector(".genre-select");t.addEventListener("change",(e=>{this.loadPatch(t.value),this.save()}));const e=new URLSearchParams(window.location.search);if(e.has("voice")){const s=e.get("voice");this.loadPatch(s),t.value=s}this.playButton.addEventListener("click",(t=>{if(this.isPlaying)this.playButton.parentElement?.classList.toggle("pause",!1),this.synth.cancelAllNotes(),this._timer>=0&&clearInterval(this._timer),this.isPlaying=!1,this.render();else{this.playButton.parentElement?.classList.toggle("pause",!0);const t=new r(10);t.velocity=30,this.synth.scheduleNote(t,0,0,this.chain),this._start_time=this.clockTime,this._start_beat=0,this._last_petal=-1,this._timer=setInterval(this.audioTimer,20),this.isPlaying=!0}})),window.requestAnimationFrame((t=>this._animate(t))),this.loop=await G.loadAudioBuffer("/sounds/loops/arpeggio.wav"),this.loop||(this.loop=await G.loadAudioBuffer("/assets/sounds/loops/arpeggio.wav"));const s=this.root.querySelector("#qrcode");s.addEventListener("click",(t=>{s.classList.toggle("big"),t.stopPropagation()})),this.root.addEventListener("click",(t=>{s.classList.contains("big")&&(s.classList.remove("big"),t.stopPropagation())}))}async loadPatch(e){try{await this.synth.loadPatch(new URL(`/sounds/voices/${e}/patch.json`,t&&"SCRIPT"===t.tagName.toUpperCase()&&t.src||new URL("tunepad-interactives.min.js",document.baseURI).href))}catch(s){this.synth.loadPatch(new URL(`/assets/sounds/voices/${e}/patch.json`,t&&"SCRIPT"===t.tagName.toUpperCase()&&t.src||new URL("tunepad-interactives.min.js",document.baseURI).href))}}resize(t,e){this.canvas.width,this.canvas.height,this.canvas.setAttribute("width",`${t}`),this.canvas.setAttribute("height",`${e}`),this.dicon.y=e-this.dicon.h-5;for(let s=0;s<this.insects.length;s++){const n=this.insects[s];n.px.minPixel=120,n.px.maxPixel=t-150,n.py.minPixel=100,n.py.maxPixel=e-150,n.dock(t-80,200+80*s)}this.render()}moveToTop(t){const e=this.flowers.indexOf(t);e>=0&&this.flowers.splice(e,1),this.flowers.push(t)}get clockTime(){return this.audio.contextTime}get startTime(){return this._start_time}get startBeat(){return this._start_beat}get elapsedTime(){return this.clockTime-this.startTime}get beatsPerSec(){return this.audio.bpm/60}get secsPerBeat(){return 60/this.audio.bpm}get elapsedBeats(){return this.elapsedTime*this.beatsPerSec}get currentBeat(){return this.elapsedBeats+this.startBeat}changeTempo(t){if(t!=this.audio.bpm){const e=this.currentBeat;this._start_beat=e,this._start_time=this.clockTime,this.audio.bpm=Math.max(40,Math.min(t,180)),this.root.querySelector(".bpm-indicator").innerHTML=`${t} bpm`}}_animate(t){let e=!1;for(let s of this.flowers)s.animate(t)&&(e=!0);for(let s of this.insects)s.animate(t)&&(e=!0);if(this.dicon.animate(t)&&(e=!0),this.tempoParam.changed&&this.tempoParam.active){const t=Math.round(this.tempoParam.value);this.changeTempo(t),this.tempoParam.changed=!1}else this.tempoParam.active||this.changeTempo(this.tempoParam.defaultValue);this.freqParam.changed&&this.freqParam.active&&(this.lowpass.frequency.value=this.freqParam.value,this.freqParam.changed=!1),this.qParam.changed&&this.qParam.active&&(this.lowpass.Q.value=this.qParam.value,this.qParam.changed=!1),this.freqParam.active&&this.bypassed?(this.loop&&(this.absn=new AudioBufferSourceNode(this.audio.context),this.absn.loop=!0,this.absn.connect(this.lowpass),this.absn.buffer=this.loop,this.bypass.gain.value=.05,this.absn.start()),this.bypassed=!1):this.freqParam.active||this.bypassed||(this.absn&&(this.absn.stop(),this.absn.disconnect(),this.absn=void 0,this.bypass.gain.value=1),this.bypassed=!0),this.gainParam.changed&&this.gainParam.active?(this.volume.gain.value=this.gainParam.value,this.gainParam.changed=!1):this.gainParam.active||(this.volume.gain.value=this.gainParam.defaultValue),this.panParam.changed&&this.panParam.active?(this.pan.pan.value=Math.min(1,Math.max(-1,this.panParam.value)),this.panParam.changed=!1):this.panParam.active||(this.pan.pan.value=this.panParam.defaultValue),(this.isPlaying||e)&&this.render(),window.requestAnimationFrame((t=>this._animate(t)))}disconnectedCallback(){}attributeChangedCallback(t,e,s){}insectDragging(){return this.insects.find((t=>t.dragging))}render(){const t=this.canvas.width,e=this.canvas.height,s=this.ctx;s.resetTransform(),s.clearRect(0,0,t,e);let n=this.isPlaying?this.currentBeat%this.audio.beatsPerMeasure:-1;const i=Math.floor(4*n);this.flowers.forEach((t=>{t.drawShadow(s,e),t.drawStem(s,e,i)})),this.flowers.forEach((t=>{t!=this.focusFlower&&t.draw(s,e,i)})),s.save();{const t=this.insectDragging();if(t){const e=t.px.minPixel,n=t.py.minPixel,i=t.px.pixelRange,r=t.py.pixelRange;s.fillStyle="#0004",s.fillRect(e,n,i,r),s.strokeStyle="#fff",s.lineWidth=2,s.strokeRect(e,n,i,r),s.beginPath(),s.moveTo(e+30,n+r-10),s.lineTo(e+i-20,n+r-10),s.stroke(),s.beginPath(),s.moveTo(e+i-20,n+r-10),s.lineTo(e+i-30,n+r-15),s.lineTo(e+i-30,n+r-5),s.closePath(),s.fillStyle="#fff",s.fill(),s.beginPath(),s.moveTo(e+20,n+r-10),s.lineTo(e+30,n+r-15),s.lineTo(e+30,n+r-5),s.closePath(),s.fill(),s.beginPath(),s.moveTo(e+10,n+20),s.lineTo(e+10,n+r-30),s.stroke(),s.beginPath(),s.moveTo(e+10,n+20),s.lineTo(e+5,n+30),s.lineTo(e+15,n+30),s.closePath(),s.fill(),s.beginPath(),s.moveTo(e+10,n+r-20),s.lineTo(e+5,n+r-30),s.lineTo(e+15,n+r-30),s.closePath(),s.fill(),s.font="15px sans-serif",s.textAlign="center",s.textBaseline="middle",s.fillText(t.px.name,e+i/2,n+r-25),s.translate(e+24,n+r/2),s.rotate(Math.PI/-2),s.fillText(t.py.name,0,0)}}if(s.restore(),this.focusFlower&&(s.fillStyle="#0007",s.fillRect(0,0,t,e),this.focusFlower.draw(s,e,Math.floor(4*n)),this.focusFlower.drawNumbers(s,e)),this.insects.forEach((t=>{t.drawShadow(s)})),this.insects.forEach((t=>{t.drawTrail(s)})),this.insects.forEach((t=>{t.draw(s)})),s.save(),s.fillStyle="rgba(90, 150, 60, 1.0)",s.fillRect(0,e-80,t,80),s.restore(),this.isPlaying){this.analyzer.getByteFrequencyData(this.abuffer),s.save(),s.fillStyle="white",s.beginPath();const n=t-230,i=e-41,r=4,a=2;for(let t=0;t<this.abuffer.length;t++){const e=this.abuffer[t]/256,o=Math.max(2,50*e),h=n+(r+a)*t,c=i-o/2;s.fillRect(h,c,r,o)}s.stroke(),s.restore()}this.dicon.draw(s)}save(){let t="?";this.flowers.forEach((e=>{const s=e.save();t+=`n${e.note}=${s}&`}));const e=this.root.querySelector(".genre-select");t+=`voice=${e.value}`,this.drawQRCode("https://learn.tunepad.space/interactives/groove-garden/"+t)}drawQRCode(t){const e=this.root.querySelector("#qrcode");this.qrcode.clear(),this.qrcode.setVersion(10),this.qrcode.add(t),this.qrcode.create();const s=this.qrcode.getMatrix();(new Ge).drawCanvas(s,e)}shimmer(t){if(void 0===this._shimmer&&this.loop&&"butterfly"===t){const t=new GainNode(this.audio.context);t.connect(this.analyzer),t.gain.value=.15,t.gain.linearRampToValueAtTime(0,this.audio.contextTime+this.loop.duration),this._shimmer=new AudioBufferSourceNode(this.audio.context),this._shimmer.buffer=this.loop,this._shimmer.connect(t),this._shimmer.start(0),this._shimmer.addEventListener("ended",(t=>{this._shimmer=void 0}))}}}ze.ELEMENT="groove-garden",ze.observedAttributes=["min-value","max-value","value"],customElements.define(Et.ELEMENT,Et),customElements.define(ft.ELEMENT,ft),customElements.define(vt.ELEMENT,vt),customElements.define(_t.ELEMENT,_t),customElements.define(ze.ELEMENT,ze)}();
//# sourceMappingURL=tunepad-interactives.min.js.map
